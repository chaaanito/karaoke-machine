import{j as e,t}from"./index-ByCoQqcr.js";var n=Object.create,r=Object.defineProperty,i=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,o=Object.getPrototypeOf,s=Object.prototype.hasOwnProperty,c=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),l=e=>{let t={};for(var n in e)r(t,n,{get:e[n],enumerable:!0});return t},u=(e,t,n,o)=>{if(t&&typeof t==`object`||typeof t==`function`)for(var c=a(t),l=0,u=c.length,d;l<u;l++)d=c[l],!s.call(e,d)&&d!==n&&r(e,d,{get:(e=>t[e]).bind(null,d),enumerable:!(o=i(t,d))||o.enumerable});return e},d=(e,t,i)=>(i=e==null?{}:n(o(e)),u(t||!e||!e.__esModule?r(i,`default`,{value:e,enumerable:!0}):i,e)),f=class{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){let e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){let e=[];for(let t of this._parts)e.push(t);return p(e).buffer}};function p(e){let t=0;for(let n of e)t+=n.byteLength;let n=new Uint8Array(t),r=0;for(let t of e){let e=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);n.set(e,r),r+=t.byteLength}return n}function m(e){return new g(e).unpack()}function h(e){let t=new _,n=t.pack(e);return n instanceof Promise?n.then(()=>t.getBuffer()):t.getBuffer()}var g=class{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){let e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;let t;if((t=e^160)<=15)return this.unpack_raw(t);if((t=e^176)<=15)return this.unpack_string(t);if((t=e^144)<=15)return this.unpack_array(t);if((t=e^128)<=15)return this.unpack_map(t);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return t=this.unpack_uint16(),this.unpack_string(t);case 217:return t=this.unpack_uint32(),this.unpack_string(t);case 218:return t=this.unpack_uint16(),this.unpack_raw(t);case 219:return t=this.unpack_uint32(),this.unpack_raw(t);case 220:return t=this.unpack_uint16(),this.unpack_array(t);case 221:return t=this.unpack_uint32(),this.unpack_array(t);case 222:return t=this.unpack_uint16(),this.unpack_map(t);case 223:return t=this.unpack_uint32(),this.unpack_map(t)}}unpack_uint8(){let e=this.dataView[this.index]&255;return this.index++,e}unpack_uint16(){let e=this.read(2),t=(e[0]&255)*256+(e[1]&255);return this.index+=2,t}unpack_uint32(){let e=this.read(4),t=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,t}unpack_uint64(){let e=this.read(8),t=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,t}unpack_int8(){let e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){let e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){let e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){let e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);let t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t}unpack_string(e){let t=this.read(e),n=0,r=``,i,a;for(;n<e;)i=t[n],i<160?(a=i,n++):(i^192)<32?(a=(i&31)<<6|t[n+1]&63,n+=2):(i^224)<16?(a=(i&15)<<12|(t[n+1]&63)<<6|t[n+2]&63,n+=3):(a=(i&7)<<18|(t[n+1]&63)<<12|(t[n+2]&63)<<6|t[n+3]&63,n+=4),r+=String.fromCodePoint(a);return this.index+=e,r}unpack_array(e){let t=Array(e);for(let n=0;n<e;n++)t[n]=this.unpack();return t}unpack_map(e){let t={};for(let n=0;n<e;n++){let e=this.unpack();t[e]=this.unpack()}return t}unpack_float(){let e=this.unpack_uint32(),t=e>>31,n=(e>>23&255)-127,r=e&8388607|8388608;return(t===0?1:-1)*r*2**(n-23)}unpack_double(){let e=this.unpack_uint32(),t=this.unpack_uint32(),n=e>>31,r=(e>>20&2047)-1023,i=(e&1048575|1048576)*2**(r-20)+t*2**(r-52);return(n===0?1:-1)*i}read(e){let t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw Error(`BinaryPackFailure: read index out of range`)}},_=class{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if(typeof e==`string`)this.pack_string(e);else if(typeof e==`number`)Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(typeof e==`boolean`)e===!0?this._bufferBuilder.append(195):e===!1&&this._bufferBuilder.append(194);else if(e===void 0)this._bufferBuilder.append(192);else if(typeof e==`object`)if(e===null)this._bufferBuilder.append(192);else{let t=e.constructor;if(e instanceof Array){let t=this.pack_array(e);if(t instanceof Promise)return t.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if(`BYTES_PER_ELEMENT`in e){let t=e;this.pack_bin(new Uint8Array(t.buffer,t.byteOffset,t.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else if(e instanceof Blob)return e.arrayBuffer().then(e=>{this.pack_bin(new Uint8Array(e)),this._bufferBuilder.flush()});else if(t==Object||t.toString().startsWith(`class`)){let t=this.pack_object(e);if(t instanceof Promise)return t.then(()=>this._bufferBuilder.flush())}else throw Error(`Type "${t.toString()}" not yet supported`)}else throw Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){let t=e.length;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this._bufferBuilder.append(218),this.pack_uint16(t);else if(t<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(t);else throw Error(`Invalid length`);this._bufferBuilder.append_buffer(e)}pack_string(e){let t=this._textEncoder.encode(e),n=t.length;if(n<=15)this.pack_uint8(176+n);else if(n<=65535)this._bufferBuilder.append(216),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(n);else throw Error(`Invalid length`);this._bufferBuilder.append_buffer(t)}pack_array(e){let t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this._bufferBuilder.append(220),this.pack_uint16(t);else if(t<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(t);else throw Error(`Invalid length`);let n=r=>{if(r<t){let t=this.pack(e[r]);return t instanceof Promise?t.then(()=>n(r+1)):n(r+1)}};return n(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(e&255);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-0x8000000000000000&&e<=0x8000000000000000)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=0x10000000000000000)this._bufferBuilder.append(207),this.pack_uint64(e);else throw Error(`Invalid integer`)}pack_double(e){let t=0;e<0&&(t=1,e=-e);let n=Math.floor(Math.log(e)/Math.LN2),r=e/2**n-1,i=Math.floor(r*2**52),a=2**32,o=t<<31|n+1023<<20|i/a&1048575,s=i%a;this._bufferBuilder.append(203),this.pack_int32(o),this.pack_int32(s)}pack_object(e){let t=Object.keys(e),n=t.length;if(n<=15)this.pack_uint8(128+n);else if(n<=65535)this._bufferBuilder.append(222),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(n);else throw Error(`Invalid length`);let r=n=>{if(n<t.length){let i=t[n];if(e.hasOwnProperty(i)){this.pack(i);let t=this.pack(e[i]);if(t instanceof Promise)return t.then(()=>r(n+1))}return r(n+1)}};return r(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(e&255)}pack_uint32(e){let t=e&4294967295;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255)}pack_uint64(e){let t=e/2**32,n=e%2**32;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255),this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255)}pack_int8(e){this._bufferBuilder.append(e&255)}pack_int16(e){this._bufferBuilder.append((e&65280)>>8),this._bufferBuilder.append(e&255)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_int64(e){let t=Math.floor(e/2**32),n=e%2**32;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255),this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255)}constructor(){this._bufferBuilder=new f,this._textEncoder=new TextEncoder}},v=!0,y=!0;function b(e,t,n){let r=e.match(t);return r&&r.length>=n&&parseFloat(r[n],10)}function x(e,t,n){if(!e.RTCPeerConnection)return;let r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);let a=e=>{let t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,a),i.apply(this,[e,a])};let a=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t]||!this._eventMap[t].has(n))return a.apply(this,arguments);let r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,a.apply(this,[e,r])},Object.defineProperty(r,`on`+t,{get(){return this[`_on`+t]},set(e){this[`_on`+t]&&(this.removeEventListener(t,this[`_on`+t]),delete this[`_on`+t]),e&&this.addEventListener(t,this[`_on`+t]=e)},enumerable:!0,configurable:!0})}function ee(e){return typeof e==`boolean`?(v=e,e?`adapter.js logging disabled`:`adapter.js logging enabled`):Error(`Argument type: `+typeof e+`. Please use a boolean.`)}function te(e){return typeof e==`boolean`?(y=!e,`adapter.js deprecation warnings `+(e?`disabled`:`enabled`)):Error(`Argument type: `+typeof e+`. Please use a boolean.`)}function ne(){if(typeof window==`object`){if(v)return;typeof console<`u`&&typeof console.log==`function`&&console.log.apply(console,arguments)}}function re(e,t){y&&console.warn(e+` is deprecated, please use `+t+` instead.`)}function ie(e){let t={browser:null,version:null};if(e===void 0||!e.navigator||!e.navigator.userAgent)return t.browser=`Not a browser.`,t;let{navigator:n}=e;if(n.userAgentData&&n.userAgentData.brands){let e=n.userAgentData.brands.find(e=>e.brand===`Chromium`);if(e)return{browser:`chrome`,version:parseInt(e.version,10)}}if(n.mozGetUserMedia)t.browser=`firefox`,t.version=parseInt(b(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection)t.browser=`chrome`,t.version=parseInt(b(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(e.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser=`safari`,t.version=parseInt(b(n.userAgent,/AppleWebKit\/(\d+)\./,1)),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&`currentDirection`in e.RTCRtpTransceiver.prototype,t._safariVersion=b(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return t.browser=`Not a supported browser.`,t;return t}function ae(e){return Object.prototype.toString.call(e)===`[object Object]`}function oe(e){return ae(e)?Object.keys(e).reduce(function(t,n){let r=ae(e[n]),i=r?oe(e[n]):e[n],a=r&&!Object.keys(i).length;return i===void 0||a?t:Object.assign(t,{[n]:i})},{}):e}function se(e,t,n){!t||n.has(t.id)||(n.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith(`Id`)?se(e,e.get(t[r]),n):r.endsWith(`Ids`)&&t[r].forEach(t=>{se(e,e.get(t),n)})}))}function ce(e,t,n){let r=n?`outbound-rtp`:`inbound-rtp`,i=new Map;if(t===null)return i;let a=[];return e.forEach(e=>{e.type===`track`&&e.trackIdentifier===t.id&&a.push(e)}),a.forEach(t=>{e.forEach(n=>{n.type===r&&n.trackId===t.id&&se(e,n,i)})}),i}var le=ne;function ue(e,t){let n=e&&e.navigator;if(!n.mediaDevices)return;let r=function(e){if(typeof e!=`object`||e.mandatory||e.optional)return e;let t={};return Object.keys(e).forEach(n=>{if(n===`require`||n===`advanced`||n===`mediaSource`)return;let r=typeof e[n]==`object`?e[n]:{ideal:e[n]};r.exact!==void 0&&typeof r.exact==`number`&&(r.min=r.max=r.exact);let i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):t===`deviceId`?`sourceId`:t};if(r.ideal!==void 0){t.optional=t.optional||[];let e={};typeof r.ideal==`number`?(e[i(`min`,n)]=r.ideal,t.optional.push(e),e={},e[i(`max`,n)]=r.ideal,t.optional.push(e)):(e[i(``,n)]=r.ideal,t.optional.push(e))}r.exact!==void 0&&typeof r.exact!=`number`?(t.mandatory=t.mandatory||{},t.mandatory[i(``,n)]=r.exact):[`min`,`max`].forEach(e=>{r[e]!==void 0&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if(e=JSON.parse(JSON.stringify(e)),e&&typeof e.audio==`object`){let t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};e=JSON.parse(JSON.stringify(e)),t(e.audio,`autoGainControl`,`googAutoGainControl`),t(e.audio,`noiseSuppression`,`googNoiseSuppression`),e.audio=r(e.audio)}if(e&&typeof e.video==`object`){let a=e.video.facingMode;a&&=typeof a==`object`?a:{ideal:a};let o=t.version<66;if(a&&(a.exact===`user`||a.exact===`environment`||a.ideal===`user`||a.ideal===`environment`)&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!o)){delete e.video.facingMode;let t;if(a.exact===`environment`||a.ideal===`environment`?t=[`back`,`rear`]:(a.exact===`user`||a.ideal===`user`)&&(t=[`front`]),t)return n.mediaDevices.enumerateDevices().then(n=>{n=n.filter(e=>e.kind===`videoinput`);let o=n.find(e=>t.some(t=>e.label.toLowerCase().includes(t)));return!o&&n.length&&t.includes(`back`)&&(o=n[n.length-1]),o&&(e.video.deviceId=a.exact?{exact:o.deviceId}:{ideal:o.deviceId}),e.video=r(e.video),le(`chrome: `+JSON.stringify(e)),i(e)})}e.video=r(e.video)}return le(`chrome: `+JSON.stringify(e)),i(e)},a=function(e){return t.version>=64?e:{name:{PermissionDeniedError:`NotAllowedError`,PermissionDismissedError:`NotAllowedError`,InvalidStateError:`NotAllowedError`,DevicesNotFoundError:`NotFoundError`,ConstraintNotSatisfiedError:`OverconstrainedError`,TrackStartError:`NotReadableError`,MediaDeviceFailedDueToShutdown:`NotAllowedError`,MediaDeviceKillSwitchOn:`NotAllowedError`,TabCaptureError:`AbortError`,ScreenCaptureError:`AbortError`,DeviceCaptureError:`AbortError`}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&`: `)+this.message}}};if(n.getUserMedia=function(e,t,r){i(e,e=>{n.webkitGetUserMedia(e,t,e=>{r&&r(a(e))})})}.bind(n),n.mediaDevices.getUserMedia){let e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return i(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException(``,`NotFoundError`);return e},e=>Promise.reject(a(e))))}}}var de=l({fixNegotiationNeeded:()=>ye,shimAddTrackRemoveTrack:()=>_e,shimAddTrackRemoveTrackWithNative:()=>ge,shimGetSendersWithDtmf:()=>me,shimGetUserMedia:()=>ue,shimMediaStream:()=>fe,shimOnTrack:()=>pe,shimPeerConnection:()=>ve,shimSenderReceiverGetStats:()=>he});function fe(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function pe(e){if(typeof e==`object`&&e.RTCPeerConnection&&!(`ontrack`in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,`ontrack`,{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener(`track`,this._ontrack),this.addEventListener(`track`,this._ontrack=e)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener(`addtrack`,n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.track.id):{track:n.track};let i=new Event(`track`);i.track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)}),t.stream.getTracks().forEach(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.id):{track:n};let i=new Event(`track`);i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)})},this.addEventListener(`addstream`,this._ontrackpoly)),t.apply(this,arguments)}}else x(e,`track`,e=>(e.transceiver||Object.defineProperty(e,`transceiver`,{value:{receiver:e.receiver}}),e))}function me(e){if(typeof e==`object`&&e.RTCPeerConnection&&!(`getSenders`in e.RTCPeerConnection.prototype)&&`createDTMFSender`in e.RTCPeerConnection.prototype){let t=function(e,t){return{track:t,get dtmf(){return this._dtmf===void 0&&(t.kind===`audio`?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};let r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);let t=this._senders.indexOf(e);t!==-1&&this._senders.splice(t,1)}}let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};let r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach(e=>{let t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if(typeof e==`object`&&e.RTCPeerConnection&&`getSenders`in e.RTCPeerConnection.prototype&&`createDTMFSender`in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!(`dtmf`in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,`dtmf`,{get(){return this._dtmf===void 0&&(this.track.kind===`audio`?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function he(e){if(!(typeof e==`object`&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!(`getStats`in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});let n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){let e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){let e=this;return this._pc.getStats().then(t=>ce(t,e.track,!0))}}if(!(`getStats`in e.RTCRtpReceiver.prototype)){let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),x(e,`track`,e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){let e=this;return this._pc.getStats().then(t=>ce(t,e.track,!1))}}if(!(`getStats`in e.RTCRtpSender.prototype&&`getStats`in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let e=arguments[0],t,n,r;return this.getSenders().forEach(n=>{n.track===e&&(t?r=!0:t=n)}),this.getReceivers().forEach(t=>(t.track===e&&(n?r=!0:n=t),t.track===e)),r||t&&n?Promise.reject(new DOMException(`There are more than one sender or receiver for the track.`,`InvalidAccessError`)):t?t.getStats():n?n.getStats():Promise.reject(new DOMException(`There is no sender or receiver for the track.`,`InvalidAccessError`))}return t.apply(this,arguments)}}function ge(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?this._shimmedLocalStreams[n.id].indexOf(r)===-1&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException(`Track already exists.`,`InvalidAccessError`)});let t=this.getSenders();n.apply(this,arguments);let r=this.getSenders().filter(e=>t.indexOf(e)===-1);this._shimmedLocalStreams[e.id]=[e].concat(r)};let r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};let i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{let n=this._shimmedLocalStreams[t].indexOf(e);n!==-1&&this._shimmedLocalStreams[t].splice(n,1),this._shimmedLocalStreams[t].length===1&&delete this._shimmedLocalStreams[t]}),i.apply(this,arguments)}}function _e(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return ge(e);let n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException(`Track already exists.`,`InvalidAccessError`)}),!this._reverseStreams[t.id]){let n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};let i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if(this.signalingState===`closed`)throw new DOMException(`The RTCPeerConnection's signalingState is 'closed'.`,`InvalidStateError`);let r=[].slice.call(arguments,1);if(r.length!==1||!r[0].getTracks().find(e=>e===t))throw new DOMException(`The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.`,`NotSupportedError`);if(this.getSenders().find(e=>e.track===t))throw new DOMException(`Track already exists.`,`InvalidAccessError`);this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let i=this._streams[n.id];if(i)i.addTrack(t),Promise.resolve().then(()=>{this.dispatchEvent(new Event(`negotiationneeded`))});else{let r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find(e=>e.track===t)};function a(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{let r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,`g`),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{let r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,`g`),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}[`createOffer`,`createAnswer`].forEach(function(t){let n=e.RTCPeerConnection.prototype[t],r={[t](){let e=arguments;return arguments.length&&typeof arguments[0]==`function`?n.apply(this,[t=>{let n=a(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then(e=>a(this,e))}};e.RTCPeerConnection.prototype[t]=r[t]});let s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type||(arguments[0]=o(this,arguments[0])),s.apply(this,arguments)};let c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,`localDescription`);Object.defineProperty(e.RTCPeerConnection.prototype,`localDescription`,{get(){let e=c.get.apply(this);return e.type===``?e:a(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if(this.signalingState===`closed`)throw new DOMException(`The RTCPeerConnection's signalingState is 'closed'.`,`InvalidStateError`);if(!e._pc)throw new DOMException(`Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.`,`TypeError`);if(e._pc!==this)throw new DOMException(`Sender was not created by this connection.`,`InvalidAccessError`);this._streams=this._streams||{};let t;Object.keys(this._streams).forEach(n=>{this._streams[n].getTracks().find(t=>e.track===t)&&(t=this._streams[n])}),t&&(t.getTracks().length===1?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event(`negotiationneeded`)))}}function ve(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&[`setLocalDescription`,`setRemoteDescription`,`addIceCandidate`].forEach(function(t){let n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new(t===`addIceCandidate`?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]})}function ye(e,t){x(e,`negotiationneeded`,e=>{let n=e.target;if(!((t.version<72||n.getConfiguration&&n.getConfiguration().sdpSemantics===`plan-b`)&&n.signalingState!==`stable`))return e})}function be(e,t){let n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){re(`navigator.getUserMedia`,`navigator.mediaDevices.getUserMedia`),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&`autoGainControl`in n.mediaDevices.getSupportedConstraints())){let e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return typeof n==`object`&&typeof n.audio==`object`&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,`autoGainControl`,`mozAutoGainControl`),e(n.audio,`noiseSuppression`,`mozNoiseSuppression`)),t(n)},r&&r.prototype.getSettings){let t=r.prototype.getSettings;r.prototype.getSettings=function(){let n=t.apply(this,arguments);return e(n,`mozAutoGainControl`,`autoGainControl`),e(n,`mozNoiseSuppression`,`noiseSuppression`),n}}if(r&&r.prototype.applyConstraints){let t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return this.kind===`audio`&&typeof n==`object`&&(n=JSON.parse(JSON.stringify(n)),e(n,`autoGainControl`,`mozAutoGainControl`),e(n,`noiseSuppression`,`mozNoiseSuppression`)),t.apply(this,[n])}}}}function xe(e,t){e.navigator.mediaDevices&&`getDisplayMedia`in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!(n&&n.video)){let e=new DOMException(`getDisplayMedia without video constraints is undefined`);return e.name=`NotFoundError`,e.code=8,Promise.reject(e)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}var Se=l({shimAddTransceiver:()=>De,shimCreateAnswer:()=>Ae,shimCreateOffer:()=>ke,shimGetDisplayMedia:()=>xe,shimGetParameters:()=>Oe,shimGetUserMedia:()=>be,shimOnTrack:()=>Ce,shimPeerConnection:()=>S,shimRTCDataChannel:()=>Ee,shimReceiverGetStats:()=>Te,shimRemoveStream:()=>C,shimSenderGetStats:()=>we});function Ce(e){typeof e==`object`&&e.RTCTrackEvent&&`receiver`in e.RTCTrackEvent.prototype&&!(`transceiver`in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,`transceiver`,{get(){return{receiver:this.receiver}}})}function S(e,t){if(typeof e!=`object`||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&[`setLocalDescription`,`setRemoteDescription`,`addIceCandidate`].forEach(function(t){let n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new(t===`addIceCandidate`?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]});let n={inboundrtp:`inbound-rtp`,outboundrtp:`outbound-rtp`,candidatepair:`candidate-pair`,localcandidate:`local-candidate`,remotecandidate:`remote-candidate`},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[e,i,a]=arguments;return r.apply(this,[e||null]).then(e=>{if(t.version<53&&!i)try{e.forEach(e=>{e.type=n[e.type]||e.type})}catch(t){if(t.name!==`TypeError`)throw t;e.forEach((t,r)=>{e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))})}return e}).then(i,a)}}function we(e){if(!(typeof e==`object`&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&`getStats`in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});let n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){let e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Te(e){if(!(typeof e==`object`&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&`getStats`in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),x(e,`track`,e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function C(e){!e.RTCPeerConnection||`removeStream`in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){re(`removeStream`,`removeTrack`),this.getSenders().forEach(t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)})})}function Ee(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function De(e){if(!(typeof e==`object`&&e.RTCPeerConnection))return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;e===void 0&&(e=[]),e=[...e];let n=e.length>0;n&&e.forEach(e=>{if(`rid`in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw TypeError(`Invalid RID value provided.`);if(`scaleResolutionDownBy`in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw RangeError(`scale_resolution_down_by must be >= 1.0`);if(`maxFramerate`in e&&!(parseFloat(e.maxFramerate)>=0))throw RangeError(`max_framerate must be >= 0.0`)});let r=t.apply(this,arguments);if(n){let{sender:t}=r,n=t.getParameters();(!(`encodings`in n)||n.encodings.length===1&&Object.keys(n.encodings[0]).length===0)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return r})}function Oe(e){if(!(typeof e==`object`&&e.RTCRtpSender))return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let e=t.apply(this,arguments);return`encodings`in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function ke(e){if(!(typeof e==`object`&&e.RTCPeerConnection))return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function Ae(e){if(!(typeof e==`object`&&e.RTCPeerConnection))return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var je=l({shimAudioContext:()=>Be,shimCallbacksAPI:()=>Pe,shimConstraints:()=>Ie,shimCreateOfferLegacy:()=>ze,shimGetUserMedia:()=>Fe,shimLocalStreamsAPI:()=>Me,shimRTCIceServerUrls:()=>Le,shimRemoteStreamsAPI:()=>Ne,shimTrackEventTransceiver:()=>Re});function Me(e){if(!(typeof e!=`object`||!e.RTCPeerConnection)){if(`getLocalStreams`in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||=[],this._localStreams}),!(`addStream`in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||=[],this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(n=>t.call(this,n,e)),e.getVideoTracks().forEach(n=>t.call(this,n,e))},e.RTCPeerConnection.prototype.addTrack=function(e,...n){return n&&n.forEach(e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}`removeStream`in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||=[];let t=this._localStreams.indexOf(e);if(t===-1)return;this._localStreams.splice(t,1);let n=e.getTracks();this.getSenders().forEach(e=>{n.includes(e.track)&&this.removeTrack(e)})})}}function Ne(e){if(!(typeof e!=`object`||!e.RTCPeerConnection)&&(`getRemoteStreams`in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!(`onaddstream`in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,`onaddstream`,{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener(`addstream`,this._onaddstream),this.removeEventListener(`track`,this._onaddstreampoly)),this.addEventListener(`addstream`,this._onaddstream=e),this.addEventListener(`track`,this._onaddstreampoly=e=>{e.streams.forEach(e=>{if(this._remoteStreams||=[],this._remoteStreams.includes(e))return;this._remoteStreams.push(e);let t=new Event(`addstream`);t.stream=e,this.dispatchEvent(t)})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let e=this;return this._onaddstreampoly||this.addEventListener(`track`,this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||=[],e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);let n=new Event(`addstream`);n.stream=t,e.dispatchEvent(n)})}),t.apply(e,arguments)}}}function Pe(e){if(typeof e!=`object`||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,a=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){let r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){let n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};let s=function(e,t,n){let r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){let r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){let r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=s}function Fe(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(Ie(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function Ie(e){return e&&e.video!==void 0?Object.assign({},e,{video:oe(e.video)}):e}function Le(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){let t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];r.urls===void 0&&r.url?(re(`RTCIceServer.url`,`RTCIceServer.urls`),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,`generateCertificate`in t&&Object.defineProperty(e.RTCPeerConnection,`generateCertificate`,{get(){return t.generateCertificate}})}function Re(e){typeof e==`object`&&e.RTCTrackEvent&&`receiver`in e.RTCTrackEvent.prototype&&!(`transceiver`in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,`transceiver`,{get(){return{receiver:this.receiver}}})}function ze(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){e.offerToReceiveAudio!==void 0&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);let t=this.getTransceivers().find(e=>e.receiver.track.kind===`audio`);e.offerToReceiveAudio===!1&&t?t.direction===`sendrecv`?t.setDirection?t.setDirection(`sendonly`):t.direction=`sendonly`:t.direction===`recvonly`&&(t.setDirection?t.setDirection(`inactive`):t.direction=`inactive`):e.offerToReceiveAudio===!0&&!t&&this.addTransceiver(`audio`,{direction:`recvonly`}),e.offerToReceiveVideo!==void 0&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);let n=this.getTransceivers().find(e=>e.receiver.track.kind===`video`);e.offerToReceiveVideo===!1&&n?n.direction===`sendrecv`?n.setDirection?n.setDirection(`sendonly`):n.direction=`sendonly`:n.direction===`recvonly`&&(n.setDirection?n.setDirection(`inactive`):n.direction=`inactive`):e.offerToReceiveVideo===!0&&!n&&this.addTransceiver(`video`,{direction:`recvonly`})}return t.apply(this,arguments)}}function Be(e){typeof e!=`object`||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Ve=c(((e,t)=>{var n={};n.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split(`
`).map(e=>e.trim())},n.splitSections=function(e){return e.split(`
m=`).map((e,t)=>(t>0?`m=`+e:e).trim()+`\r
`)},n.getDescription=function(e){let t=n.splitSections(e);return t&&t[0]},n.getMediaSections=function(e){let t=n.splitSections(e);return t.shift(),t},n.matchPrefix=function(e,t){return n.splitLines(e).filter(e=>e.indexOf(t)===0)},n.parseCandidate=function(e){let t;t=e.indexOf(`a=candidate:`)===0?e.substring(12).split(` `):e.substring(10).split(` `);let n={foundation:t[0],component:{1:`rtp`,2:`rtcp`}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case`raddr`:n.relatedAddress=t[e+1];break;case`rport`:n.relatedPort=parseInt(t[e+1],10);break;case`tcptype`:n.tcpType=t[e+1];break;case`ufrag`:n.ufrag=t[e+1],n.usernameFragment=t[e+1];break;default:n[t[e]]===void 0&&(n[t[e]]=t[e+1]);break}return n},n.writeCandidate=function(e){let t=[];t.push(e.foundation);let n=e.component;n===`rtp`?t.push(1):n===`rtcp`?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);let r=e.type;return t.push(`typ`),t.push(r),r!==`host`&&e.relatedAddress&&e.relatedPort&&(t.push(`raddr`),t.push(e.relatedAddress),t.push(`rport`),t.push(e.relatedPort)),e.tcpType&&e.protocol.toLowerCase()===`tcp`&&(t.push(`tcptype`),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push(`ufrag`),t.push(e.usernameFragment||e.ufrag)),`candidate:`+t.join(` `)},n.parseIceOptions=function(e){return e.substring(14).split(` `)},n.parseRtpMap=function(e){let t=e.substring(9).split(` `),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split(`/`),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=t.length===3?parseInt(t[2],10):1,n.numChannels=n.channels,n},n.writeRtpMap=function(e){let t=e.payloadType;e.preferredPayloadType!==void 0&&(t=e.preferredPayloadType);let n=e.channels||e.numChannels||1;return`a=rtpmap:`+t+` `+e.name+`/`+e.clockRate+(n===1?``:`/`+n)+`\r
`},n.parseExtmap=function(e){let t=e.substring(9).split(` `);return{id:parseInt(t[0],10),direction:t[0].indexOf(`/`)>0?t[0].split(`/`)[1]:`sendrecv`,uri:t[1],attributes:t.slice(2).join(` `)}},n.writeExtmap=function(e){return`a=extmap:`+(e.id||e.preferredId)+(e.direction&&e.direction!==`sendrecv`?`/`+e.direction:``)+` `+e.uri+(e.attributes?` `+e.attributes:``)+`\r
`},n.parseFmtp=function(e){let t={},n,r=e.substring(e.indexOf(` `)+1).split(`;`);for(let e=0;e<r.length;e++)n=r[e].trim().split(`=`),t[n[0].trim()]=n[1];return t},n.writeFmtp=function(e){let t=``,n=e.payloadType;if(e.preferredPayloadType!==void 0&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){let r=[];Object.keys(e.parameters).forEach(t=>{e.parameters[t]===void 0?r.push(t):r.push(t+`=`+e.parameters[t])}),t+=`a=fmtp:`+n+` `+r.join(`;`)+`\r
`}return t},n.parseRtcpFb=function(e){let t=e.substring(e.indexOf(` `)+1).split(` `);return{type:t.shift(),parameter:t.join(` `)}},n.writeRtcpFb=function(e){let t=``,n=e.payloadType;return e.preferredPayloadType!==void 0&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(e=>{t+=`a=rtcp-fb:`+n+` `+e.type+(e.parameter&&e.parameter.length?` `+e.parameter:``)+`\r
`}),t},n.parseSsrcMedia=function(e){let t=e.indexOf(` `),n={ssrc:parseInt(e.substring(7,t),10)},r=e.indexOf(`:`,t);return r>-1?(n.attribute=e.substring(t+1,r),n.value=e.substring(r+1)):n.attribute=e.substring(t+1),n},n.parseSsrcGroup=function(e){let t=e.substring(13).split(` `);return{semantics:t.shift(),ssrcs:t.map(e=>parseInt(e,10))}},n.getMid=function(e){let t=n.matchPrefix(e,`a=mid:`)[0];if(t)return t.substring(6)},n.parseFingerprint=function(e){let t=e.substring(14).split(` `);return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},n.getDtlsParameters=function(e,t){return{role:`auto`,fingerprints:n.matchPrefix(e+t,`a=fingerprint:`).map(n.parseFingerprint)}},n.writeDtlsParameters=function(e,t){let n=`a=setup:`+t+`\r
`;return e.fingerprints.forEach(e=>{n+=`a=fingerprint:`+e.algorithm+` `+e.value+`\r
`}),n},n.parseCryptoLine=function(e){let t=e.substring(9).split(` `);return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},n.writeCryptoLine=function(e){return`a=crypto:`+e.tag+` `+e.cryptoSuite+` `+(typeof e.keyParams==`object`?n.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?` `+e.sessionParams.join(` `):``)+`\r
`},n.parseCryptoKeyParams=function(e){if(e.indexOf(`inline:`)!==0)return null;let t=e.substring(7).split(`|`);return{keyMethod:`inline`,keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(`:`)[0]:void 0,mkiLength:t[2]?t[2].split(`:`)[1]:void 0}},n.writeCryptoKeyParams=function(e){return e.keyMethod+`:`+e.keySalt+(e.lifeTime?`|`+e.lifeTime:``)+(e.mkiValue&&e.mkiLength?`|`+e.mkiValue+`:`+e.mkiLength:``)},n.getCryptoParameters=function(e,t){return n.matchPrefix(e+t,`a=crypto:`).map(n.parseCryptoLine)},n.getIceParameters=function(e,t){let r=n.matchPrefix(e+t,`a=ice-ufrag:`)[0],i=n.matchPrefix(e+t,`a=ice-pwd:`)[0];return r&&i?{usernameFragment:r.substring(12),password:i.substring(10)}:null},n.writeIceParameters=function(e){let t=`a=ice-ufrag:`+e.usernameFragment+`\r
a=ice-pwd:`+e.password+`\r
`;return e.iceLite&&(t+=`a=ice-lite\r
`),t},n.parseRtpParameters=function(e){let t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=n.splitLines(e)[0].split(` `);t.profile=r[2];for(let i=3;i<r.length;i++){let a=r[i],o=n.matchPrefix(e,`a=rtpmap:`+a+` `)[0];if(o){let r=n.parseRtpMap(o),i=n.matchPrefix(e,`a=fmtp:`+a+` `);switch(r.parameters=i.length?n.parseFmtp(i[0]):{},r.rtcpFeedback=n.matchPrefix(e,`a=rtcp-fb:`+a+` `).map(n.parseRtcpFb),t.codecs.push(r),r.name.toUpperCase()){case`RED`:case`ULPFEC`:t.fecMechanisms.push(r.name.toUpperCase());break;default:break}}}n.matchPrefix(e,`a=extmap:`).forEach(e=>{t.headerExtensions.push(n.parseExtmap(e))});let i=n.matchPrefix(e,`a=rtcp-fb:* `).map(n.parseRtcpFb);return t.codecs.forEach(e=>{i.forEach(t=>{e.rtcpFeedback.find(e=>e.type===t.type&&e.parameter===t.parameter)||e.rtcpFeedback.push(t)})}),t},n.writeRtpDescription=function(e,t){let r=``;r+=`m=`+e+` `,r+=t.codecs.length>0?`9`:`0`,r+=` `+(t.profile||`UDP/TLS/RTP/SAVPF`)+` `,r+=t.codecs.map(e=>e.preferredPayloadType===void 0?e.payloadType:e.preferredPayloadType).join(` `)+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,t.codecs.forEach(e=>{r+=n.writeRtpMap(e),r+=n.writeFmtp(e),r+=n.writeRtcpFb(e)});let i=0;return t.codecs.forEach(e=>{e.maxptime>i&&(i=e.maxptime)}),i>0&&(r+=`a=maxptime:`+i+`\r
`),t.headerExtensions&&t.headerExtensions.forEach(e=>{r+=n.writeExtmap(e)}),r},n.parseRtpEncodingParameters=function(e){let t=[],r=n.parseRtpParameters(e),i=r.fecMechanisms.indexOf(`RED`)!==-1,a=r.fecMechanisms.indexOf(`ULPFEC`)!==-1,o=n.matchPrefix(e,`a=ssrc:`).map(e=>n.parseSsrcMedia(e)).filter(e=>e.attribute===`cname`),s=o.length>0&&o[0].ssrc,c,l=n.matchPrefix(e,`a=ssrc-group:FID`).map(e=>e.substring(17).split(` `).map(e=>parseInt(e,10)));l.length>0&&l[0].length>1&&l[0][0]===s&&(c=l[0][1]),r.codecs.forEach(e=>{if(e.name.toUpperCase()===`RTX`&&e.parameters.apt){let n={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&c&&(n.rtx={ssrc:c}),t.push(n),i&&(n=JSON.parse(JSON.stringify(n)),n.fec={ssrc:s,mechanism:a?`red+ulpfec`:`red`},t.push(n))}}),t.length===0&&s&&t.push({ssrc:s});let u=n.matchPrefix(e,`b=`);return u.length&&(u=u[0].indexOf(`b=TIAS:`)===0?parseInt(u[0].substring(7),10):u[0].indexOf(`b=AS:`)===0?parseInt(u[0].substring(5),10)*1e3*.95-2e3*8:void 0,t.forEach(e=>{e.maxBitrate=u})),t},n.parseRtcpParameters=function(e){let t={},r=n.matchPrefix(e,`a=ssrc:`).map(e=>n.parseSsrcMedia(e)).filter(e=>e.attribute===`cname`)[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);let i=n.matchPrefix(e,`a=rtcp-rsize`);return t.reducedSize=i.length>0,t.compound=i.length===0,t.mux=n.matchPrefix(e,`a=rtcp-mux`).length>0,t},n.writeRtcpParameters=function(e){let t=``;return e.reducedSize&&(t+=`a=rtcp-rsize\r
`),e.mux&&(t+=`a=rtcp-mux\r
`),e.ssrc!==void 0&&e.cname&&(t+=`a=ssrc:`+e.ssrc+` cname:`+e.cname+`\r
`),t},n.parseMsid=function(e){let t,r=n.matchPrefix(e,`a=msid:`);if(r.length===1)return t=r[0].substring(7).split(` `),{stream:t[0],track:t[1]};let i=n.matchPrefix(e,`a=ssrc:`).map(e=>n.parseSsrcMedia(e)).filter(e=>e.attribute===`msid`);if(i.length>0)return t=i[0].value.split(` `),{stream:t[0],track:t[1]}},n.parseSctpDescription=function(e){let t=n.parseMLine(e),r=n.matchPrefix(e,`a=max-message-size:`),i;r.length>0&&(i=parseInt(r[0].substring(19),10)),isNaN(i)&&(i=65536);let a=n.matchPrefix(e,`a=sctp-port:`);if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:t.fmt,maxMessageSize:i};let o=n.matchPrefix(e,`a=sctpmap:`);if(o.length>0){let e=o[0].substring(10).split(` `);return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:i}}},n.writeSctpDescription=function(e,t){let n=[];return n=e.protocol===`DTLS/SCTP`?[`m=`+e.kind+` 9 `+e.protocol+` `+t.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,`a=sctpmap:`+t.port+` `+t.protocol+` 65535\r
`]:[`m=`+e.kind+` 9 `+e.protocol+` `+t.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,`a=sctp-port:`+t.port+`\r
`],t.maxMessageSize!==void 0&&n.push(`a=max-message-size:`+t.maxMessageSize+`\r
`),n.join(``)},n.generateSessionId=function(){return Math.random().toString().substr(2,22)},n.writeSessionBoilerplate=function(e,t,r){let i,a=t===void 0?2:t;return i=e||n.generateSessionId(),`v=0\r
o=`+(r||`thisisadapterortc`)+` `+i+` `+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},n.getDirection=function(e,t){let r=n.splitLines(e);for(let e=0;e<r.length;e++)switch(r[e]){case`a=sendrecv`:case`a=sendonly`:case`a=recvonly`:case`a=inactive`:return r[e].substring(2);default:}return t?n.getDirection(t):`sendrecv`},n.getKind=function(e){return n.splitLines(e)[0].split(` `)[0].substring(2)},n.isRejected=function(e){return e.split(` `,2)[1]===`0`},n.parseMLine=function(e){let t=n.splitLines(e)[0].substring(2).split(` `);return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(` `)}},n.parseOLine=function(e){let t=n.matchPrefix(e,`o=`)[0].substring(2).split(` `);return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},n.isValidSDP=function(e){if(typeof e!=`string`||e.length===0)return!1;let t=n.splitLines(e);for(let e=0;e<t.length;e++)if(t[e].length<2||t[e].charAt(1)!==`=`)return!1;return!0},typeof t==`object`&&(t.exports=n)})),He=l({removeExtmapAllowMixed:()=>Je,shimAddIceCandidateNullOrEmpty:()=>Ye,shimConnectionState:()=>qe,shimMaxMessageSize:()=>Ke,shimParameterlessSetLocalDescription:()=>T,shimRTCIceCandidate:()=>We,shimRTCIceCandidateRelayProtocol:()=>Ge,shimSendThrowTypeError:()=>w}),Ue=d(Ve());function We(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&`foundation`in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if(typeof e==`object`&&e.candidate&&e.candidate.indexOf(`a=`)===0&&(e=JSON.parse(JSON.stringify(e)),e.candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){let n=new t(e),r=Ue.default.parseCandidate(e.candidate);for(let e in r)e in n||Object.defineProperty(n,e,{value:r[e]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,x(e,`icecandidate`,t=>(t.candidate&&Object.defineProperty(t,`candidate`,{value:new e.RTCIceCandidate(t.candidate),writable:`false`}),t))}function Ge(e){!e.RTCIceCandidate||e.RTCIceCandidate&&`relayProtocol`in e.RTCIceCandidate.prototype||x(e,`icecandidate`,e=>{if(e.candidate){let t=Ue.default.parseCandidate(e.candidate.candidate);t.type===`relay`&&(e.candidate.relayProtocol={0:`tls`,1:`tcp`,2:`udp`}[t.priority>>24])}return e})}function Ke(e,t){if(!e.RTCPeerConnection)return;`sctp`in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,`sctp`,{get(){return this._sctp===void 0?null:this._sctp}});let n=function(e){if(!e||!e.sdp)return!1;let t=Ue.default.splitSections(e.sdp);return t.shift(),t.some(e=>{let t=Ue.default.parseMLine(e);return t&&t.kind===`application`&&t.protocol.indexOf(`SCTP`)!==-1})},r=function(e){let t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(t===null||t.length<2)return-1;let n=parseInt(t[1],10);return n===n?n:-1},i=function(e){let n=65536;return t.browser===`firefox`&&(n=t.version<57?e===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),n},a=function(e,n){let r=65536;t.browser===`firefox`&&t.version===57&&(r=65535);let i=Ue.default.matchPrefix(e.sdp,`a=max-message-size:`);return i.length>0?r=parseInt(i[0].substring(19),10):t.browser===`firefox`&&n!==-1&&(r=2147483637),r},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser===`chrome`&&t.version>=76){let{sdpSemantics:e}=this.getConfiguration();e===`plan-b`&&Object.defineProperty(this,`sctp`,{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){let e=r(arguments[0]),t=i(e),n=a(arguments[0],e),o;o=t===0&&n===0?1/0:t===0||n===0?Math.max(t,n):Math.min(t,n);let s={};Object.defineProperty(s,`maxMessageSize`,{get(){return o}}),this._sctp=s}return o.apply(this,arguments)}}function w(e){if(!(e.RTCPeerConnection&&`createDataChannel`in e.RTCPeerConnection.prototype))return;function t(e,t){let n=e.send;e.send=function(){let r=arguments[0],i=r.length||r.size||r.byteLength;if(e.readyState===`open`&&t.sctp&&i>t.sctp.maxMessageSize)throw TypeError(`Message too large (can send a maximum of `+t.sctp.maxMessageSize+` bytes)`);return n.apply(e,arguments)}}let n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let e=n.apply(this,arguments);return t(e,this),e},x(e,`datachannel`,e=>(t(e.channel,e.target),e))}function qe(e){if(!e.RTCPeerConnection||`connectionState`in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,`connectionState`,{get(){return{completed:`connected`,checking:`connecting`}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,`onconnectionstatechange`,{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener(`connectionstatechange`,this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener(`connectionstatechange`,this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),[`setLocalDescription`,`setRemoteDescription`].forEach(e=>{let n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{let t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;let n=new Event(`connectionstatechange`,e);t.dispatchEvent(n)}return e},this.addEventListener(`iceconnectionstatechange`,this._connectionstatechangepoly)),n.apply(this,arguments)}})}function Je(e,t){if(!e.RTCPeerConnection||t.browser===`chrome`&&t.version>=71||t.browser===`safari`&&t._safariVersion>=13.1)return;let n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&t.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let n=t.sdp.split(`
`).filter(e=>e.trim()!==`a=extmap-allow-mixed`).join(`
`);e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function Ye(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;let n=e.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser===`chrome`&&t.version<78||t.browser===`firefox`&&t.version<68||t.browser===`safari`)&&arguments[0]&&arguments[0].candidate===``?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function T(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;let n=e.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if(typeof e!=`object`||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case`stable`:case`have-local-offer`:case`have-remote-pranswer`:e.type=`offer`;break;default:e.type=`answer`;break}return e.sdp||e.type!==`offer`&&e.type!==`answer`?n.apply(this,[e]):(e.type===`offer`?this.createOffer:this.createAnswer).apply(this).then(e=>n.apply(this,[e]))})}var Xe=d(Ve());function Ze({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){let n=ne,r=ie(e),i={browserDetails:r,commonShim:He,extractVersion:b,disableLog:ee,disableWarnings:te,sdp:Xe};switch(r.browser){case`chrome`:if(!de||!ve||!t.shimChrome)return n(`Chrome shim is not included in this adapter release.`),i;if(r.version===null)return n(`Chrome shim can not determine version, not shimming.`),i;n(`adapter.js shimming chrome.`),i.browserShim=de,Ye(e,r),T(e,r),ue(e,r),fe(e,r),ve(e,r),pe(e,r),_e(e,r),me(e,r),he(e,r),ye(e,r),We(e,r),Ge(e,r),qe(e,r),Ke(e,r),w(e,r),Je(e,r);break;case`firefox`:if(!Se||!S||!t.shimFirefox)return n(`Firefox shim is not included in this adapter release.`),i;n(`adapter.js shimming firefox.`),i.browserShim=Se,Ye(e,r),T(e,r),be(e,r),S(e,r),Ce(e,r),C(e,r),we(e,r),Te(e,r),Ee(e,r),De(e,r),Oe(e,r),ke(e,r),Ae(e,r),We(e,r),qe(e,r),Ke(e,r),w(e,r);break;case`safari`:if(!je||!t.shimSafari)return n(`Safari shim is not included in this adapter release.`),i;n(`adapter.js shimming safari.`),i.browserShim=je,Ye(e,r),T(e,r),Le(e,r),ze(e,r),Pe(e,r),Me(e,r),Ne(e,r),Re(e,r),Fe(e,r),Be(e,r),We(e,r),Ge(e,r),Ke(e,r),w(e,r),Je(e,r);break;default:n(`Unsupported browser!`);break}return i}var Qe=Ze({window:typeof window>`u`?void 0:window});function $e(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}var et=class{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{let t=[],n=e.byteLength,r=Math.ceil(n/this.chunkedMTU),i=0,a=0;for(;a<n;){let o=Math.min(n,a+this.chunkedMTU),s=e.slice(a,o),c={__peerData:this._dataCount,n:i,data:s,total:r};t.push(c),a=o,i++}return this._dataCount++,t}}};function tt(e){let t=0;for(let n of e)t+=n.byteLength;let n=new Uint8Array(t),r=0;for(let t of e)n.set(t,r),r+=t.byteLength;return n}var nt=Qe.default||Qe,rt=new class{isWebRTCSupported(){return typeof RTCPeerConnection<`u`}isBrowserSupported(){let e=this.getBrowser(),t=this.getVersion();return this.supportedBrowsers.includes(e)?e===`chrome`?t>=this.minChromeVersion:e===`firefox`?t>=this.minFirefoxVersion:e===`safari`?!this.isIOS&&t>=this.minSafariVersion:!1:!1}getBrowser(){return nt.browserDetails.browser}getVersion(){return nt.browserDetails.version||0}isUnifiedPlanSupported(){let e=this.getBrowser(),t=nt.browserDetails.version||0;if(e===`chrome`&&t<this.minChromeVersion)return!1;if(e===`firefox`&&t>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!(`currentDirection`in RTCRtpTransceiver.prototype))return!1;let n,r=!1;try{n=new RTCPeerConnection,n.addTransceiver(`audio`),r=!0}catch{}finally{n&&n.close()}return r}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<`u`?[`iPad`,`iPhone`,`iPod`].includes(navigator.platform):!1,this.supportedBrowsers=[`firefox`,`chrome`,`safari`],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},it=e=>!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e),at=()=>Math.random().toString(36).slice(2),ot={iceServers:[{urls:`stun:stun.l.google.com:19302`},{urls:[`turn:eu-0.turn.peerjs.com:3478`,`turn:us-0.turn.peerjs.com:3478`],username:`peerjs`,credential:`peerjsp`}],sdpSemantics:`unified-plan`},E=new class extends et{noop(){}blobToArrayBuffer(e,t){let n=new FileReader;return n.onload=function(e){e.target&&t(e.target.result)},n.readAsArrayBuffer(e),n}binaryStringToArrayBuffer(e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n)&255;return t.buffer}isSecure(){return location.protocol===`https:`}constructor(...e){super(...e),this.CLOUD_HOST=`0.peerjs.com`,this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=ot,this.browser=rt.getBrowser(),this.browserVersion=rt.getVersion(),this.pack=h,this.unpack=m,this.supports=function(){let e={browser:rt.isBrowserSupported(),webRTC:rt.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!e.webRTC)return e;let t;try{t=new RTCPeerConnection(ot),e.audioVideo=!0;let n;try{n=t.createDataChannel(`_PEERJSTEST`,{ordered:!0}),e.data=!0,e.reliable=!!n.ordered;try{n.binaryType=`blob`,e.binaryBlob=!rt.isIOS}catch{}}catch{}finally{n&&n.close()}}catch{}finally{t&&t.close()}return e}(),this.validateId=it,this.randomToken=at}},D=`PeerJS: `,O=new class{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...t){let n=[D,...t];for(let e in n)n[e]instanceof Error&&(n[e]=`(`+n[e].name+`) `+n[e].message);e>=3?console.log(...n):e>=2?console.warn(`WARNING`,...n):e>=1&&console.error(`ERROR`,...n)}constructor(){this._logLevel=0}},st={},ct=Object.prototype.hasOwnProperty,k=`~`;function lt(){}Object.create&&(lt.prototype=Object.create(null),new lt().__proto__||(k=!1));function ut(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function dt(e,t,n,r,i){if(typeof n!=`function`)throw TypeError(`The listener must be a function`);var a=new ut(n,r||e,i),o=k?k+t:t;return e._events[o]?e._events[o].fn?e._events[o]=[e._events[o],a]:e._events[o].push(a):(e._events[o]=a,e._eventsCount++),e}function ft(e,t){--e._eventsCount===0?e._events=new lt:delete e._events[t]}function A(){this._events=new lt,this._eventsCount=0}A.prototype.eventNames=function(){var e=[],t,n;if(this._eventsCount===0)return e;for(n in t=this._events)ct.call(t,n)&&e.push(k?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e},A.prototype.listeners=function(e){var t=k?k+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,i=n.length,a=Array(i);r<i;r++)a[r]=n[r].fn;return a},A.prototype.listenerCount=function(e){var t=k?k+e:e,n=this._events[t];return n?n.fn?1:n.length:0},A.prototype.emit=function(e,t,n,r,i,a){var o=k?k+e:e;if(!this._events[o])return!1;var s=this._events[o],c=arguments.length,l,u;if(s.fn){switch(s.once&&this.removeListener(e,s.fn,void 0,!0),c){case 1:return s.fn.call(s.context),!0;case 2:return s.fn.call(s.context,t),!0;case 3:return s.fn.call(s.context,t,n),!0;case 4:return s.fn.call(s.context,t,n,r),!0;case 5:return s.fn.call(s.context,t,n,r,i),!0;case 6:return s.fn.call(s.context,t,n,r,i,a),!0}for(u=1,l=Array(c-1);u<c;u++)l[u-1]=arguments[u];s.fn.apply(s.context,l)}else{var d=s.length,f;for(u=0;u<d;u++)switch(s[u].once&&this.removeListener(e,s[u].fn,void 0,!0),c){case 1:s[u].fn.call(s[u].context);break;case 2:s[u].fn.call(s[u].context,t);break;case 3:s[u].fn.call(s[u].context,t,n);break;case 4:s[u].fn.call(s[u].context,t,n,r);break;default:if(!l)for(f=1,l=Array(c-1);f<c;f++)l[f-1]=arguments[f];s[u].fn.apply(s[u].context,l)}}return!0},A.prototype.on=function(e,t,n){return dt(this,e,t,n,!1)},A.prototype.once=function(e,t,n){return dt(this,e,t,n,!0)},A.prototype.removeListener=function(e,t,n,r){var i=k?k+e:e;if(!this._events[i])return this;if(!t)return ft(this,i),this;var a=this._events[i];if(a.fn)a.fn===t&&(!r||a.once)&&(!n||a.context===n)&&ft(this,i);else{for(var o=0,s=[],c=a.length;o<c;o++)(a[o].fn!==t||r&&!a[o].once||n&&a[o].context!==n)&&s.push(a[o]);s.length?this._events[i]=s.length===1?s[0]:s:ft(this,i)}return this},A.prototype.removeAllListeners=function(e){var t;return e?(t=k?k+e:e,this._events[t]&&ft(this,t)):(this._events=new lt,this._eventsCount=0),this},A.prototype.off=A.prototype.removeListener,A.prototype.addListener=A.prototype.on,A.prefixed=k,A.EventEmitter=A,st=A;var pt={};$e(pt,`ConnectionType`,()=>mt),$e(pt,`PeerErrorType`,()=>j),$e(pt,`BaseConnectionErrorType`,()=>ht),$e(pt,`DataConnectionErrorType`,()=>gt),$e(pt,`SerializationType`,()=>_t),$e(pt,`SocketEventType`,()=>M),$e(pt,`ServerMessageType`,()=>N);var mt=function(e){return e.Data=`data`,e.Media=`media`,e}({}),j=function(e){return e.BrowserIncompatible=`browser-incompatible`,e.Disconnected=`disconnected`,e.InvalidID=`invalid-id`,e.InvalidKey=`invalid-key`,e.Network=`network`,e.PeerUnavailable=`peer-unavailable`,e.SslUnavailable=`ssl-unavailable`,e.ServerError=`server-error`,e.SocketError=`socket-error`,e.SocketClosed=`socket-closed`,e.UnavailableID=`unavailable-id`,e.WebRTC=`webrtc`,e}({}),ht=function(e){return e.NegotiationFailed=`negotiation-failed`,e.ConnectionClosed=`connection-closed`,e}({}),gt=function(e){return e.NotOpenYet=`not-open-yet`,e.MessageToBig=`message-too-big`,e}({}),_t=function(e){return e.Binary=`binary`,e.BinaryUTF8=`binary-utf8`,e.JSON=`json`,e.None=`raw`,e}({}),M=function(e){return e.Message=`message`,e.Disconnected=`disconnected`,e.Error=`error`,e.Close=`close`,e}({}),N=function(e){return e.Heartbeat=`HEARTBEAT`,e.Candidate=`CANDIDATE`,e.Offer=`OFFER`,e.Answer=`ANSWER`,e.Open=`OPEN`,e.Error=`ERROR`,e.IdTaken=`ID-TAKEN`,e.InvalidKey=`INVALID-KEY`,e.Leave=`LEAVE`,e.Expire=`EXPIRE`,e}({}),vt=`1.5.5`,yt=class extends st.EventEmitter{constructor(e,t,n,r,i,a=5e3){super(),this.pingInterval=a,this._disconnected=!0,this._messagesQueue=[],this._baseUrl=(e?`wss://`:`ws://`)+t+`:`+n+r+`peerjs?key=`+i}start(e,t){this._id=e;let n=`${this._baseUrl}&id=${e}&token=${t}`;this._socket||!this._disconnected||(this._socket=new WebSocket(n+`&version=1.5.5`),this._disconnected=!1,this._socket.onmessage=e=>{let t;try{t=JSON.parse(e.data),O.log(`Server message received:`,t)}catch{O.log(`Invalid server message`,e.data);return}this.emit(M.Message,t)},this._socket.onclose=e=>{this._disconnected||(O.log(`Socket closed.`,e),this._cleanup(),this._disconnected=!0,this.emit(M.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),O.log(`Socket open`),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){O.log(`Cannot send heartbeat, because socket closed`);return}let e=JSON.stringify({type:N.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){let e=[...this._messagesQueue];this._messagesQueue=[];for(let t of e)this.send(t)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(M.Error,`Invalid message`);return}if(!this._wsOpen())return;let t=JSON.stringify(e);this._socket.send(t)}close(){this._disconnected||=(this._cleanup(),!0)}_cleanup(){this._socket&&=(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),void 0),clearTimeout(this._wsPingTimer)}},bt=class{constructor(e){this.connection=e}startConnection(e){let t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===mt.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){let n=this.connection,r={ordered:!!e.reliable},i=t.createDataChannel(n.label,r);n._initializeDataChannel(i),this._makeOffer()}else this.handleSDP(`OFFER`,e.sdp)}_startPeerConnection(){O.log(`Creating RTCPeerConnection.`);let e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){let t=this.connection.peer,n=this.connection.connectionId,r=this.connection.type,i=this.connection.provider;O.log(`Listening for ICE candidates.`),e.onicecandidate=e=>{!e.candidate||!e.candidate.candidate||(O.log(`Received ICE candidates for ${t}:`,e.candidate),i.socket.send({type:N.Candidate,payload:{candidate:e.candidate,type:r,connectionId:n},dst:t}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case`failed`:O.log(`iceConnectionState is failed, closing connections to `+t),this.connection.emitError(ht.NegotiationFailed,`Negotiation of connection to `+t+` failed.`),this.connection.close();break;case`closed`:O.log(`iceConnectionState is closed, closing connections to `+t),this.connection.emitError(ht.ConnectionClosed,`Connection to `+t+` closed.`),this.connection.close();break;case`disconnected`:O.log(`iceConnectionState changed to disconnected on the connection with `+t);break;case`completed`:e.onicecandidate=()=>{};break}this.connection.emit(`iceStateChanged`,e.iceConnectionState)},O.log(`Listening for data channel`),e.ondatachannel=e=>{O.log(`Received data channel`);let r=e.channel;i.getConnection(t,n)._initializeDataChannel(r)},O.log(`Listening for remote stream`),e.ontrack=e=>{O.log(`Received remote stream`);let r=e.streams[0],a=i.getConnection(t,n);if(a.type===mt.Media){let e=a;this._addStreamToMediaConnection(r,e)}}}cleanup(){O.log(`Cleaning up PeerConnection to `+this.connection.peer);let e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};let t=e.signalingState!==`closed`,n=!1,r=this.connection.dataChannel;r&&(n=!!r.readyState&&r.readyState!==`closed`),(t||n)&&e.close()}async _makeOffer(){let e=this.connection.peerConnection,t=this.connection.provider;try{let n=await e.createOffer(this.connection.options.constraints);O.log(`Created offer.`),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform==`function`&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp);try{await e.setLocalDescription(n),O.log(`Set localDescription:`,n,`for:${this.connection.peer}`);let r={sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===mt.Data){let e=this.connection;r={...r,label:e.label,reliable:e.reliable,serialization:e.serialization}}t.socket.send({type:N.Offer,payload:r,dst:this.connection.peer})}catch(e){e!=`OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer`&&(t.emitError(j.WebRTC,e),O.log(`Failed to setLocalDescription, `,e))}}catch(e){t.emitError(j.WebRTC,e),O.log(`Failed to createOffer, `,e)}}async _makeAnswer(){let e=this.connection.peerConnection,t=this.connection.provider;try{let n=await e.createAnswer();O.log(`Created answer.`),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform==`function`&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp);try{await e.setLocalDescription(n),O.log(`Set localDescription:`,n,`for:${this.connection.peer}`),t.socket.send({type:N.Answer,payload:{sdp:n,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(e){t.emitError(j.WebRTC,e),O.log(`Failed to setLocalDescription, `,e)}}catch(e){t.emitError(j.WebRTC,e),O.log(`Failed to create answer, `,e)}}async handleSDP(e,t){t=new RTCSessionDescription(t);let n=this.connection.peerConnection,r=this.connection.provider;O.log(`Setting remote description`,t);let i=this;try{await n.setRemoteDescription(t),O.log(`Set remoteDescription:${e} for:${this.connection.peer}`),e===`OFFER`&&await i._makeAnswer()}catch(e){r.emitError(j.WebRTC,e),O.log(`Failed to setRemoteDescription, `,e)}}async handleCandidate(e){O.log(`handleCandidate:`,e);try{await this.connection.peerConnection.addIceCandidate(e),O.log(`Added ICE candidate for:${this.connection.peer}`)}catch(e){this.connection.provider.emitError(j.WebRTC,e),O.log(`Failed to handleCandidate, `,e)}}_addTracksToConnection(e,t){if(O.log(`add tracks from stream ${e.id} to peer connection`),!t.addTrack)return O.error(`Your browser does't support RTCPeerConnection#addTrack. Ignored.`);e.getTracks().forEach(n=>{t.addTrack(n,e)})}_addStreamToMediaConnection(e,t){O.log(`add stream ${e.id} to media connection ${t.connectionId}`),t.addStream(e)}},xt=class extends st.EventEmitter{emitError(e,t){O.error(`Error:`,t),this.emit(`error`,new St(`${e}`,t))}},St=class extends Error{constructor(e,t){typeof t==`string`?super(t):(super(),Object.assign(this,t)),this.type=e}},Ct=class extends xt{get open(){return this._open}constructor(e,t,n){super(),this.peer=e,this.provider=t,this.options=n,this._open=!1,this.metadata=n.metadata}},wt=class e extends Ct{static#_=this.ID_PREFIX=`mc_`;get type(){return mt.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(t,n,r){super(t,n,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||e.ID_PREFIX+E.randomToken(),this._negotiator=new bt(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{O.log(`DC#${this.connectionId} dc connection success`),this.emit(`willCloseOnRemote`)},this.dataChannel.onclose=()=>{O.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){O.log(`Receiving stream`,e),this._remoteStream=e,super.emit(`stream`,e)}handleMessage(e){let t=e.type,n=e.payload;switch(e.type){case N.Answer:this._negotiator.handleSDP(t,n.sdp),this._open=!0;break;case N.Candidate:this._negotiator.handleCandidate(n.candidate);break;default:O.warn(`Unrecognized message type:${t} from peer:${this.peer}`);break}}answer(e,t={}){if(this._localStream){O.warn(`Local stream already exists on this MediaConnection. Are you answering a call twice?`);return}this._localStream=e,t&&t.sdpTransform&&(this.options.sdpTransform=t.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});let n=this.provider._getMessages(this.connectionId);for(let e of n)this.handleMessage(e);this._open=!0}close(){this._negotiator&&=(this._negotiator.cleanup(),null),this._localStream=null,this._remoteStream=null,this.provider&&=(this.provider._removeConnection(this),null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit(`close`))}},Tt=class{constructor(e){this._options=e}_buildRequest(e){let t=this._options.secure?`https`:`http`,{host:n,port:r,path:i,key:a}=this._options,o=new URL(`${t}://${n}:${r}${i}${a}/${e}`);return o.searchParams.set(`ts`,`${Date.now()}${Math.random()}`),o.searchParams.set(`version`,vt),fetch(o.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{let e=await this._buildRequest(`id`);if(e.status!==200)throw Error(`Error. Status:${e.status}`);return e.text()}catch(e){O.error(`Error retrieving ID`,e);let t=``;throw this._options.path===`/`&&this._options.host!==E.CLOUD_HOST&&(t=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),Error(`Could not get an ID from the server.`+t)}}async listAllPeers(){try{let e=await this._buildRequest(`peers`);if(e.status!==200){if(e.status===401){let e=``;throw e=this._options.host===E.CLOUD_HOST?`It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.`:"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",Error(`It doesn't look like you have permission to list peers IDs. `+e)}throw Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw O.error(`Error retrieving list peers`,e),Error(`Could not get list peers from the server.`+e)}}},Et=class e extends Ct{static#_=this.ID_PREFIX=`dc_`;static#_2=this.MAX_BUFFERED_AMOUNT=8388608;get type(){return mt.Data}constructor(t,n,r){super(t,n,r),this.connectionId=this.options.connectionId||e.ID_PREFIX+at(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new bt(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{O.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit(`open`)},this.dataChannel.onmessage=e=>{O.log(`DC#${this.connectionId} dc onmessage:`,e.data)},this.dataChannel.onclose=()=>{O.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e?.flush){this.send({__peerData:{type:`close`}});return}this._negotiator&&=(this._negotiator.cleanup(),null),this.provider&&=(this.provider._removeConnection(this),null),this.dataChannel&&=(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,null),this.open&&(this._open=!1,super.emit(`close`))}send(e,t=!1){if(!this.open){this.emitError(gt.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,t)}async handleMessage(e){let t=e.payload;switch(e.type){case N.Answer:await this._negotiator.handleSDP(e.type,t.sdp);break;case N.Candidate:await this._negotiator.handleCandidate(t.candidate);break;default:O.warn(`Unrecognized message type:`,e.type,`from peer:`,this.peer);break}}},Dt=class extends Et{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType=`arraybuffer`,this.dataChannel.addEventListener(`message`,e=>this._handleDataMessage(e))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>Et.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(e){return O.error(`DC#:${this.connectionId} Error when sending:`,e),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;let e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e?.flush){this.send({__peerData:{type:`close`}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}},P=class extends Dt{close(e){super.close(e),this._chunkedData={}}constructor(e,t,n){super(e,t,n),this.chunker=new et,this.serialization=_t.Binary,this._chunkedData={}}_handleDataMessage({data:e}){let t=m(e),n=t.__peerData;if(n){if(n.type===`close`){this.close();return}this._handleChunk(t);return}this.emit(`data`,t)}_handleChunk(e){let t=e.__peerData,n=this._chunkedData[t]||{data:[],count:0,total:e.total};if(n.data[e.n]=new Uint8Array(e.data),n.count++,this._chunkedData[t]=n,n.total===n.count){delete this._chunkedData[t];let e=tt(n.data);this._handleDataMessage({data:e})}}_send(e,t){let n=h(e);if(n instanceof Promise)return this._send_blob(n);if(!t&&n.byteLength>this.chunker.chunkedMTU){this._sendChunks(n);return}this._bufferedSend(n)}async _send_blob(e){let t=await e;if(t.byteLength>this.chunker.chunkedMTU){this._sendChunks(t);return}this._bufferedSend(t)}_sendChunks(e){let t=this.chunker.chunk(e);O.log(`DC#${this.connectionId} Try to send ${t.length} chunks...`);for(let e of t)this.send(e,!0)}},Ot=class extends Dt{_handleDataMessage({data:e}){super.emit(`data`,e)}_send(e,t){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=_t.None}},kt=class extends Dt{_handleDataMessage({data:e}){let t=this.parse(this.decoder.decode(e)),n=t.__peerData;if(n&&n.type===`close`){this.close();return}this.emit(`data`,t)}_send(e,t){let n=this.encoder.encode(this.stringify(e));if(n.byteLength>=E.chunkedMTU){this.emitError(gt.MessageToBig,`Message too big for JSON channel`);return}this._bufferedSend(n)}constructor(...e){super(...e),this.serialization=_t.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}},At=class e extends xt{static#_=this.DEFAULT_KEY=`peerjs`;get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){let e=Object.create(null);for(let[t,n]of this._connections)e[t]=n;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(t,n){super(),this._serializers={raw:Ot,json:kt,binary:P,"binary-utf8":P,default:P},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let r;if(t&&t.constructor==Object?n=t:t&&(r=t.toString()),n={debug:0,host:E.CLOUD_HOST,port:E.CLOUD_PORT,path:`/`,key:e.DEFAULT_KEY,token:E.randomToken(),config:E.defaultConfig,referrerPolicy:`strict-origin-when-cross-origin`,serializers:{},...n},this._options=n,this._serializers={...this._serializers,...this.options.serializers},this._options.host===`/`&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!==`/`&&(this._options.path=`/`+this._options.path),this._options.path[this._options.path.length-1]!==`/`&&(this._options.path+=`/`)),this._options.secure===void 0&&this._options.host!==E.CLOUD_HOST?this._options.secure=E.isSecure():this._options.host==E.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&O.setLogFunction(this._options.logFunction),O.logLevel=this._options.debug||0,this._api=new Tt(n),this._socket=this._createServerConnection(),!E.supports.audioVideo&&!E.supports.data){this._delayedAbort(j.BrowserIncompatible,`The current browser does not support WebRTC`);return}if(r&&!E.validateId(r)){this._delayedAbort(j.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(e=>this._initialize(e)).catch(e=>this._abort(j.ServerError,e))}_createServerConnection(){let e=new yt(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(M.Message,e=>{this._handleMessage(e)}),e.on(M.Error,e=>{this._abort(j.SocketError,e)}),e.on(M.Disconnected,()=>{this.disconnected||(this.emitError(j.Network,`Lost connection to server.`),this.disconnect())}),e.on(M.Close,()=>{this.disconnected||this._abort(j.SocketClosed,`Underlying socket is already closed.`)}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){let t=e.type,n=e.payload,r=e.src;switch(t){case N.Open:this._lastServerId=this.id,this._open=!0,this.emit(`open`,this.id);break;case N.Error:this._abort(j.ServerError,n.msg);break;case N.IdTaken:this._abort(j.UnavailableID,`ID "${this.id}" is taken`);break;case N.InvalidKey:this._abort(j.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case N.Leave:O.log(`Received leave message from ${r}`),this._cleanupPeer(r),this._connections.delete(r);break;case N.Expire:this.emitError(j.PeerUnavailable,`Could not connect to peer ${r}`);break;case N.Offer:{let e=n.connectionId,t=this.getConnection(r,e);if(t&&(t.close(),O.warn(`Offer received for existing Connection ID:${e}`)),n.type===mt.Media){let i=new wt(r,this,{connectionId:e,_payload:n,metadata:n.metadata});t=i,this._addConnection(r,t),this.emit(`call`,i)}else if(n.type===mt.Data){let i=new this._serializers[n.serialization](r,this,{connectionId:e,_payload:n,metadata:n.metadata,label:n.label,serialization:n.serialization,reliable:n.reliable});t=i,this._addConnection(r,t),this.emit(`connection`,i)}else{O.warn(`Received malformed connection type:${n.type}`);return}let i=this._getMessages(e);for(let e of i)t.handleMessage(e);break}default:{if(!n){O.warn(`You received a malformed message from ${r} of type ${t}`);return}let i=n.connectionId,a=this.getConnection(r,i);a&&a.peerConnection?a.handleMessage(e):i?this._storeMessage(i,e):O.warn(`You received an unrecognized message:`,e);break}}}_storeMessage(e,t){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(t)}_getMessages(e){let t=this._lostMessages.get(e);return t?(this._lostMessages.delete(e),t):[]}connect(e,t={}){if(t={serialization:`default`,...t},this.disconnected){O.warn(`You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available.`),this.emitError(j.Disconnected,`Cannot connect to new Peer after disconnecting from server.`);return}let n=new this._serializers[t.serialization](e,this,t);return this._addConnection(e,n),n}call(e,t,n={}){if(this.disconnected){O.warn(`You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect.`),this.emitError(j.Disconnected,`Cannot connect to new Peer after disconnecting from server.`);return}if(!t){O.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}let r=new wt(e,this,{...n,_stream:t});return this._addConnection(e,r),r}_addConnection(e,t){O.log(`add connection ${t.type}:${t.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(t)}_removeConnection(e){let t=this._connections.get(e.peer);if(t){let n=t.indexOf(e);n!==-1&&t.splice(n,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,t){let n=this._connections.get(e);if(!n)return null;for(let e of n)if(e.connectionId===t)return e;return null}_delayedAbort(e,t){setTimeout(()=>{this._abort(e,t)},0)}_abort(e,t){O.error(`Aborting!`),this.emitError(e,t),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(O.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit(`close`))}_cleanup(){for(let e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){let t=this._connections.get(e);if(t)for(let e of t)e.close()}disconnect(){if(this.disconnected)return;let e=this.id;O.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit(`disconnected`,e)}reconnect(){if(this.disconnected&&!this.destroyed)O.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else if(this.destroyed)throw Error(`This peer cannot reconnect to the server. It has already been destroyed.`);else if(!this.disconnected&&!this.open)O.error(`In a hurry? We're still trying to make the initial connection!`);else throw Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}listAllPeers(e=e=>{}){this._api.listAllPeers().then(t=>e(t)).catch(e=>this._abort(j.ServerError,e))}},jt=d(c(((e,t)=>{(function(n,r){typeof e==`object`&&t!==void 0?t.exports=r():typeof define==`function`&&define.amd?define(r):(n=typeof globalThis<`u`?globalThis:n||self).Dexie=r()})(e,function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)},t=function(){return(t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function n(e,t,n){if(n||arguments.length===2)for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||((r||=Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var r=typeof globalThis<`u`?globalThis:typeof self<`u`?self:typeof window<`u`?window:global,i=Object.keys,a=Array.isArray;function o(e,t){return typeof t!=`object`||i(t).forEach(function(n){e[n]=t[n]}),e}typeof Promise>`u`||r.Promise||(r.Promise=Promise);var s=Object.getPrototypeOf,c={}.hasOwnProperty;function l(e,t){return c.call(e,t)}function u(e,t){typeof t==`function`&&(t=t(s(e))),(typeof Reflect>`u`?i:Reflect.ownKeys)(t).forEach(function(n){f(e,n,t[n])})}var d=Object.defineProperty;function f(e,t,n,r){d(e,t,o(n&&l(n,`get`)&&typeof n.get==`function`?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function p(e){return{from:function(t){return e.prototype=Object.create(t.prototype),f(e.prototype,`constructor`,e),{extend:u.bind(null,e.prototype)}}}}var m=Object.getOwnPropertyDescriptor,h=[].slice;function g(e,t,n){return h.call(e,t,n)}function _(e,t){return t(e)}function v(e){if(!e)throw Error(`Assertion Failed`)}function y(e){r.setImmediate?setImmediate(e):setTimeout(e,0)}function b(e,t){if(typeof t==`string`&&l(e,t))return e[t];if(!t)return e;if(typeof t!=`string`){for(var n=[],r=0,i=t.length;r<i;++r){var a=b(e,t[r]);n.push(a)}return n}var o=t.indexOf(`.`);if(o!==-1){var s=e[t.substr(0,o)];return s==null?void 0:b(s,t.substr(o+1))}}function x(e,t,n){if(e&&t!==void 0&&!(`isFrozen`in Object&&Object.isFrozen(e)))if(typeof t!=`string`&&`length`in t){v(typeof n!=`string`&&`length`in n);for(var r=0,i=t.length;r<i;++r)x(e,t[r],n[r])}else{var o,s,c=t.indexOf(`.`);c===-1?n===void 0?a(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n:(o=t.substr(0,c),(s=t.substr(c+1))===``?n===void 0?a(e)&&!isNaN(parseInt(o))?e.splice(o,1):delete e[o]:e[o]=n:x(c=!(c=e[o])||!l(e,o)?e[o]={}:c,s,n))}}function ee(e){var t,n={};for(t in e)l(e,t)&&(n[t]=e[t]);return n}var te=[].concat;function ne(e){return te.apply([],e)}var re=`BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey`.split(`,`).concat(ne([8,16,32,64].map(function(e){return[`Int`,`Uint`,`Float`].map(function(t){return t+e+`Array`})}))).filter(function(e){return r[e]}),ie=new Set(re.map(function(e){return r[e]})),ae=null;function oe(e){return ae=new WeakMap,e=function e(t){if(!t||typeof t!=`object`)return t;var n=ae.get(t);if(n)return n;if(a(t)){n=[],ae.set(t,n);for(var r=0,i=t.length;r<i;++r)n.push(e(t[r]))}else if(ie.has(t.constructor))n=t;else{var o,c=s(t);for(o in n=c===Object.prototype?{}:Object.create(c),ae.set(t,n),t)l(t,o)&&(n[o]=e(t[o]))}return n}(e),ae=null,e}var se={}.toString;function ce(e){return se.call(e).slice(8,-1)}var le=typeof Symbol<`u`?Symbol.iterator:`@@iterator`,ue=typeof le==`symbol`?function(e){var t;return e!=null&&(t=e[le])&&t.apply(e)}:function(){return null};function de(e,t){return t=e.indexOf(t),0<=t&&e.splice(t,1),0<=t}var fe={};function pe(e){var t,n,r,i;if(arguments.length===1){if(a(e))return e.slice();if(this===fe&&typeof e==`string`)return[e];if(i=ue(e)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(e==null||typeof(t=e.length)!=`number`)return[e];for(n=Array(t);t--;)n[t]=e[t];return n}for(t=arguments.length,n=Array(t);t--;)n[t]=arguments[t];return n}var me=typeof Symbol<`u`?function(e){return e[Symbol.toStringTag]===`AsyncFunction`}:function(){return!1},he=[`Unknown`,`Constraint`,`Data`,`TransactionInactive`,`ReadOnly`,`Version`,`NotFound`,`InvalidState`,`InvalidAccess`,`Abort`,`Timeout`,`QuotaExceeded`,`Syntax`,`DataClone`],ge=[`Modify`,`Bulk`,`OpenFailed`,`VersionChange`,`Schema`,`Upgrade`,`InvalidTable`,`MissingAPI`,`NoSuchDatabase`,`InvalidArgument`,`SubTransaction`,`Unsupported`,`Internal`,`DatabaseClosed`,`PrematureCommit`,`ForeignAwait`].concat(he),_e={VersionChanged:`Database version changed by other database connection`,DatabaseClosed:`Database has been closed`,Abort:`Transaction aborted`,TransactionInactive:`Transaction has already completed or failed`,MissingAPI:`IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb`};function ve(e,t){this.name=e,this.message=t}function ye(e,t){return e+`. Errors: `+Object.keys(t).map(function(e){return t[e].toString()}).filter(function(e,t,n){return n.indexOf(e)===t}).join(`
`)}function be(e,t,n,r){this.failures=t,this.failedKeys=r,this.successCount=n,this.message=ye(e,t)}function xe(e,t){this.name=`BulkError`,this.failures=Object.keys(t).map(function(e){return t[e]}),this.failuresByPos=t,this.message=ye(e,this.failures)}p(ve).from(Error).extend({toString:function(){return this.name+`: `+this.message}}),p(be).from(ve),p(xe).from(ve);var Se=ge.reduce(function(e,t){return e[t]=t+`Error`,e},{}),Ce=ve,S=ge.reduce(function(e,t){var n=t+`Error`;function r(e,r){this.name=n,e?typeof e==`string`?(this.message=`${e}${r?`
 `+r:``}`,this.inner=r||null):typeof e==`object`&&(this.message=`${e.name} ${e.message}`,this.inner=e):(this.message=_e[t]||n,this.inner=null)}return p(r).from(Ce),e[t]=r,e},{});S.Syntax=SyntaxError,S.Type=TypeError,S.Range=RangeError;var we=he.reduce(function(e,t){return e[t+`Error`]=S[t],e},{}),Te=ge.reduce(function(e,t){return[`Syntax`,`Type`,`Range`].indexOf(t)===-1&&(e[t+`Error`]=S[t]),e},{});function C(){}function Ee(e){return e}function De(e,t){return e==null||e===Ee?t:function(n){return t(e(n))}}function Oe(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function ke(e,t){return e===C?t:function(){var n=e.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?Oe(r,this.onsuccess):r),i&&(this.onerror=this.onerror?Oe(i,this.onerror):i),a===void 0?n:a}}function Ae(e,t){return e===C?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?Oe(n,this.onsuccess):n),r&&(this.onerror=this.onerror?Oe(r,this.onerror):r)}}function je(e,t){return e===C?t:function(n){var r=e.apply(this,arguments);o(n,r);var i=this.onsuccess,a=this.onerror;return this.onsuccess=null,this.onerror=null,n=t.apply(this,arguments),i&&(this.onsuccess=this.onsuccess?Oe(i,this.onsuccess):i),a&&(this.onerror=this.onerror?Oe(a,this.onerror):a),r===void 0?n===void 0?void 0:n:o(r,n)}}function Me(e,t){return e===C?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function Ne(e,t){return e===C?t:function(){var n=e.apply(this,arguments);if(n&&typeof n.then==`function`){for(var r=this,i=arguments.length,a=Array(i);i--;)a[i]=arguments[i];return n.then(function(){return t.apply(r,a)})}return t.apply(this,arguments)}}Te.ModifyError=be,Te.DexieError=ve,Te.BulkError=xe;var Pe=typeof location<`u`&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Fe(e){Pe=e}var Ie={},Le=100,re=typeof Promise>`u`?[]:function(){var e=Promise.resolve();if(typeof crypto>`u`||!crypto.subtle)return[e,s(e),e];var t=crypto.subtle.digest(`SHA-512`,new Uint8Array([0]));return[t,s(t),e]}(),he=re[0],ge=re[1],re=re[2],ge=ge&&ge.then,Re=he&&he.constructor,ze=!!re,Be=function(e,t){qe.push([e,t]),He&&=(queueMicrotask(nt),!1)},Ve=!0,He=!0,Ue=[],We=[],Ge=Ee,Ke={id:`global`,global:!0,ref:0,unhandleds:[],onunhandled:C,pgp:!1,env:{},finalize:C},w=Ke,qe=[],Je=0,Ye=[];function T(e){if(typeof this!=`object`)throw TypeError(`Promises must be constructed via new`);this._listeners=[],this._lib=!1;var t=this._PSD=w;if(typeof e!=`function`){if(e!==Ie)throw TypeError(`Not a function`);this._state=arguments[1],this._value=arguments[2],!1===this._state&&Qe(this,this._value);return}this._state=null,this._value=null,++t.ref,function e(t,n){try{n(function(n){if(t._state===null){if(n===t)throw TypeError(`A promise cannot be resolved with itself.`);var r=t._lib&&rt();n&&typeof n.then==`function`?e(t,function(e,t){n instanceof T?n._then(e,t):n.then(e,t)}):(t._state=!0,t._value=n,$e(t)),r&&it()}},Qe.bind(null,t))}catch(e){Qe(t,e)}}(this,e)}var Xe={get:function(){var e=w,t=k;function n(n,r){var i=this,a=!e.global&&(e!==w||t!==k),o=a&&!ft(),s=new T(function(t,s){et(i,new Ze(gt(n,e,a,o),gt(r,e,a,o),t,s,e))});return this._consoleTask&&(s._consoleTask=this._consoleTask),s}return n.prototype=Ie,n},set:function(e){f(this,`then`,e&&e.prototype===Ie?Xe:{get:function(){return e},set:Xe.set})}};function Ze(e,t,n,r,i){this.onFulfilled=typeof e==`function`?e:null,this.onRejected=typeof t==`function`?t:null,this.resolve=n,this.reject=r,this.psd=i}function Qe(e,t){var n,r;We.push(t),e._state===null&&(n=e._lib&&rt(),t=Ge(t),e._state=!1,e._value=t,r=e,Ue.some(function(e){return e._value===r._value})||Ue.push(r),$e(e),n&&it())}function $e(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)et(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),Je===0&&(++Je,Be(function(){--Je==0&&at()},[]))}function et(e,t){if(e._state!==null){var n=e._state?t.onFulfilled:t.onRejected;if(n===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Je,Be(tt,[n,e,t])}else e._listeners.push(t)}function tt(e,t,n){try{var r,i=t._value;!t._state&&We.length&&(We=[]),r=Pe&&t._consoleTask?t._consoleTask.run(function(){return e(i)}):e(i),t._state||We.indexOf(i)!==-1||function(e){for(var t=Ue.length;t;)if(Ue[--t]._value===e._value)return Ue.splice(t,1)}(t),n.resolve(r)}catch(e){n.reject(e)}finally{--Je==0&&at(),--n.psd.ref||n.psd.finalize()}}function nt(){ht(Ke,function(){rt()&&it()})}function rt(){var e=Ve;return He=Ve=!1,e}function it(){var e,t,n;do for(;0<qe.length;)for(e=qe,qe=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}while(0<qe.length);He=Ve=!0}function at(){var e=Ue;Ue=[],e.forEach(function(e){e._PSD.onunhandled.call(null,e._value,e)});for(var t=Ye.slice(0),n=t.length;n;)t[--n]()}function ot(e){return new T(Ie,!1,e)}function E(e,t){var n=w;return function(){var r=rt(),i=w;try{return mt(n,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{mt(i,!1),r&&it()}}}u(T.prototype,{then:Xe,_then:function(e,t){et(this,new Ze(null,null,e,t,w))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=e,n=arguments[1];return typeof t==`function`?this.then(null,function(e){return(e instanceof t?n:ot)(e)}):this.then(null,function(e){return(e&&e.name===t?n:ot)(e)})},finally:function(e){return this.then(function(t){return T.resolve(e()).then(function(){return t})},function(t){return T.resolve(e()).then(function(){return ot(t)})})},timeout:function(e,t){var n=this;return e<1/0?new T(function(r,i){var a=setTimeout(function(){return i(new S.Timeout(t))},e);n.then(r,i).finally(clearTimeout.bind(null,a))}):this}}),typeof Symbol<`u`&&Symbol.toStringTag&&f(T.prototype,Symbol.toStringTag,`Dexie.Promise`),Ke.env=j(),u(T,{all:function(){var e=pe.apply(null,arguments).map(A);return new T(function(t,n){e.length===0&&t([]);var r=e.length;e.forEach(function(i,a){return T.resolve(i).then(function(n){e[a]=n,--r||t(e)},n)})})},resolve:function(e){return e instanceof T?e:e&&typeof e.then==`function`?new T(function(t,n){e.then(t,n)}):new T(Ie,!0,e)},reject:ot,race:function(){var e=pe.apply(null,arguments).map(A);return new T(function(t,n){e.map(function(e){return T.resolve(e).then(t,n)})})},PSD:{get:function(){return w},set:function(e){return w=e}},totalEchoes:{get:function(){return k}},newPSD:ut,usePSD:ht,scheduler:{get:function(){return Be},set:function(e){Be=e}},rejectionMapper:{get:function(){return Ge},set:function(e){Ge=e}},follow:function(e,t){return new T(function(n,r){return ut(function(t,n){var r=w;r.unhandleds=[],r.onunhandled=n,r.finalize=Oe(function(){var e,r=this;e=function(){r.unhandleds.length===0?t():n(r.unhandleds[0])},Ye.push(function t(){e(),Ye.splice(Ye.indexOf(t),1)}),++Je,Be(function(){--Je==0&&at()},[])},r.finalize),e()},t,n,r)})}}),Re&&(Re.allSettled&&f(T,`allSettled`,function(){var e=pe.apply(null,arguments).map(A);return new T(function(t){e.length===0&&t([]);var n=e.length,r=Array(n);e.forEach(function(e,i){return T.resolve(e).then(function(e){return r[i]={status:`fulfilled`,value:e}},function(e){return r[i]={status:`rejected`,reason:e}}).then(function(){return--n||t(r)})})})}),Re.any&&typeof AggregateError<`u`&&f(T,`any`,function(){var e=pe.apply(null,arguments).map(A);return new T(function(t,n){e.length===0&&n(AggregateError([]));var r=e.length,i=Array(r);e.forEach(function(e,a){return T.resolve(e).then(function(e){return t(e)},function(e){i[a]=e,--r||n(AggregateError(i))})})})}),Re.withResolvers&&(T.withResolvers=Re.withResolvers));var D={awaits:0,echoes:0,id:0},O=0,st=[],ct=0,k=0,lt=0;function ut(e,t,n,r){var i=w,a=Object.create(i);return a.parent=i,a.ref=0,a.global=!1,a.id=++lt,Ke.env,a.env=ze?{Promise:T,PromiseProp:{value:T,configurable:!0,writable:!0},all:T.all,race:T.race,allSettled:T.allSettled,any:T.any,resolve:T.resolve,reject:T.reject}:{},t&&o(a,t),++i.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()},r=ht(a,e,n,r),a.ref===0&&a.finalize(),r}function dt(){return D.id||=++O,++D.awaits,D.echoes+=Le,D.id}function ft(){return!!D.awaits&&(--D.awaits==0&&(D.id=0),D.echoes=D.awaits*Le,!0)}function A(e){return D.echoes&&e&&e.constructor===Re?(dt(),e.then(function(e){return ft(),e},function(e){return ft(),M(e)})):e}function pt(){var e=st[st.length-1];st.pop(),mt(e,!1)}function mt(e,t){var n,i=w;(t?!D.echoes||ct++&&e===w:!ct||--ct&&e===w)||queueMicrotask(t?function(e){++k,D.echoes&&--D.echoes!=0||(D.echoes=D.awaits=D.id=0),st.push(w),mt(e,!0)}.bind(null,e):pt),e!==w&&(w=e,i===Ke&&(Ke.env=j()),ze&&(n=Ke.env.Promise,t=e.env,(i.global||e.global)&&(Object.defineProperty(r,`Promise`,t.PromiseProp),n.all=t.all,n.race=t.race,n.resolve=t.resolve,n.reject=t.reject,t.allSettled&&(n.allSettled=t.allSettled),t.any&&(n.any=t.any))))}function j(){var e=r.Promise;return ze?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(r,`Promise`),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function ht(e,t,n,r,i){var a=w;try{return mt(e,!0),t(n,r,i)}finally{mt(a,!1)}}function gt(e,t,n,r){return typeof e==`function`?function(){var i=w;n&&dt(),mt(t,!0);try{return e.apply(this,arguments)}finally{mt(i,!1),r&&queueMicrotask(ft)}}:e}function _t(e){Promise===Re&&D.echoes===0?ct===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}(``+ge).indexOf(`[native code]`)===-1&&(dt=ft=C);var M=T.reject,N=``,vt=`Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.`,yt=`String expected.`,bt=[],xt=`__dbnames`,St=`readonly`,Ct=`readwrite`;function wt(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var Tt={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Et(e){return typeof e!=`string`||/\./.test(e)?function(e){return e}:function(t){return t[e]===void 0&&e in t&&delete(t=oe(t))[e],t}}function Dt(){throw S.Type(`Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.`)}function P(e,t){try{var n=Ot(e),r=Ot(t);if(n!==r)return n===`Array`?1:r===`Array`?-1:n===`binary`?1:r===`binary`?-1:n===`string`?1:r===`string`?-1:n===`Date`?1:r===`Date`?-1:NaN;switch(n){case`number`:case`Date`:case`string`:return t<e?1:e<t?-1:0;case`binary`:return function(e,t){for(var n=e.length,r=t.length,i=n<r?n:r,a=0;a<i;++a)if(e[a]!==t[a])return e[a]<t[a]?-1:1;return n===r?0:n<r?-1:1}(kt(e),kt(t));case`Array`:return function(e,t){for(var n=e.length,r=t.length,i=n<r?n:r,a=0;a<i;++a){var o=P(e[a],t[a]);if(o!==0)return o}return n===r?0:n<r?-1:1}(e,t)}}catch{}return NaN}function Ot(e){var t=typeof e;return t==`object`?ArrayBuffer.isView(e)?`binary`:(e=ce(e),e===`ArrayBuffer`?`binary`:e):t}function kt(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}function At(e,t,n){var r=e.schema.yProps;return r?(t&&0<n.numFailures&&(t=t.filter(function(e,t){return!n.failures[t]})),Promise.all(r.map(function(n){return n=n.updatesTable,t?e.db.table(n).where(`k`).anyOf(t).delete():e.db.table(n).clear()})).then(function(){return n})):n}var jt=(Mt.prototype.execute=function(e){var t=this[`@@propmod`];if(t.add!==void 0){var r=t.add;if(a(r))return n(n([],a(e)?e:[],!0),r,!0).sort();if(typeof r==`number`)return(Number(e)||0)+r;if(typeof r==`bigint`)try{return BigInt(e)+r}catch{return BigInt(0)+r}throw TypeError(`Invalid term ${r}`)}if(t.remove!==void 0){var i=t.remove;if(a(i))return a(e)?e.filter(function(e){return!i.includes(e)}).sort():[];if(typeof i==`number`)return Number(e)-i;if(typeof i==`bigint`)try{return BigInt(e)-i}catch{return BigInt(0)-i}throw TypeError(`Invalid subtrahend ${i}`)}return r=(r=t.replacePrefix)?.[0],r&&typeof e==`string`&&e.startsWith(r)?t.replacePrefix[1]+e.substring(r.length):e},Mt);function Mt(e){this[`@@propmod`]=e}function Nt(e,t){for(var n=i(t),r=n.length,a=!1,o=0;o<r;++o){var s=n[o],c=t[s],l=b(e,s);c instanceof jt?(x(e,s,c.execute(l)),a=!0):l!==c&&(x(e,s,c),a=!0)}return a}var Pt=(F.prototype._trans=function(e,t,n){var r=this._tx||w.trans,i=this.name,a=Pe&&typeof console<`u`&&console.createTask&&console.createTask(`Dexie: ${e===`readonly`?`read`:`write`} ${this.name}`);function o(e,n,r){if(!r.schema[i])throw new S.NotFound(`Table `+i+` not part of transaction`);return t(r.idbtrans,r)}var s=rt();try{var c=r&&r.db._novip===this.db._novip?r===w.trans?r._promise(e,o,n):ut(function(){return r._promise(e,o,n)},{trans:r,transless:w.transless||w}):function e(t,n,r,i){if(t.idbdb&&(t._state.openComplete||w.letThrough||t._vip)){var a=t._createTransaction(n,r,t._dbSchema);try{a.create(),t._state.PR1398_maxLoop=3}catch(a){return a.name===Se.InvalidState&&t.isOpen()&&0<--t._state.PR1398_maxLoop?(console.warn(`Dexie: Need to reopen db`),t.close({disableAutoOpen:!1}),t.open().then(function(){return e(t,n,r,i)})):M(a)}return a._promise(n,function(e,t){return ut(function(){return w.trans=a,i(e,t,a)})}).then(function(e){if(n===`readwrite`)try{a.idbtrans.commit()}catch{}return n===`readonly`?e:a._completion.then(function(){return e})})}if(t._state.openComplete)return M(new S.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return M(new S.DatabaseClosed);t.open().catch(C)}return t._state.dbReadyPromise.then(function(){return e(t,n,r,i)})}(this.db,e,[this.name],o);return a&&(c._consoleTask=a,c=c.catch(function(e){return console.trace(e),M(e)})),c}finally{s&&it()}},F.prototype.get=function(e,t){var n=this;return e&&e.constructor===Object?this.where(e).first(t):e==null?M(new S.Type(`Invalid argument to Table.get()`)):this._trans(`readonly`,function(t){return n.core.get({trans:t,key:e}).then(function(e){return n.hook.reading.fire(e)})}).then(t)},F.prototype.where=function(e){if(typeof e==`string`)return new this.db.WhereClause(this,e);if(a(e))return new this.db.WhereClause(this,`[${e.join(`+`)}]`);var t=i(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(e){if(e.compound&&t.every(function(t){return 0<=e.keyPath.indexOf(t)})){for(var n=0;n<t.length;++n)if(t.indexOf(e.keyPath[n])===-1)return!1;return!0}return!1}).sort(function(e,t){return e.keyPath.length-t.keyPath.length})[0];if(n&&this.db._maxKey!==N){var r=n.keyPath.slice(0,t.length);return this.where(r).equals(r.map(function(t){return e[t]}))}!n&&Pe&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit from a compound index [${t.join(`+`)}]`);var o=this.schema.idxByName;function s(e,t){return P(e,t)===0}var c=t.reduce(function(t,n){var r=t[0],i=t[1],t=o[n],c=e[n];return[r||t,r||!t?wt(i,t&&t.multi?function(e){return e=b(e,n),a(e)&&e.some(function(e){return s(c,e)})}:function(e){return s(c,b(e,n))}):i]},[null,null]),r=c[0],c=c[1];return r?this.where(r.name).equals(e[r.keyPath]).filter(c):n?this.filter(c):this.where(t).equals(``)},F.prototype.filter=function(e){return this.toCollection().and(e)},F.prototype.count=function(e){return this.toCollection().count(e)},F.prototype.offset=function(e){return this.toCollection().offset(e)},F.prototype.limit=function(e){return this.toCollection().limit(e)},F.prototype.each=function(e){return this.toCollection().each(e)},F.prototype.toArray=function(e){return this.toCollection().toArray(e)},F.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},F.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,a(e)?`[${e.join(`+`)}]`:e))},F.prototype.reverse=function(){return this.toCollection().reverse()},F.prototype.mapToClass=function(t){var n,r=this.db,i=this.name;function a(){return n!==null&&n.apply(this,arguments)||this}(this.schema.mappedClass=t).prototype instanceof Dt&&(function(t,n){if(typeof n!=`function`&&n!==null)throw TypeError(`Class extends value `+String(n)+` is not a constructor or null`);function r(){this.constructor=t}e(t,n),t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}(a,n=t),Object.defineProperty(a.prototype,`db`,{get:function(){return r},enumerable:!1,configurable:!0}),a.prototype.table=function(){return i},t=a);for(var o=new Set,c=t.prototype;c;c=s(c))Object.getOwnPropertyNames(c).forEach(function(e){return o.add(e)});function l(e){if(!e)return e;var n,r=Object.create(t.prototype);for(n in e)if(!o.has(n))try{r[n]=e[n]}catch{}return r}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=l,this.hook(`reading`,l),t},F.prototype.defineClass=function(){return this.mapToClass(function(e){o(this,e)})},F.prototype.add=function(e,t){var n=this,r=this.schema.primKey,i=r.auto,a=r.keyPath,o=e;return a&&i&&(o=Et(a)(e)),this._trans(`readwrite`,function(e){return n.core.mutate({trans:e,type:`add`,keys:t==null?null:[t],values:[o]})}).then(function(e){return e.numFailures?T.reject(e.failures[0]):e.lastResult}).then(function(t){if(a)try{x(e,a,t)}catch{}return t})},F.prototype.upsert=function(e,t){var n=this,r=this.schema.primKey.keyPath;return this._trans(`readwrite`,function(i){return n.core.get({trans:i,key:e}).then(function(a){var o=a??{};return Nt(o,t),r&&x(o,r,e),n.core.mutate({trans:i,type:`put`,values:[o],keys:[e],upsert:!0,updates:{keys:[e],changeSpecs:[t]}}).then(function(e){return e.numFailures?T.reject(e.failures[0]):!!a})})})},F.prototype.update=function(e,t){return typeof e!=`object`||a(e)?this.where(`:id`).equals(e).modify(t):(e=b(e,this.schema.primKey.keyPath),e===void 0?M(new S.InvalidArgument(`Given object does not contain its primary key`)):this.where(`:id`).equals(e).modify(t))},F.prototype.put=function(e,t){var n=this,r=this.schema.primKey,i=r.auto,a=r.keyPath,o=e;return a&&i&&(o=Et(a)(e)),this._trans(`readwrite`,function(e){return n.core.mutate({trans:e,type:`put`,values:[o],keys:t==null?null:[t]})}).then(function(e){return e.numFailures?T.reject(e.failures[0]):e.lastResult}).then(function(t){if(a)try{x(e,a,t)}catch{}return t})},F.prototype.delete=function(e){var t=this;return this._trans(`readwrite`,function(n){return t.core.mutate({trans:n,type:`delete`,keys:[e]}).then(function(n){return At(t,[e],n)}).then(function(e){return e.numFailures?T.reject(e.failures[0]):void 0})})},F.prototype.clear=function(){var e=this;return this._trans(`readwrite`,function(t){return e.core.mutate({trans:t,type:`deleteRange`,range:Tt}).then(function(t){return At(e,null,t)})}).then(function(e){return e.numFailures?T.reject(e.failures[0]):void 0})},F.prototype.bulkGet=function(e){var t=this;return this._trans(`readonly`,function(n){return t.core.getMany({keys:e,trans:n}).then(function(e){return e.map(function(e){return t.hook.reading.fire(e)})})})},F.prototype.bulkAdd=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,a=(n||=i?void 0:t)?n.allKeys:void 0;return this._trans(`readwrite`,function(t){var n=r.schema.primKey,o=n.auto,n=n.keyPath;if(n&&i)throw new S.InvalidArgument(`bulkAdd(): keys argument invalid on tables with inbound keys`);if(i&&i.length!==e.length)throw new S.InvalidArgument(`Arguments objects and keys must have the same length`);var s=e.length,n=n&&o?e.map(Et(n)):e;return r.core.mutate({trans:t,type:`add`,keys:i,values:n,wantResults:a}).then(function(e){var t=e.numFailures,n=e.results,i=e.lastResult,e=e.failures;if(t===0)return a?n:i;throw new xe(`${r.name}.bulkAdd(): ${t} of ${s} operations failed`,e)})})},F.prototype.bulkPut=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,a=(n||=i?void 0:t)?n.allKeys:void 0;return this._trans(`readwrite`,function(t){var n=r.schema.primKey,o=n.auto,n=n.keyPath;if(n&&i)throw new S.InvalidArgument(`bulkPut(): keys argument invalid on tables with inbound keys`);if(i&&i.length!==e.length)throw new S.InvalidArgument(`Arguments objects and keys must have the same length`);var s=e.length,n=n&&o?e.map(Et(n)):e;return r.core.mutate({trans:t,type:`put`,keys:i,values:n,wantResults:a}).then(function(e){var t=e.numFailures,n=e.results,i=e.lastResult,e=e.failures;if(t===0)return a?n:i;throw new xe(`${r.name}.bulkPut(): ${t} of ${s} operations failed`,e)})})},F.prototype.bulkUpdate=function(e){var t=this,n=this.core,r=e.map(function(e){return e.key}),i=e.map(function(e){return e.changes}),a=[];return this._trans(`readwrite`,function(o){return n.getMany({trans:o,keys:r,cache:`clone`}).then(function(s){var c=[],l=[];e.forEach(function(e,n){var r=e.key,i=e.changes,o=s[n];if(o){for(var u=0,d=Object.keys(i);u<d.length;u++){var f=d[u],p=i[f];if(f===t.schema.primKey.keyPath){if(P(p,r)!==0)throw new S.Constraint(`Cannot update primary key in bulkUpdate()`)}else x(o,f,p)}a.push(n),c.push(r),l.push(o)}});var u=c.length;return n.mutate({trans:o,type:`put`,keys:c,values:l,updates:{keys:r,changeSpecs:i}}).then(function(e){var n=e.numFailures,r=e.failures;if(n===0)return u;for(var i=0,o=Object.keys(r);i<o.length;i++){var s,c=o[i],l=a[Number(c)];l!=null&&(s=r[c],delete r[c],r[l]=s)}throw new xe(`${t.name}.bulkUpdate(): ${n} of ${u} operations failed`,r)})})})},F.prototype.bulkDelete=function(e){var t=this,n=e.length;return this._trans(`readwrite`,function(n){return t.core.mutate({trans:n,type:`delete`,keys:e}).then(function(n){return At(t,e,n)})}).then(function(e){var r=e.numFailures,i=e.lastResult,e=e.failures;if(r===0)return i;throw new xe(`${t.name}.bulkDelete(): ${r} of ${n} operations failed`,e)})},F);function F(){}function Ft(e){function t(t,r){if(r){for(var i=arguments.length,a=Array(i-1);--i;)a[i-1]=arguments[i];return n[t].subscribe.apply(null,a),e}if(typeof t==`string`)return n[t]}var n={};t.addEventType=s;for(var r=1,o=arguments.length;r<o;++r)s(arguments[r]);return t;function s(e,r,o){if(typeof e!=`object`){var c;r||=Me;var l={subscribers:[],fire:o||=C,subscribe:function(e){l.subscribers.indexOf(e)===-1&&(l.subscribers.push(e),l.fire=r(l.fire,e))},unsubscribe:function(e){l.subscribers=l.subscribers.filter(function(t){return t!==e}),l.fire=l.subscribers.reduce(r,o)}};return n[e]=t[e]=l}i(c=e).forEach(function(e){var t=c[e];if(a(t))s(e,c[e][0],c[e][1]);else{if(t!==`asap`)throw new S.InvalidArgument(`Invalid event config`);var n=s(e,Ee,function(){for(var e=arguments.length,t=Array(e);e--;)t[e]=arguments[e];n.subscribers.forEach(function(e){y(function(){e.apply(null,t)})})})}})}}function It(e,t){return p(t).from({prototype:e}),t}function Lt(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Rt(e,t){e.filter=wt(e.filter,t)}function zt(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return wt(r(),t())}:t,e.justLimit=n&&!r}function Bt(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new S.Schema(`KeyPath `+e.index+` on object store `+t.name+` is not indexed`);return n}function Vt(e,t,n){var r=Bt(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:e.dir===`prev`,unique:!!e.unique,query:{index:r,range:e.range}})}function Ht(e,t,n,r){var i=e.replayFilter?wt(e.filter,e.replayFilter()):e.filter;if(e.or){var a={},o=function(e,n,r){var o,s;i&&!i(n,r,function(e){return n.stop(e)},function(e){return n.fail(e)})||((s=``+(o=n.primaryKey))==`[object ArrayBuffer]`&&(s=``+new Uint8Array(o)),l(a,s)||(a[s]=!0,t(e,n,r)))};return Promise.all([e.or._iterate(o,n),Ut(Vt(e,r,n),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}return Ut(Vt(e,r,n),wt(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function Ut(e,t,n,r){var i=E(r?function(e,t,i){return n(r(e),t,i)}:n);return e.then(function(e){if(e)return e.start(function(){var n=function(){return e.continue()};t&&!t(e,function(e){return n=e},function(t){e.stop(t),n=C},function(t){e.fail(t),n=C})||i(e.value,e,function(e){return n=e}),n()})})}var Wt=(I.prototype._read=function(e,t){var n=this._ctx;return n.error?n.table._trans(null,M.bind(null,n.error)):n.table._trans(`readonly`,e).then(t)},I.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,M.bind(null,t.error)):t.table._trans(`readwrite`,e,`locked`)},I.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=wt(t.algorithm,e)},I.prototype._iterate=function(e,t){return Ht(this._ctx,e,t,this._ctx.table.core)},I.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&o(n,e),t._ctx=n,t},I.prototype.raw=function(){return this._ctx.valueMapper=null,this},I.prototype.each=function(e){var t=this._ctx;return this._read(function(n){return Ht(t,e,n,t.table.core)})},I.prototype.count=function(e){var t=this;return this._read(function(e){var n=t._ctx,r=n.table.core;if(Lt(n,!0))return r.count({trans:e,query:{index:Bt(n,r.schema),range:n.range}}).then(function(e){return Math.min(e,n.limit)});var i=0;return Ht(n,function(){return++i,!1},e,r).then(function(){return i})}).then(e)},I.prototype.sortBy=function(e,t){var n=e.split(`.`).reverse(),r=n[0],i=n.length-1;function a(e,t){return t?a(e[n[t]],t-1):e[r]}var o=this._ctx.dir===`next`?1:-1;function s(e,t){return P(a(e,i),a(t,i))*o}return this.toArray(function(e){return e.sort(s)}).then(t)},I.prototype.toArray=function(e){var t=this;return this._read(function(e){var n=t._ctx;if(n.dir===`next`&&Lt(n,!0)&&0<n.limit){var r=n.valueMapper,i=Bt(n,n.table.core.schema);return n.table.core.query({trans:e,limit:n.limit,values:!0,query:{index:i,range:n.range}}).then(function(e){return e=e.result,r?e.map(r):e})}var a=[];return Ht(n,function(e){return a.push(e)},e,n.table.core).then(function(){return a})},e)},I.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,Lt(t)?zt(t,function(){var t=e;return function(e,n){return t===0||(t===1?--t:n(function(){e.advance(t),t=0}),!1)}}):zt(t,function(){var t=e;return function(){return--t<0}})),this},I.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),zt(this._ctx,function(){var t=e;return function(e,n,r){return--t<=0&&n(r),0<=t}},!0),this},I.prototype.until=function(e,t){return Rt(this._ctx,function(n,r,i){return!e(n.value)||(r(i),t)}),this},I.prototype.first=function(e){return this.limit(1).toArray(function(e){return e[0]}).then(e)},I.prototype.last=function(e){return this.reverse().first(e)},I.prototype.filter=function(e){var t;return Rt(this._ctx,function(t){return e(t.value)}),(t=this._ctx).isMatch=wt(t.isMatch,e),this},I.prototype.and=function(e){return this.filter(e)},I.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},I.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir===`prev`?`next`:`prev`,this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},I.prototype.desc=function(){return this.reverse()},I.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(t,n){e(n.key,n)})},I.prototype.eachUniqueKey=function(e){return this._ctx.unique=`unique`,this.eachKey(e)},I.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(t,n){e(n.primaryKey,n)})},I.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each(function(e,t){n.push(t.key)}).then(function(){return n}).then(e)},I.prototype.primaryKeys=function(e){var t=this._ctx;if(t.dir===`next`&&Lt(t,!0)&&0<t.limit)return this._read(function(e){var n=Bt(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:n,range:t.range}})}).then(function(e){return e.result}).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each(function(e,t){n.push(t.primaryKey)}).then(function(){return n}).then(e)},I.prototype.uniqueKeys=function(e){return this._ctx.unique=`unique`,this.keys(e)},I.prototype.firstKey=function(e){return this.limit(1).keys(function(e){return e[0]}).then(e)},I.prototype.lastKey=function(e){return this.reverse().firstKey(e)},I.prototype.distinct=function(){var e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];if(!e||!e.multi)return this;var t={};return Rt(this._ctx,function(e){var n=e.primaryKey.toString(),e=l(t,n);return t[n]=!0,!e}),this},I.prototype.modify=function(e){var t=this,n=this._ctx;return this._write(function(r){var a=typeof e==`function`?e:function(t){return Nt(t,e)},o=n.table.core,s=o.schema.primaryKey,c=s.outbound,l=s.extractKey,u=200,s=t.db._options.modifyChunkSize;s&&(u=typeof s==`object`?s[o.name]||s[`*`]||200:s);function d(e,t){var n=t.failures,t=t.numFailures;p+=e-t;for(var r=0,a=i(n);r<a.length;r++){var o=a[r];f.push(n[o])}}var f=[],p=0,m=[],h=e===Gt;return t.clone().primaryKeys().then(function(t){function i(f){var p=Math.min(u,t.length-f),m=t.slice(f,f+p);return(h?Promise.resolve([]):o.getMany({trans:r,keys:m,cache:`immutable`})).then(function(g){var _=[],v=[],y=c?[]:null,b=h?m:[];if(!h)for(var x=0;x<p;++x){var ee=g[x],te={value:oe(ee),primKey:t[f+x]};!1!==a.call(te,te.value,te)&&(te.value==null?b.push(t[f+x]):c||P(l(ee),l(te.value))===0?(v.push(te.value),c&&y.push(t[f+x])):(b.push(t[f+x]),_.push(te.value)))}return Promise.resolve(0<_.length&&o.mutate({trans:r,type:`add`,values:_}).then(function(e){for(var t in e.failures)b.splice(parseInt(t),1);d(_.length,e)})).then(function(){return(0<v.length||s&&typeof e==`object`)&&o.mutate({trans:r,type:`put`,keys:y,values:v,criteria:s,changeSpec:typeof e!=`function`&&e,isAdditionalChunk:0<f}).then(function(e){return d(v.length,e)})}).then(function(){return(0<b.length||s&&h)&&o.mutate({trans:r,type:`delete`,keys:b,criteria:s,isAdditionalChunk:0<f}).then(function(e){return At(n.table,b,e)}).then(function(e){return d(b.length,e)})}).then(function(){return t.length>f+p&&i(f+u)})})}var s=Lt(n)&&n.limit===1/0&&(typeof e!=`function`||h)&&{index:n.index,range:n.range};return i(0).then(function(){if(0<f.length)throw new be(`Error modifying one or more objects`,f,p,m);return t.length})})})},I.prototype.delete=function(){var e=this._ctx,t=e.range;return!Lt(e)||e.table.schema.yProps||!e.isPrimKey&&t.type!==3?this.modify(Gt):this._write(function(n){var r=e.table.core.schema.primaryKey,i=t;return e.table.core.count({trans:n,query:{index:r,range:i}}).then(function(t){return e.table.core.mutate({trans:n,type:`deleteRange`,range:i}).then(function(e){var n=e.failures,e=e.numFailures;if(e)throw new be(`Could not delete some values`,Object.keys(n).map(function(e){return n[e]}),t-e);return t-e})})})},I);function I(){}var Gt=function(e,t){return t.value=null};function Kt(e,t){return e<t?-1:e===t?0:1}function qt(e,t){return t<e?-1:e===t?0:1}function Jt(e,t,n){return e=e instanceof $t?new e.Collection(e):e,e._ctx.error=new(n||TypeError)(t),e}function Yt(e){return new e.Collection(e,function(){return Qt(``)}).limit(0)}function Xt(e,t,n,r){var i,a,o,s,c,l,u,d=n.length;if(!n.every(function(e){return typeof e==`string`}))return Jt(e,yt);function f(e){i=e===`next`?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()},a=e===`next`?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()},o=e===`next`?Kt:qt;var t=n.map(function(e){return{lower:a(e),upper:i(e)}}).sort(function(e,t){return o(e.lower,t.lower)});s=t.map(function(e){return e.upper}),c=t.map(function(e){return e.lower}),u=(l=e)===`next`?``:r}f(`next`),e=new e.Collection(e,function(){return Zt(s[0],c[d-1]+r)}),e._ondirectionchange=function(e){f(e)};var p=0;return e._addAlgorithm(function(e,n,r){var i=e.key;if(typeof i!=`string`)return!1;var f=a(i);if(t(f,c,p))return!0;for(var m=null,h=p;h<d;++h){var g=function(e,t,n,r,i,a){for(var o=Math.min(e.length,r.length),s=-1,c=0;c<o;++c){var l=t[c];if(l!==r[c])return i(e[c],n[c])<0?e.substr(0,c)+n[c]+n.substr(c+1):i(e[c],r[c])<0?e.substr(0,c)+r[c]+n.substr(c+1):0<=s?e.substr(0,s)+t[s]+n.substr(s+1):null;i(e[c],l)<0&&(s=c)}return o<r.length&&a===`next`?e+n.substr(e.length):o<e.length&&a===`prev`?e.substr(0,n.length):s<0?null:e.substr(0,s)+r[s]+n.substr(s+1)}(i,f,s[h],c[h],o,l);g===null&&m===null?p=h+1:(m===null||0<o(m,g))&&(m=g)}return n(m===null?r:function(){e.continue(m+u)}),!1}),e}function Zt(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function Qt(e){return{type:1,lower:e,upper:e}}var $t=(Object.defineProperty(L.prototype,`Collection`,{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),L.prototype.between=function(e,t,n,r){n=!1!==n,r=!0===r;try{return 0<this._cmp(e,t)||this._cmp(e,t)===0&&(n||r)&&(!n||!r)?Yt(this):new this.Collection(this,function(){return Zt(e,t,!n,!r)})}catch{return Jt(this,vt)}},L.prototype.equals=function(e){return e==null?Jt(this,vt):new this.Collection(this,function(){return Qt(e)})},L.prototype.above=function(e){return e==null?Jt(this,vt):new this.Collection(this,function(){return Zt(e,void 0,!0)})},L.prototype.aboveOrEqual=function(e){return e==null?Jt(this,vt):new this.Collection(this,function(){return Zt(e,void 0,!1)})},L.prototype.below=function(e){return e==null?Jt(this,vt):new this.Collection(this,function(){return Zt(void 0,e,!1,!0)})},L.prototype.belowOrEqual=function(e){return e==null?Jt(this,vt):new this.Collection(this,function(){return Zt(void 0,e)})},L.prototype.startsWith=function(e){return typeof e==`string`?this.between(e,e+N,!0,!0):Jt(this,yt)},L.prototype.startsWithIgnoreCase=function(e){return e===``?this.startsWith(e):Xt(this,function(e,t){return e.indexOf(t[0])===0},[e],N)},L.prototype.equalsIgnoreCase=function(e){return Xt(this,function(e,t){return e===t[0]},[e],``)},L.prototype.anyOfIgnoreCase=function(){var e=pe.apply(fe,arguments);return e.length===0?Yt(this):Xt(this,function(e,t){return t.indexOf(e)!==-1},e,``)},L.prototype.startsWithAnyOfIgnoreCase=function(){var e=pe.apply(fe,arguments);return e.length===0?Yt(this):Xt(this,function(e,t){return t.some(function(t){return e.indexOf(t)===0})},e,N)},L.prototype.anyOf=function(){var e=this,t=pe.apply(fe,arguments),n=this._cmp;try{t.sort(n)}catch{return Jt(this,vt)}if(t.length===0)return Yt(this);var r=new this.Collection(this,function(){return Zt(t[0],t[t.length-1])});r._ondirectionchange=function(r){n=r===`next`?e._ascending:e._descending,t.sort(n)};var i=0;return r._addAlgorithm(function(e,r,a){for(var o=e.key;0<n(o,t[i]);)if(++i===t.length)return r(a),!1;return n(o,t[i])===0||(r(function(){e.continue(t[i])}),!1)}),r},L.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},L.prototype.noneOf=function(){var e=pe.apply(fe,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return Jt(this,vt)}var t=e.reduce(function(e,t){return e?e.concat([[e[e.length-1][1],t]]):[[-1/0,t]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},L.prototype.inAnyRange=function(e,t){var n=this,r=this._cmp,i=this._ascending,a=this._descending,o=this._min,s=this._max;if(e.length===0)return Yt(this);if(!e.every(function(e){return e[0]!==void 0&&e[1]!==void 0&&i(e[0],e[1])<=0}))return Jt(this,`First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower`,S.InvalidArgument);var c=!t||!1!==t.includeLowers,l=t&&!0===t.includeUppers,u,d=i;function f(e,t){return d(e[0],t[0])}try{(u=e.reduce(function(e,t){for(var n=0,i=e.length;n<i;++n){var a=e[n];if(r(t[0],a[1])<0&&0<r(t[1],a[0])){a[0]=o(a[0],t[0]),a[1]=s(a[1],t[1]);break}}return n===i&&e.push(t),e},[])).sort(f)}catch{return Jt(this,vt)}var p=0,m=l?function(e){return 0<i(e,u[p][1])}:function(e){return 0<=i(e,u[p][1])},h=c?function(e){return 0<a(e,u[p][0])}:function(e){return 0<=a(e,u[p][0])},g=m,e=new this.Collection(this,function(){return Zt(u[0][0],u[u.length-1][1],!c,!l)});return e._ondirectionchange=function(e){d=e===`next`?(g=m,i):(g=h,a),u.sort(f)},e._addAlgorithm(function(e,t,r){for(var a,o=e.key;g(o);)if(++p===u.length)return t(r),!1;return!m(a=o)&&!h(a)||(n._cmp(o,u[p][1])===0||n._cmp(o,u[p][0])===0||t(function(){d===i?e.continue(u[p][0]):e.continue(u[p][1])}),!1)}),e},L.prototype.startsWithAnyOf=function(){var e=pe.apply(fe,arguments);return e.every(function(e){return typeof e==`string`})?e.length===0?Yt(this):this.inAnyRange(e.map(function(e){return[e,e+N]})):Jt(this,`startsWithAnyOf() only works with strings`)},L);function L(){}function en(e){return E(function(t){return tn(t),e(t.target.error),!1})}function tn(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var nn=`storagemutated`,rn=`x-storagemutated-1`,an=Ft(null,nn),on=(sn.prototype._lock=function(){return v(!w.global),++this._reculock,this._reculock!==1||w.global||(w.lockOwnerFor=this),this},sn.prototype._unlock=function(){if(v(!w.global),--this._reculock==0)for(w.global||(w.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{ht(e[1],e[0])}catch{}}return this},sn.prototype._locked=function(){return this._reculock&&w.lockOwnerFor!==this},sn.prototype.create=function(e){var t=this;if(!this.mode)return this;var n=this.db.idbdb,r=this.db._state.dbOpenError;if(v(!this.idbtrans),!e&&!n)switch(r&&r.name){case`DatabaseClosedError`:throw new S.DatabaseClosed(r);case`MissingAPIError`:throw new S.MissingAPI(r.message,r);default:throw new S.OpenFailed(r)}if(!this.active)throw new S.TransactionInactive;return v(this._completion._state===null),(e=this.idbtrans=e||(this.db.core||n).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=E(function(n){tn(n),t._reject(e.error)}),e.onabort=E(function(n){tn(n),t.active&&t._reject(new S.Abort(e.error)),t.active=!1,t.on(`abort`).fire(n)}),e.oncomplete=E(function(){t.active=!1,t._resolve(),`mutatedParts`in e&&an.storagemutated.fire(e.mutatedParts)}),this},sn.prototype._promise=function(e,t,n){var r=this;if(e===`readwrite`&&this.mode!==`readwrite`)return M(new S.ReadOnly(`Transaction is readonly`));if(!this.active)return M(new S.TransactionInactive);if(this._locked())return new T(function(i,a){r._blockedFuncs.push([function(){r._promise(e,t,n).then(i,a)},w])});if(n)return ut(function(){var e=new T(function(e,n){r._lock();var i=t(e,n,r);i&&i.then&&i.then(e,n)});return e.finally(function(){return r._unlock()}),e._lib=!0,e});var i=new T(function(e,n){var i=t(e,n,r);i&&i.then&&i.then(e,n)});return i._lib=!0,i},sn.prototype._root=function(){return this.parent?this.parent._root():this},sn.prototype.waitFor=function(e){var t,n=this._root(),r=T.resolve(e);n._waitingFor?n._waitingFor=n._waitingFor.then(function(){return r}):(n._waitingFor=r,n._waitingQueue=[],t=n.idbtrans.objectStore(n.storeNames[0]),function e(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(t.get(-1/0).onsuccess=e)}());var i=n._waitingFor;return new T(function(e,t){r.then(function(t){return n._waitingQueue.push(E(e.bind(null,t)))},function(e){return n._waitingQueue.push(E(t.bind(null,e)))}).finally(function(){n._waitingFor===i&&(n._waitingFor=null)})})},sn.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new S.Abort))},sn.prototype.table=function(e){var t=this._memoizedTables||={};if(l(t,e))return t[e];var n=this.schema[e];if(!n)throw new S.NotFound(`Table `+e+` not part of transaction`);return n=new this.db.Table(e,n,this),n.core=this.db.core.table(e),t[e]=n},sn);function sn(){}function cn(e,t,n,r,i,a,o,s){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:a,src:(n&&!o?`&`:``)+(r?`*`:``)+(i?`++`:``)+ln(t),type:s}}function ln(e){return typeof e==`string`?e:e?`[`+[].join.call(e,`+`)+`]`:``}function un(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:(r=function(e){return[e.name,e]},n.reduce(function(e,t,n){return n=r(t,n),n&&(e[n[0]]=n[1]),e},{}))};var r}var R=function(e){try{return e.only([[]]),R=function(){return[[]]},[[]]}catch{return R=function(){return N},N}};function dn(e){return e==null?function(){}:typeof e==`string`?(t=e).split(`.`).length===1?function(e){return e[t]}:function(e){return b(e,t)}:function(t){return b(t,e)};var t}function fn(e){return[].slice.call(e)}var pn=0;function mn(e){return e==null?`:id`:typeof e==`string`?e:`[${e.join(`+`)}]`}function z(e,t,n){function r(e){if(e.type===3)return null;if(e.type===4)throw Error(`Cannot convert never type to IDBKeyRange`);var n=e.lower,r=e.upper,i=e.lowerOpen,e=e.upperOpen;return n===void 0?r===void 0?null:t.upperBound(r,!!e):r===void 0?t.lowerBound(n,!!i):t.bound(n,r,!!i,!!e)}function i(e){var t,n=e.name;return{name:n,schema:e,mutate:function(e){var t=e.trans,i=e.type,a=e.keys,o=e.values,s=e.range;return new Promise(function(e,c){e=E(e);var l=t.objectStore(n),u=l.keyPath==null,d=i===`put`||i===`add`;if(!d&&i!==`delete`&&i!==`deleteRange`)throw Error(`Invalid operation type: `+i);var f,p=(a||o||{length:1}).length;if(a&&o&&a.length!==o.length)throw Error(`Given keys array must have same length as given values array.`);if(p===0)return e({numFailures:0,failures:{},results:[],lastResult:void 0});function m(e){++_,tn(e)}var h=[],g=[],_=0;if(i===`deleteRange`){if(s.type===4)return e({numFailures:_,failures:g,results:[],lastResult:void 0});s.type===3?h.push(f=l.clear()):h.push(f=l.delete(r(s)))}else{var u=d?u?[o,a]:[o,null]:[a,null],v=u[0],y=u[1];if(d)for(var b=0;b<p;++b)h.push(f=y&&y[b]!==void 0?l[i](v[b],y[b]):l[i](v[b])),f.onerror=m;else for(b=0;b<p;++b)h.push(f=l[i](v[b])),f.onerror=m}function x(t){t=t.target.result,h.forEach(function(e,t){return e.error!=null&&(g[t]=e.error)}),e({numFailures:_,failures:g,results:i===`delete`?a:h.map(function(e){return e.result}),lastResult:t})}f.onerror=function(e){m(e),x(e)},f.onsuccess=x})},getMany:function(e){var t=e.trans,r=e.keys;return new Promise(function(e,i){e=E(e);for(var a,o=t.objectStore(n),s=r.length,c=Array(s),l=0,u=0,d=function(t){t=t.target,c[t._pos]=t.result,++u===l&&e(c)},f=en(i),p=0;p<s;++p)r[p]!=null&&((a=o.get(r[p]))._pos=p,a.onsuccess=d,a.onerror=f,++l);l===0&&e(c)})},get:function(e){var t=e.trans,r=e.key;return new Promise(function(e,i){e=E(e);var a=t.objectStore(n).get(r);a.onsuccess=function(t){return e(t.target.result)},a.onerror=en(i)})},query:(t=u,function(e){return new Promise(function(i,a){i=E(i);var o,s,c,l=e.trans,u=e.values,d=e.limit,f=e.query,p=d===1/0?void 0:d,m=f.index,f=f.range,l=l.objectStore(n),m=m.isPrimaryKey?l:l.index(m.name),f=r(f);if(d===0)return i({result:[]});t?((p=u?m.getAll(f,p):m.getAllKeys(f,p)).onsuccess=function(e){return i({result:e.target.result})},p.onerror=en(a)):(o=0,s=!u&&`openKeyCursor`in m?m.openKeyCursor(f):m.openCursor(f),c=[],s.onsuccess=function(e){var t=s.result;return t?(c.push(u?t.value:t.primaryKey),++o===d?i({result:c}):void t.continue()):i({result:c})},s.onerror=en(a))})}),openCursor:function(e){var t=e.trans,i=e.values,a=e.query,o=e.reverse,s=e.unique;return new Promise(function(e,c){e=E(e);var l=a.index,u=a.range,d=t.objectStore(n),d=l.isPrimaryKey?d:d.index(l.name),l=o?s?`prevunique`:`prev`:s?`nextunique`:`next`,f=!i&&`openKeyCursor`in d?d.openKeyCursor(r(u),l):d.openCursor(r(u),l);f.onerror=en(c),f.onsuccess=E(function(n){var r,i,a,o,s=f.result;s?(s.___id=++pn,s.done=!1,r=s.continue.bind(s),i=(i=s.continuePrimaryKey)&&i.bind(s),a=s.advance.bind(s),o=function(){throw Error(`Cursor not stopped`)},s.trans=t,s.stop=s.continue=s.continuePrimaryKey=s.advance=function(){throw Error(`Cursor not started`)},s.fail=E(c),s.next=function(){var e=this,t=1;return this.start(function(){return t--?e.continue():e.stop()}).then(function(){return e})},s.start=function(e){function t(){if(f.result)try{e()}catch(e){s.fail(e)}else s.done=!0,s.start=function(){throw Error(`Cursor behind last entry`)},s.stop()}var n=new Promise(function(e,t){e=E(e),f.onerror=en(t),s.fail=t,s.stop=function(t){s.stop=s.continue=s.continuePrimaryKey=s.advance=o,e(t)}});return f.onsuccess=E(function(e){f.onsuccess=t,t()}),s.continue=r,s.continuePrimaryKey=i,s.advance=a,t(),n},e(s)):e(null)},c)})},count:function(e){var t=e.query,i=e.trans,a=t.index,o=t.range;return new Promise(function(e,t){var s=i.objectStore(n),c=a.isPrimaryKey?s:s.index(a.name),s=r(o),c=s?c.count(s):c.count();c.onsuccess=E(function(t){return e(t.target.result)}),c.onerror=en(t)})}}}var o,s,c,l=(s=n,c=fn((o=e).objectStoreNames),{schema:{name:o.name,tables:c.map(function(e){return s.objectStore(e)}).map(function(e){var t=e.keyPath,n=e.autoIncrement,r=a(t),i={},n={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:t==null,compound:r,keyPath:t,autoIncrement:n,unique:!0,extractKey:dn(t)},indexes:fn(e.indexNames).map(function(t){return e.index(t)}).map(function(e){var t=e.name,n=e.unique,r=e.multiEntry,e=e.keyPath,r={name:t,compound:a(e),keyPath:e,unique:n,multiEntry:r,extractKey:dn(e)};return i[mn(e)]=r}),getIndexByKeyPath:function(e){return i[mn(e)]}};return i[`:id`]=n.primaryKey,t!=null&&(i[mn(t)]=n.primaryKey),n})},hasGetAll:0<c.length&&`getAll`in s.objectStore(c[0])&&!(typeof navigator<`u`&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),n=l.schema,u=l.hasGetAll,l=n.tables.map(i),d={};return l.forEach(function(e){return d[e.name]=e}),{stack:`dbcore`,transaction:e.transaction.bind(e),table:function(e){if(!d[e])throw Error(`Table '${e}' not found`);return d[e]},MIN_KEY:-1/0,MAX_KEY:R(t),schema:n}}function hn(e,n,r,i){var a=r.IDBKeyRange;return r.indexedDB,{dbcore:(i=z(n,a,i),e.dbcore.reduce(function(e,n){return n=n.create,t(t({},e),n(e))},i))}}function gn(e,t){var n=t.db,t=hn(e._middlewares,n,e._deps,t);e.core=t.dbcore,e.tables.forEach(function(t){var n=t.name;e.core.schema.tables.some(function(e){return e.name===n})&&(t.core=e.core.table(n),e[n]instanceof e.Table&&(e[n].core=t.core))})}function B(e,t,n,r){n.forEach(function(n){var i=r[n];t.forEach(function(t){var r=function e(t,n){return m(t,n)||(t=s(t))&&e(t,n)}(t,n);(!r||`value`in r&&r.value===void 0)&&(t===e.Transaction.prototype||t instanceof e.Transaction?f(t,n,{get:function(){return this.table(n)},set:function(e){d(this,n,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[n]=new e.Table(n,i))})})}function _n(e,t){t.forEach(function(t){for(var n in t)t[n]instanceof e.Table&&delete t[n]})}function vn(e,t){return e._cfg.version-t._cfg.version}function yn(e,t,n,r){var a=e._dbSchema;n.objectStoreNames.contains(`$meta`)&&!a.$meta&&(a.$meta=un(`$meta`,En(``)[0],[]),e._storeNames.push(`$meta`));var o=e._createTransaction(`readwrite`,e._storeNames,a);o.create(n),o._completion.catch(r);var s=o._reject.bind(o),c=w.transless||w;ut(function(){return w.trans=o,w.transless=c,t===0?(i(a).forEach(function(e){Sn(n,e,a[e].primKey,a[e].indexes)}),gn(e,n),void T.follow(function(){return e.on.populate.fire(o)}).catch(s)):(gn(e,n),l=t,((r=o).storeNames.includes(`$meta`)?r.table(`$meta`).get(`version`).then(function(e){return e??l}):T.resolve(l)).then(function(t){return a=t,s=o,c=n,l=[],t=(r=e)._versions,u=r._dbSchema=wn(0,r.idbdb,c),(t=t.filter(function(e){return e._cfg.version>=a})).length===0?T.resolve():(t.forEach(function(e){l.push(function(){var t=u,n=e._cfg.dbschema;Tn(r,t,c),Tn(r,n,c),u=r._dbSchema=n;var o=xn(t,n);o.add.forEach(function(e){Sn(c,e[0],e[1].primKey,e[1].indexes)}),o.change.forEach(function(e){if(e.recreate)throw new S.Upgrade(`Not yet support for changing primary key`);var t=c.objectStore(e.name);e.add.forEach(function(e){return V(t,e)}),e.change.forEach(function(e){t.deleteIndex(e.name),V(t,e)}),e.del.forEach(function(e){return t.deleteIndex(e)})});var l=e._cfg.contentUpgrade;if(l&&e._cfg.version>a){gn(r,c),s._memoizedTables={};var d=ee(n);o.del.forEach(function(e){d[e]=t[e]}),_n(r,[r.Transaction.prototype]),B(r,[r.Transaction.prototype],i(d),d),s.schema=d;var f,p=me(l);return p&&dt(),o=T.follow(function(){var e;(f=l(s))&&p&&(e=ft.bind(null,null),f.then(e,e))}),f&&typeof f.then==`function`?T.resolve(f):o.then(function(){return f})}}),l.push(function(t){var n=e._cfg.dbschema,i=t;[].slice.call(i.db.objectStoreNames).forEach(function(e){return n[e]==null&&i.db.deleteObjectStore(e)}),_n(r,[r.Transaction.prototype]),B(r,[r.Transaction.prototype],r._storeNames,r._dbSchema),s.schema=r._dbSchema}),l.push(function(t){r.idbdb.objectStoreNames.contains(`$meta`)&&(Math.ceil(r.idbdb.version/10)===e._cfg.version?(r.idbdb.deleteObjectStore(`$meta`),delete r._dbSchema.$meta,r._storeNames=r._storeNames.filter(function(e){return e!==`$meta`})):t.objectStore(`$meta`).put(e._cfg.version,`version`))})}),function e(){return l.length?T.resolve(l.shift()(s.idbtrans)).then(e):T.resolve()}().then(function(){Cn(u,c)}));var r,a,s,c,l,u}).catch(s));var r,l})}function bn(e,t){Cn(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains(`$meta`)||t.db.createObjectStore(`$meta`).add(Math.ceil(t.db.version/10-1),`version`);var n=wn(0,e.idbdb,t);Tn(e,e._dbSchema,t);for(var r=0,i=xn(n,e._dbSchema).change;r<i.length;r++){var a=function(e){if(e.change.length||e.recreate)return console.warn(`Unable to patch indexes of table ${e.name} because it has changes on the type of index or primary key.`),{value:void 0};var n=t.objectStore(e.name);e.add.forEach(function(t){Pe&&console.debug(`Dexie upgrade patch: Creating missing index ${e.name}.${t.src}`),V(n,t)})}(i[r]);if(typeof a==`object`)return a.value}}function xn(e,t){var n,r={del:[],add:[],change:[]};for(n in e)t[n]||r.del.push(n);for(n in t){var i=e[n],a=t[n];if(i){var o={name:n,def:a,recreate:!1,del:[],add:[],change:[]};if(``+(i.primKey.keyPath||``)!=``+(a.primKey.keyPath||``)||i.primKey.auto!==a.primKey.auto)o.recreate=!0,r.change.push(o);else{var s=i.idxByName,c=a.idxByName,l=void 0;for(l in s)c[l]||o.del.push(l);for(l in c){var u=s[l],d=c[l];u?u.src!==d.src&&o.change.push(d):o.add.push(d)}(0<o.del.length||0<o.add.length||0<o.change.length)&&r.change.push(o)}}else r.add.push([n,a])}return r}function Sn(e,t,n,r){var i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(e){return V(i,e)}),i}function Cn(e,t){i(e).forEach(function(n){t.db.objectStoreNames.contains(n)||(Pe&&console.debug(`Dexie: Creating missing table`,n),Sn(t,n,e[n].primKey,e[n].indexes))})}function V(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function wn(e,t,n){var r={};return g(t.objectStoreNames,0).forEach(function(e){for(var t=n.objectStore(e),i=cn(ln(c=t.keyPath),c||``,!0,!1,!!t.autoIncrement,c&&typeof c!=`string`,!0),a=[],o=0;o<t.indexNames.length;++o){var s=t.index(t.indexNames[o]),c=s.keyPath,s=cn(s.name,c,!!s.unique,!!s.multiEntry,!1,c&&typeof c!=`string`,!1);a.push(s)}r[e]=un(e,i,a)}),r}function Tn(e,t,n){for(var i=n.db.objectStoreNames,a=0;a<i.length;++a){var o=i[a],s=n.objectStore(o);e._hasGetAll=`getAll`in s;for(var c=0;c<s.indexNames.length;++c){var l=s.indexNames[c],u=s.index(l).keyPath,d=typeof u==`string`?u:`[`+g(u).join(`+`)+`]`;!t[o]||(u=t[o].idxByName[d])&&(u.name=l,delete t[o].idxByName[d],t[o].idxByName[l]=u)}}typeof navigator<`u`&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&r.WorkerGlobalScope&&r instanceof r.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function En(e){return e.split(`,`).map(function(e,t){var n=e.split(`:`),r=(i=n[1])?.trim(),i=(e=n[0].trim()).replace(/([&*]|\+\+)/g,``),n=/^\[/.test(i)?i.match(/^\[(.*)\]$/)[1].split(`+`):i;return cn(i,n||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),a(n),t===0,r)})}var Dn=(H.prototype._createTableSchema=un,H.prototype._parseIndexSyntax=En,H.prototype._parseStoresSpec=function(e,t){var n=this;i(e).forEach(function(r){if(e[r]!==null){var i=n._parseIndexSyntax(e[r]),a=i.shift();if(!a)throw new S.Schema(`Invalid schema for table `+r+`: `+e[r]);if(a.unique=!0,a.multi)throw new S.Schema(`Primary key cannot be multiEntry*`);i.forEach(function(e){if(e.auto)throw new S.Schema(`Only primary key can be marked as autoIncrement (++)`);if(!e.keyPath)throw new S.Schema(`Index must have a name and cannot be an empty string`)}),i=n._createTableSchema(r,a,i),t[r]=i}})},H.prototype.stores=function(e){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?o(this._cfg.storesSource,e):e;var e=t._versions,n={},r={};return e.forEach(function(e){o(n,e._cfg.storesSource),r=e._cfg.dbschema={},e._parseStoresSpec(n,r)}),t._dbSchema=r,_n(t,[t._allTables,t,t.Transaction.prototype]),B(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],i(r),r),t._storeNames=i(r),this},H.prototype.upgrade=function(e){return this._cfg.contentUpgrade=Ne(this._cfg.contentUpgrade||C,e),this},H);function H(){}function On(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new lr(xt,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:`name`}),n.table(`dbnames`)}function kn(e){return e&&typeof e.databases==`function`}function An(e){return ut(function(){return w.letThrough=!0,e()})}function U(e){return!(`from`in e)}var jn=function(e,t){if(!this){var n=new jn;return e&&`d`in e&&o(n,e),n}o(this,arguments.length?{d:1,from:e,to:1<arguments.length?t:e}:{d:0})};function Mn(e,t,n){var r=P(t,n);if(!isNaN(r)){if(0<r)throw RangeError();if(U(e))return o(e,{from:t,to:n,d:1});var i=e.l,r=e.r;if(P(n,e.from)<0)return i?Mn(i,t,n):e.l={from:t,to:n,d:1,l:null,r:null},G(e);if(0<P(t,e.to))return r?Mn(r,t,n):e.r={from:t,to:n,d:1,l:null,r:null},G(e);P(t,e.from)<0&&(e.from=t,e.l=null,e.d=r?r.d+1:1),0<P(n,e.to)&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1),n=!e.r,i&&!e.l&&W(e,i),r&&n&&W(e,r)}}function W(e,t){U(t)||function e(t,n){var r=n.from,i=n.to,a=n.l,n=n.r;Mn(t,r,i),a&&e(t,a),n&&e(t,n)}(e,t)}function Nn(e,t){var n=Pn(t),r=n.next();if(r.done)return!1;for(var i=r.value,a=Pn(e),o=a.next(i.from),s=o.value;!r.done&&!o.done;){if(P(s.from,i.to)<=0&&0<=P(s.to,i.from))return!0;P(i.from,s.from)<0?i=(r=n.next(s.from)).value:s=(o=a.next(i.from)).value}return!1}function Pn(e){var t=U(e)?null:{s:0,n:e};return{next:function(e){for(var n=0<arguments.length;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&P(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||P(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function G(e){var n,r,i=((n=e.r)?.d||0)-((r=e.l)?.d||0),a=1<i?`r`:i<-1?`l`:``;a&&(n=a==`r`?`l`:`r`,r=t({},e),i=e[a],e.from=i.from,e.to=i.to,e[a]=i[a],r[a]=i[n],(e[n]=r).d=Fn(r)),e.d=Fn(e)}function Fn(e){var t=e.r,e=e.l;return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}function In(e,t){return i(t).forEach(function(n){e[n]?W(e[n],t[n]):e[n]=function e(t){var n,r,i={};for(n in t)l(t,n)&&(r=t[n],i[n]=!r||typeof r!=`object`||ie.has(r.constructor)?r:e(r));return i}(t[n])}),e}function Ln(e,t){return e.all||t.all||Object.keys(e).some(function(n){return t[n]&&Nn(t[n],e[n])})}u(jn.prototype,((ge={add:function(e){return W(this,e),this},addKey:function(e){return Mn(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(e){return Mn(t,e,e)}),this},hasKey:function(e){var t=Pn(this).next(e).value;return t&&P(t.from,e)<=0&&0<=P(t.to,e)}})[le]=function(){return Pn(this)},ge));var Rn={},zn={},Bn=!1;function Vn(e){In(zn,e),Bn||(Bn=!0,setTimeout(function(){Bn=!1,Hn(zn,!(zn={}))},0))}function Hn(e,t){t===void 0&&(t=!1);var n=new Set;if(e.all)for(var r=0,i=Object.values(Rn);r<i.length;r++)Un(o=i[r],e,n,t);else for(var a in e){var o,s=/^idb\:\/\/(.*)\/(.*)\//.exec(a);s&&(a=s[1],s=s[2],(o=Rn[`idb://${a}/${s}`])&&Un(o,e,n,t))}n.forEach(function(e){return e()})}function Un(e,t,n,r){for(var i=[],a=0,o=Object.entries(e.queries.query);a<o.length;a++){for(var s=o[a],c=s[0],l=[],u=0,d=s[1];u<d.length;u++){var f=d[u];Ln(t,f.obsSet)?f.subscribers.forEach(function(e){return n.add(e)}):r&&l.push(f)}r&&i.push([c,l])}if(r)for(var p=0,m=i;p<m.length;p++){var h=m[p],c=h[0],l=h[1];e.queries.query[c]=l}}function Wn(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?M(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var r=t.openCanceller,a=Math.round(10*e.verno),o=!1;function s(){if(t.openCanceller!==r)throw new S.DatabaseClosed(`db.open() was cancelled`)}function c(){return new T(function(r,l){if(s(),!n)throw new S.MissingAPI;var u=e.name,p=t.autoSchema||!a?n.open(u):n.open(u,a);if(!p)throw new S.MissingAPI;p.onerror=en(l),p.onblocked=E(e._fireOnBlocked),p.onupgradeneeded=E(function(r){var i;d=p.transaction,t.autoSchema&&!e._options.allowEmptyDB?(p.onerror=tn,d.abort(),p.result.close(),(i=n.deleteDatabase(u)).onsuccess=i.onerror=E(function(){l(new S.NoSuchDatabase(`Database ${u} doesnt exist`))})):(d.onerror=en(l),r=r.oldVersion>2**62?0:r.oldVersion,f=r<1,e.idbdb=p.result,o&&bn(e,d),yn(e,r/10,d,l))},l),p.onsuccess=E(function(){d=null;var n,s,l,m,h,_=e.idbdb=p.result,v=g(_.objectStoreNames);if(0<v.length)try{var y=_.transaction((m=v).length===1?m[0]:m,`readonly`);if(t.autoSchema)s=_,l=y,(n=e).verno=s.version/10,l=n._dbSchema=wn(0,s,l),n._storeNames=g(s.objectStoreNames,0),B(n,[n._allTables],i(l),l);else if(Tn(e,e._dbSchema,y),((h=xn(wn(0,(h=e).idbdb,y),h._dbSchema)).add.length||h.change.some(function(e){return e.add.length||e.change.length}))&&!o)return console.warn(`Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this.`),_.close(),a=_.version+1,o=!0,r(c());gn(e,y)}catch{}bt.push(e),_.onversionchange=E(function(n){t.vcFired=!0,e.on(`versionchange`).fire(n)}),_.onclose=E(function(){e.close({disableAutoOpen:!1})}),f&&(h=e._deps,y=u,_=h.indexedDB,h=h.IDBKeyRange,kn(_)||y===xt||On(_,h).put({name:y}).catch(C)),r()},l)}).catch(function(e){switch(e?.name){case`UnknownError`:if(0<t.PR1398_maxLoop)return t.PR1398_maxLoop--,console.warn(`Dexie: Workaround for Chrome UnknownError on open()`),c();break;case`VersionError`:if(0<a)return a=0,c()}return T.reject(e)})}var l,u=t.dbReadyResolve,d=null,f=!1;return T.race([r,(typeof navigator>`u`?T.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){function t(){return indexedDB.databases().finally(e)}l=setInterval(t,100),t()}).finally(function(){return clearInterval(l)}):Promise.resolve()).then(c)]).then(function(){return s(),t.onReadyBeingFired=[],T.resolve(An(function(){return e.on.ready.fire(e.vip)})).then(function n(){if(0<t.onReadyBeingFired.length){var r=t.onReadyBeingFired.reduce(Ne,C);return t.onReadyBeingFired=[],T.resolve(An(function(){return r(e.vip)})).then(n)}})}).finally(function(){t.openCanceller===r&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(n){t.dbOpenError=n;try{d&&d.abort()}catch{}return r===t.openCanceller&&e._close(),M(n)}).finally(function(){t.openComplete=!0,u()}).then(function(){var t;return f&&(t={},e.tables.forEach(function(n){n.schema.indexes.forEach(function(r){r.name&&(t[`idb://${e.name}/${n.name}/${r.name}`]=new jn(-1/0,[[[]]]))}),t[`idb://${e.name}/${n.name}/`]=t[`idb://${e.name}/${n.name}/:dels`]=new jn(-1/0,[[[]]])}),an(nn).fire(t),Hn(t,!0)),e})}function Gn(e){function t(t){return e.next(t)}var n=i(t),r=i(function(t){return e.throw(t)});function i(e){return function(t){var i=e(t),t=i.value;return i.done?t:t&&typeof t.then==`function`?t.then(n,r):a(t)?Promise.all(t).then(n,r):n(t)}}return i(t)()}function Kn(e,t,n){for(var r=a(e)?e.slice():[e],i=0;i<n;++i)r.push(t);return r}var qn={stack:`dbcore`,name:`VirtualIndexMiddleware`,level:1,create:function(e){return t(t({},e),{table:function(n){var r=e.table(n),i=r.schema,a={},o=[];function s(e,n,r){var i=mn(e),c=a[i]=a[i]||[],l=e==null?0:typeof e==`string`?1:e.length,u=0<n,u=t(t({},r),{name:u?`${i}(virtual-from:${r.name})`:r.name,lowLevelIndex:r,isVirtual:u,keyTail:n,keyLength:l,extractKey:dn(e),unique:!u&&r.unique});return c.push(u),u.isPrimaryKey||o.push(u),1<l&&s(l===2?e[0]:e.slice(0,l-1),n+1,r),c.sort(function(e,t){return e.keyTail-t.keyTail}),u}n=s(i.primaryKey.keyPath,0,i.primaryKey),a[`:id`]=[n];for(var c=0,l=i.indexes;c<l.length;c++){var u=l[c];s(u.keyPath,0,u)}function d(n){var r,i=n.query.index;return i.isVirtual?t(t({},n),{query:{index:i.lowLevelIndex,range:(r=n.query.range,i=i.keyTail,{type:r.type===1?2:r.type,lower:Kn(r.lower,r.lowerOpen?e.MAX_KEY:e.MIN_KEY,i),lowerOpen:!0,upper:Kn(r.upper,r.upperOpen?e.MIN_KEY:e.MAX_KEY,i),upperOpen:!0})}}):n}return t(t({},r),{schema:t(t({},i),{primaryKey:n,indexes:o,getIndexByKeyPath:function(e){return(e=a[mn(e)])&&e[0]}}),count:function(e){return r.count(d(e))},query:function(e){return r.query(d(e))},openCursor:function(t){var n=t.query.index,i=n.keyTail,a=n.isVirtual,o=n.keyLength;return a?r.openCursor(d(t)).then(function(e){return e&&s(e)}):r.openCursor(t);function s(n){return Object.create(n,{continue:{value:function(r){r==null?t.unique?n.continue(n.key.slice(0,o).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,i)):n.continue():n.continue(Kn(r,t.reverse?e.MAX_KEY:e.MIN_KEY,i))}},continuePrimaryKey:{value:function(t,r){n.continuePrimaryKey(Kn(t,e.MAX_KEY,i),r)}},primaryKey:{get:function(){return n.primaryKey}},key:{get:function(){var e=n.key;return o===1?e[0]:e.slice(0,o)}},value:{get:function(){return n.value}}})}}})}})}};function Jn(e,t,n,r){return n||={},r||=``,i(e).forEach(function(i){var a,o,s;l(t,i)?(a=e[i],o=t[i],typeof a==`object`&&typeof o==`object`&&a&&o?(s=ce(a))===ce(o)?s===`Object`?Jn(a,o,n,r+i+`.`):a!==o&&(n[r+i]=t[i]):n[r+i]=t[i]:a!==o&&(n[r+i]=t[i])):n[r+i]=void 0}),i(t).forEach(function(i){l(e,i)||(n[r+i]=t[i])}),n}function Yn(e,t){return t.type===`delete`?t.keys:t.keys||t.values.map(e.extractKey)}var Xn={stack:`dbcore`,name:`HooksMiddleware`,level:2,create:function(e){return t(t({},e),{table:function(r){var i=e.table(r),a=i.schema.primaryKey;return t(t({},i),{mutate:function(e){var o=w.trans,s=o.table(r).hook,c=s.deleting,u=s.creating,d=s.updating;switch(e.type){case`add`:if(u.fire===C)break;return o._promise(`readwrite`,function(){return f(e)},!0);case`put`:if(u.fire===C&&d.fire===C)break;return o._promise(`readwrite`,function(){return f(e)},!0);case`delete`:if(c.fire===C)break;return o._promise(`readwrite`,function(){return f(e)},!0);case`deleteRange`:if(c.fire===C)break;return o._promise(`readwrite`,function(){return function e(n,r,o){return i.query({trans:n,values:!1,query:{index:a,range:r},limit:o}).then(function(i){var a=i.result;return f({type:`delete`,keys:a,trans:n}).then(function(i){return 0<i.numFailures?Promise.reject(i.failures[0]):a.length<o?{failures:[],numFailures:0,lastResult:void 0}:e(n,t(t({},r),{lower:a[a.length-1],lowerOpen:!0}),o)})})}(e.trans,e.range,1e4)},!0)}return i.mutate(e);function f(e){var r,o,s,f=w.trans,p=e.keys||Yn(a,e);if(!p)throw Error(`Keys missing`);return(e=e.type===`add`||e.type===`put`?t(t({},e),{keys:p}):t({},e)).type!==`delete`&&(e.values=n([],e.values,!0)),e.keys&&=n([],e.keys,!0),r=i,s=p,((o=e).type===`add`?Promise.resolve([]):r.getMany({trans:o.trans,keys:s,cache:`immutable`})).then(function(t){var n=p.map(function(n,r){var i,o,s,p=t[r],m={onerror:null,onsuccess:null};return e.type===`delete`?c.fire.call(m,n,p,f):e.type===`add`||p===void 0?(i=u.fire.call(m,n,e.values[r],f),n==null&&i!=null&&(e.keys[r]=n=i,a.outbound||x(e.values[r],a.keyPath,n))):(i=Jn(p,e.values[r]),(o=d.fire.call(m,i,n,p,f))&&(s=e.values[r],Object.keys(o).forEach(function(e){l(s,e)?s[e]=o[e]:x(s,e,o[e])}))),m});return i.mutate(e).then(function(r){for(var i=r.failures,a=r.results,o=r.numFailures,r=r.lastResult,s=0;s<p.length;++s){var c=(a||p)[s],l=n[s];c==null?l.onerror&&l.onerror(i[s]):l.onsuccess&&l.onsuccess(e.type===`put`&&t[s]?e.values[s]:c)}return{failures:i,results:a,numFailures:o,lastResult:r}}).catch(function(e){return n.forEach(function(t){return t.onerror&&t.onerror(e)}),Promise.reject(e)})})}}})}})}};function Zn(e,t,n){try{if(!t||t.keys.length<e.length)return null;for(var r=[],i=0,a=0;i<t.keys.length&&a<e.length;++i)P(t.keys[i],e[a])===0&&(r.push(n?oe(t.values[i]):t.values[i]),++a);return r.length===e.length?r:null}catch{return null}}var Qn={stack:`dbcore`,level:-1,create:function(e){return{table:function(n){var r=e.table(n);return t(t({},r),{getMany:function(e){if(!e.cache)return r.getMany(e);var t=Zn(e.keys,e.trans._cache,e.cache===`clone`);return t?T.resolve(t):r.getMany(e).then(function(t){return e.trans._cache={keys:e.keys,values:e.cache===`clone`?oe(t):t},t})},mutate:function(e){return e.type!==`add`&&(e.trans._cache=null),r.mutate(e)}})}}}};function $n(e,t){return e.trans.mode===`readonly`&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!==`disabled`&&!t.schema.primaryKey.outbound}function er(e,t){switch(e){case`query`:return t.values&&!t.unique;case`get`:case`getMany`:case`count`:case`openCursor`:return!1}}var tr={stack:`dbcore`,level:0,name:`Observability`,create:function(e){var n=e.schema.name,r=new jn(e.MIN_KEY,e.MAX_KEY);return t(t({},e),{transaction:function(t,n,r){if(w.subscr&&n!==`readonly`)throw new S.ReadOnly(`Readwrite transaction in liveQuery context. Querier source: ${w.querier}`);return e.transaction(t,n,r)},table:function(o){var s=e.table(o),c=s.schema,l=c.primaryKey,u=c.indexes,d=l.extractKey,f=l.outbound,p=l.autoIncrement&&u.filter(function(e){return e.compound&&e.keyPath.includes(l.keyPath)}),m=t(t({},s),{mutate:function(t){function i(e){return e=`idb://${n}/${o}/${e}`,h[e]||(h[e]=new jn)}var u,d,f,m=t.trans,h=t.mutatedParts||={},g=i(``),_=i(`:dels`),v=t.type,y=t.type===`deleteRange`?[t.range]:t.type===`delete`?[t.keys]:t.values.length<50?[Yn(l,t).filter(function(e){return e}),t.values]:[],b=y[0],x=y[1],y=t.trans._cache;return a(b)?(g.addKeys(b),(y=v===`delete`||b.length===x.length?Zn(b,y):null)||_.addKeys(b),(y||x)&&(u=i,d=y,f=x,c.indexes.forEach(function(e){var t=u(e.name||``);function n(t){return t==null?null:e.extractKey(t)}function r(n){return e.multiEntry&&a(n)?n.forEach(function(e){return t.addKey(e)}):t.addKey(n)}(d||f).forEach(function(e,t){var i=d&&n(d[t]),t=f&&n(f[t]);P(i,t)!==0&&(i!=null&&r(i),t!=null&&r(t))})}))):b?(x={from:(x=b.lower)??e.MIN_KEY,to:(x=b.upper)??e.MAX_KEY},_.add(x),g.add(x)):(g.add(r),_.add(r),c.indexes.forEach(function(e){return i(e.name).add(r)})),s.mutate(t).then(function(e){return!b||t.type!==`add`&&t.type!==`put`||(g.addKeys(e.results),p&&p.forEach(function(n){for(var r=t.values.map(function(e){return n.extractKey(e)}),a=n.keyPath.findIndex(function(e){return e===l.keyPath}),o=0,s=e.results.length;o<s;++o)r[o][a]=e.results[o];i(n.name).addKeys(r)})),m.mutatedParts=In(m.mutatedParts||{},h),e})}}),u=function(t){var n=t.query,t=n.index,n=n.range;return[t,new jn((t=n.lower)??e.MIN_KEY,(n=n.upper)??e.MAX_KEY)]},h={get:function(e){return[l,new jn(e.key)]},getMany:function(e){return[l,new jn().addKeys(e.keys)]},count:u,query:u,openCursor:u};return i(h).forEach(function(e){m[e]=function(i){var a=w.subscr,c=!!a,l=$n(w,s)&&er(e,i)?i.obsSet={}:a;if(c){var u=function(e){return e=`idb://${n}/${o}/${e}`,l[e]||(l[e]=new jn)},p=u(``),m=u(`:dels`),a=h[e](i),c=a[0],a=a[1];if((e===`query`&&c.isPrimaryKey&&!i.values?m:u(c.name||``)).add(a),!c.isPrimaryKey){if(e!==`count`){var g=e===`query`&&f&&i.values&&s.query(t(t({},i),{values:!1}));return s[e].apply(this,arguments).then(function(t){if(e===`query`){if(f&&i.values)return g.then(function(e){return e=e.result,p.addKeys(e),t});var n=i.values?t.result.map(d):t.result;(i.values?p:m).addKeys(n)}else if(e===`openCursor`){var r=t,a=i.values;return r&&Object.create(r,{key:{get:function(){return m.addKey(r.primaryKey),r.key}},primaryKey:{get:function(){var e=r.primaryKey;return m.addKey(e),e}},value:{get:function(){return a&&p.addKey(r.primaryKey),r.value}}})}return t})}m.add(r)}}return s[e].apply(this,arguments)}}),m}})}};function K(e,n,r){if(r.numFailures===0)return n;if(n.type===`deleteRange`)return null;var i=n.keys?n.keys.length:`values`in n&&n.values?n.values.length:1;return r.numFailures===i?null:(n=t({},n),a(n.keys)&&(n.keys=n.keys.filter(function(e,t){return!(t in r.failures)})),`values`in n&&a(n.values)&&(n.values=n.values.filter(function(e,t){return!(t in r.failures)})),n)}function nr(e,t){return n=e,((r=t).lower===void 0||(r.lowerOpen?0<P(n,r.lower):0<=P(n,r.lower)))&&(e=e,(t=t).upper===void 0||(t.upperOpen?P(e,t.upper)<0:P(e,t.upper)<=0));var n,r}function rr(e,t,n,r,i,o){if(!n||n.length===0)return e;var s=t.query.index,c=s.multiEntry,l=t.query.range,u=r.schema.primaryKey.extractKey,d=s.extractKey,f=(s.lowLevelIndex||s).extractKey,n=n.reduce(function(e,n){var r=e,i=[];if(n.type===`add`||n.type===`put`)for(var o=new jn,s=n.values.length-1;0<=s;--s){var f,p=n.values[s],m=u(p);o.hasKey(m)||(f=d(p),(c&&a(f)?f.some(function(e){return nr(e,l)}):nr(f,l))&&(o.addKey(m),i.push(p)))}switch(n.type){case`add`:var h=new jn().addKeys(t.values?e.map(function(e){return u(e)}):e),r=e.concat(t.values?i.filter(function(e){return e=u(e),!h.hasKey(e)&&(h.addKey(e),!0)}):i.map(function(e){return u(e)}).filter(function(e){return!h.hasKey(e)&&(h.addKey(e),!0)}));break;case`put`:var g=new jn().addKeys(n.values.map(function(e){return u(e)}));r=e.filter(function(e){return!g.hasKey(t.values?u(e):e)}).concat(t.values?i:i.map(function(e){return u(e)}));break;case`delete`:var _=new jn().addKeys(n.keys);r=e.filter(function(e){return!_.hasKey(t.values?u(e):e)});break;case`deleteRange`:var v=n.range;r=e.filter(function(e){return!nr(u(e),v)})}return r},e);return n===e?e:(n.sort(function(e,t){return P(f(e),f(t))||P(u(e),u(t))}),t.limit&&t.limit<1/0&&(n.length>t.limit?n.length=t.limit:e.length===t.limit&&n.length<t.limit&&(i.dirty=!0)),o?Object.freeze(n):n)}function ir(e,t){return P(e.lower,t.lower)===0&&P(e.upper,t.upper)===0&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function ar(e,t){return function(e,t,n,r){if(e===void 0)return t===void 0?0:-1;if(t===void 0)return 1;if((t=P(e,t))===0){if(n&&r)return 0;if(n)return 1;if(r)return-1}return t}(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&0<=function(e,t,n,r){if(e===void 0)return t===void 0?0:1;if(t===void 0)return-1;if((t=P(e,t))===0){if(n&&r)return 0;if(n)return-1;if(r)return 1}return t}(e.upper,t.upper,e.upperOpen,t.upperOpen)}function or(e,t,n,r){e.subscribers.add(n),r.addEventListener(`abort`,function(){var r,i;e.subscribers.delete(n),e.subscribers.size===0&&(r=e,i=t,setTimeout(function(){r.subscribers.size===0&&de(i,r)},3e3))})}var sr={stack:`dbcore`,level:0,name:`Cache`,create:function(e){var n=e.schema.name;return t(t({},e),{transaction:function(t,r,i){var a,o,s=e.transaction(t,r,i);return r===`readwrite`&&(o=(a=new AbortController).signal,i=function(i){return function(){if(a.abort(),r===`readwrite`){for(var o=new Set,c=0,l=t;c<l.length;c++){var u=l[c],d=Rn[`idb://${n}/${u}`];if(d){var f=e.table(u),p=d.optimisticOps.filter(function(e){return e.trans===s});if(s._explicit&&i&&s.mutatedParts)for(var m=0,h=Object.values(d.queries.query);m<h.length;m++)for(var g=0,_=(b=h[m]).slice();g<_.length;g++)Ln((x=_[g]).obsSet,s.mutatedParts)&&(de(b,x),x.subscribers.forEach(function(e){return o.add(e)}));else if(0<p.length){d.optimisticOps=d.optimisticOps.filter(function(e){return e.trans!==s});for(var v=0,y=Object.values(d.queries.query);v<y.length;v++)for(var b,x,ee,te=0,ne=(b=y[v]).slice();te<ne.length;te++)(x=ne[te]).res!=null&&s.mutatedParts&&(i&&!x.dirty?(ee=Object.isFrozen(x.res),ee=rr(x.res,x.req,p,f,x,ee),x.dirty?(de(b,x),x.subscribers.forEach(function(e){return o.add(e)})):ee!==x.res&&(x.res=ee,x.promise=T.resolve({result:ee}))):(x.dirty&&de(b,x),x.subscribers.forEach(function(e){return o.add(e)})))}}}o.forEach(function(e){return e()})}}},s.addEventListener(`abort`,i(!1),{signal:o}),s.addEventListener(`error`,i(!1),{signal:o}),s.addEventListener(`complete`,i(!0),{signal:o})),s},table:function(r){var i=e.table(r),a=i.schema.primaryKey;return t(t({},i),{mutate:function(e){var o=w.trans;if(a.outbound||o.db._options.cache===`disabled`||o.explicit||o.idbtrans.mode!==`readwrite`)return i.mutate(e);var s=Rn[`idb://${n}/${r}`];return s?(o=i.mutate(e),e.type!==`add`&&e.type!==`put`||!(50<=e.values.length||Yn(a,e).some(function(e){return e==null}))?(s.optimisticOps.push(e),e.mutatedParts&&Vn(e.mutatedParts),o.then(function(t){0<t.numFailures&&(de(s.optimisticOps,e),(t=K(0,e,t))&&s.optimisticOps.push(t),e.mutatedParts&&Vn(e.mutatedParts))}),o.catch(function(){de(s.optimisticOps,e),e.mutatedParts&&Vn(e.mutatedParts)})):o.then(function(n){var r=K(0,t(t({},e),{values:e.values.map(function(e,r){var i;return n.failures[r]?e:(e=(i=a.keyPath)!=null&&i.includes(`.`)?oe(e):t({},e),x(e,a.keyPath,n.results[r]),e)})}),n);s.optimisticOps.push(r),queueMicrotask(function(){return e.mutatedParts&&Vn(e.mutatedParts)})}),o):i.mutate(e)},query:function(e){if(!$n(w,i)||!er(`query`,e))return i.query(e);var t=(c=w.trans)?.db._options.cache===`immutable`,a=w,o=a.requery,s=a.signal,c=function(e,t,n,r){var i=Rn[`idb://${e}/${t}`];if(!i)return[];if(!(t=i.queries[n]))return[null,!1,i,null];var a=t[(r.query?r.query.index.name:null)||``];if(!a)return[null,!1,i,null];switch(n){case`query`:var o=a.find(function(e){return e.req.limit===r.limit&&e.req.values===r.values&&ir(e.req.query.range,r.query.range)});return o?[o,!0,i,a]:[a.find(function(e){return(`limit`in e.req?e.req.limit:1/0)>=r.limit&&(!r.values||e.req.values)&&ar(e.req.query.range,r.query.range)}),!1,i,a];case`count`:return o=a.find(function(e){return ir(e.req.query.range,r.query.range)}),[o,!!o,i,a]}}(n,r,`query`,e),l=c[0],a=c[1],u=c[2],d=c[3];return l&&a?l.obsSet=e.obsSet:(a=i.query(e).then(function(e){var n=e.result;if(l&&(l.res=n),t){for(var r=0,i=n.length;r<i;++r)Object.freeze(n[r]);Object.freeze(n)}else e.result=oe(n);return e}).catch(function(e){return d&&l&&de(d,l),Promise.reject(e)}),l={obsSet:e.obsSet,promise:a,subscribers:new Set,type:`query`,req:e,dirty:!1},d?d.push(l):(d=[l],(u||=Rn[`idb://${n}/${r}`]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}}).queries.query[e.query.index.name||``]=d)),or(l,d,o,s),l.promise.then(function(n){return{result:rr(n.result,e,u?.optimisticOps,i,l,t)}})}})}})}};function cr(e,t){return new Proxy(e,{get:function(e,n,r){return n===`db`?t:Reflect.get(e,n,r)}})}var lr=(q.prototype.version=function(e){if(isNaN(e)||e<.1)throw new S.Type(`Given version is not a positive number`);if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new S.Schema(`Cannot add version when database is open`);this.verno=Math.max(this.verno,e);var t=this._versions,n=t.filter(function(t){return t._cfg.version===e})[0];return n||(n=new this.Version(e),t.push(n),t.sort(vn),n.stores({}),this._state.autoSchema=!1,n)},q.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||w.letThrough||this._vip)?e():new T(function(e,n){if(t._state.openComplete)return n(new S.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void n(new S.DatabaseClosed);t.open().catch(C)}t._state.dbReadyPromise.then(e,n)}).then(e)},q.prototype.use=function(e){var t=e.stack,n=e.create,r=e.level,i=e.name;return i&&this.unuse({stack:t,name:i}),e=this._middlewares[t]||(this._middlewares[t]=[]),e.push({stack:t,create:n,level:r??10,name:i}),e.sort(function(e,t){return e.level-t.level}),this},q.prototype.unuse=function(e){var t=e.stack,n=e.name,r=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(e){return r?e.create!==r:!!n&&e.name!==n})),this},q.prototype.open=function(){var e=this;return ht(Ke,function(){return Wn(e)})},q.prototype._close=function(){this.on.close.fire(new CustomEvent(`close`));var e=this._state,t=bt.indexOf(this);if(0<=t&&bt.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new T(function(t){e.dbReadyResolve=t}),e.openCanceller=new T(function(t,n){e.cancelOpen=n}))},q.prototype.close=function(e){var t=(e===void 0?{disableAutoOpen:!0}:e).disableAutoOpen,e=this._state;t?(e.isBeingOpened&&e.cancelOpen(new S.DatabaseClosed),this._close(),e.autoOpen=!1,e.dbOpenError=new S.DatabaseClosed):(this._close(),e.autoOpen=this._options.autoOpen||e.isBeingOpened,e.openComplete=!1,e.dbOpenError=null)},q.prototype.delete=function(e){var t=this;e===void 0&&(e={disableAutoOpen:!0});var n=0<arguments.length&&typeof arguments[0]!=`object`,r=this._state;return new T(function(i,a){function o(){t.close(e);var n=t._deps.indexedDB.deleteDatabase(t.name);n.onsuccess=E(function(){var e=t._deps,n=t.name,r=e.indexedDB;e=e.IDBKeyRange,kn(r)||n===xt||On(r,e).delete(n).catch(C),i()}),n.onerror=en(a),n.onblocked=t._fireOnBlocked}if(n)throw new S.InvalidArgument(`Invalid closeOptions argument to db.delete()`);r.isBeingOpened?r.dbReadyPromise.then(o):o()})},q.prototype.backendDB=function(){return this.idbdb},q.prototype.isOpen=function(){return this.idbdb!==null},q.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name===`DatabaseClosed`},q.prototype.hasFailed=function(){return this._state.dbOpenError!==null},q.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(q.prototype,`tables`,{get:function(){var e=this;return i(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),q.prototype.transaction=function(){var e=function(e,t,n){var r=arguments.length;if(r<2)throw new S.InvalidArgument(`Too few arguments`);for(var i=Array(r-1);--r;)i[r-1]=arguments[r];return n=i.pop(),[e,ne(i),n]}.apply(this,arguments);return this._transaction.apply(this,e)},q.prototype._transaction=function(e,t,n){var r=this,i=w.trans;i&&i.db===this&&e.indexOf(`!`)===-1||(i=null);var a,o,s=e.indexOf(`?`)!==-1;e=e.replace(`!`,``).replace(`?`,``);try{if(o=t.map(function(e){if(e=e instanceof r.Table?e.name:e,typeof e!=`string`)throw TypeError(`Invalid table argument to Dexie.transaction(). Only Table or String are allowed`);return e}),e==`r`||e===St)a=St;else{if(e!=`rw`&&e!=Ct)throw new S.InvalidArgument(`Invalid transaction mode: `+e);a=Ct}if(i){if(i.mode===St&&a===Ct){if(!s)throw new S.SubTransaction(`Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY`);i=null}i&&o.forEach(function(e){if(i&&i.storeNames.indexOf(e)===-1){if(!s)throw new S.SubTransaction(`Table `+e+` not included in parent transaction.`);i=null}}),s&&i&&!i.active&&(i=null)}}catch(e){return i?i._promise(null,function(t,n){n(e)}):M(e)}var c=function e(t,n,r,i,a){return T.resolve().then(function(){var o=w.transless||w,s=t._createTransaction(n,r,t._dbSchema,i);if(s.explicit=!0,o={trans:s,transless:o},i)s.idbtrans=i.idbtrans;else try{s.create(),s.idbtrans._explicit=!0,t._state.PR1398_maxLoop=3}catch(i){return i.name===Se.InvalidState&&t.isOpen()&&0<--t._state.PR1398_maxLoop?(console.warn(`Dexie: Need to reopen db`),t.close({disableAutoOpen:!1}),t.open().then(function(){return e(t,n,r,null,a)})):M(i)}var c,l=me(a);return l&&dt(),o=T.follow(function(){var e;(c=a.call(s,s))&&(l?(e=ft.bind(null,null),c.then(e,e)):typeof c.next==`function`&&typeof c.throw==`function`&&(c=Gn(c)))},o),(c&&typeof c.then==`function`?T.resolve(c).then(function(e){return s.active?e:M(new S.PrematureCommit(`Transaction committed too early. See http://bit.ly/2kdckMn`))}):o.then(function(){return c})).then(function(e){return i&&s._resolve(),s._completion.then(function(){return e})}).catch(function(e){return s._reject(e),M(e)})})}.bind(null,this,a,o,i,n);return i?i._promise(a,c,`lock`):w.trans?ht(w.transless,function(){return r._whenReady(c)}):this._whenReady(c)},q.prototype.table=function(e){if(!l(this._allTables,e))throw new S.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]},q);function q(e,n){var r=this;this._middlewares={},this.verno=0;var i=q.dependencies;this._options=n=t({addons:q.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange,cache:`cloned`},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange},i=n.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var a,o,s,c,l,u={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:C,dbReadyPromise:null,cancelOpen:C,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:n.autoOpen};u.dbReadyPromise=new T(function(e){u.dbReadyResolve=e}),u.openCanceller=new T(function(e,t){u.cancelOpen=t}),this._state=u,this.name=e,this.on=Ft(this,`populate`,`blocked`,`versionchange`,`close`,{ready:[Ne,C]}),this.once=function(e,t){var n=function(){var i=[...arguments];r.on(e).unsubscribe(n),t.apply(r,i)};return r.on(e,n)},this.on.ready.subscribe=_(this.on.ready.subscribe,function(e){return function(t,n){q.vip(function(){var i,a=r._state;a.openComplete?(a.dbOpenError||T.resolve().then(t),n&&e(t)):a.onReadyBeingFired?(a.onReadyBeingFired.push(t),n&&e(t)):(e(t),i=r,n||e(function e(){i.on.ready.unsubscribe(t),i.on.ready.unsubscribe(e)}))})}}),this.Collection=(a=this,It(Wt.prototype,function(e,t){this.db=a;var n=Tt,r=null;if(t)try{n=t()}catch(e){r=e}var i=e._ctx,t=i.table,e=t.hook.reading.fire;this._ctx={table:t,index:i.index,isPrimKey:!i.index||t.schema.primKey.keyPath&&i.index===t.schema.primKey.name,range:n,keysOnly:!1,dir:`next`,unique:``,algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:i.or,valueMapper:e===Ee?null:e}})),this.Table=(o=this,It(Pt.prototype,function(e,t,n){this.db=o,this._tx=n,this.name=e,this.schema=t,this.hook=o._allTables[e]?o._allTables[e].hook:Ft(null,{creating:[ke,C],reading:[De,Ee],updating:[je,C],deleting:[Ae,C]})})),this.Transaction=(s=this,It(on.prototype,function(e,t,n,r,i){var a=this;e!==`readonly`&&t.forEach(function(e){e=(e=n[e])?.yProps,e&&(t=t.concat(e.map(function(e){return e.updatesTable})))}),this.db=s,this.mode=e,this.storeNames=t,this.schema=n,this.chromeTransactionDurability=r,this.idbtrans=null,this.on=Ft(this,`complete`,`error`,`abort`),this.parent=i||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new T(function(e,t){a._resolve=e,a._reject=t}),this._completion.then(function(){a.active=!1,a.on.complete.fire()},function(e){var t=a.active;return a.active=!1,a.on.error.fire(e),a.parent?a.parent._reject(e):t&&a.idbtrans&&a.idbtrans.abort(),M(e)})})),this.Version=(c=this,It(Dn.prototype,function(e){this.db=c,this._cfg={version:e,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(l=this,It($t.prototype,function(e,t,n){if(this.db=l,this._ctx={table:e,index:t===`:id`?null:t,or:n},this._cmp=this._ascending=P,this._descending=function(e,t){return P(t,e)},this._max=function(e,t){return 0<P(e,t)?e:t},this._min=function(e,t){return P(e,t)<0?e:t},this._IDBKeyRange=l._deps.IDBKeyRange,!this._IDBKeyRange)throw new S.MissingAPI})),this.on(`versionchange`,function(e){0<e.newVersion?console.warn(`Another connection wants to upgrade database '${r.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${r.name}'. Closing db now to resume the delete request.`),r.close({disableAutoOpen:!1})}),this.on(`blocked`,function(e){!e.newVersion||e.newVersion<e.oldVersion?console.warn(`Dexie.delete('${r.name}') was blocked`):console.warn(`Upgrade '${r.name}' blocked by other connection holding version ${e.oldVersion/10}`)}),this._maxKey=R(n.IDBKeyRange),this._createTransaction=function(e,t,n,i){return new r.Transaction(e,t,n,r._options.chromeTransactionDurability,i)},this._fireOnBlocked=function(e){r.on(`blocked`).fire(e),bt.filter(function(e){return e.name===r.name&&e!==r&&!e._state.vcFired}).map(function(t){return t.on(`versionchange`).fire(e)})},this.use(Qn),this.use(sr),this.use(tr),this.use(qn),this.use(Xn);var d=new Proxy(this,{get:function(e,t,n){if(t===`_vip`)return!0;if(t===`table`)return function(e){return cr(r.table(e),d)};var i=Reflect.get(e,t,n);return i instanceof Pt?cr(i,d):t===`tables`?i.map(function(e){return cr(e,d)}):t===`_createTransaction`?function(){return cr(i.apply(this,arguments),d)}:i}});this.vip=d,i.forEach(function(e){return e(r)})}var ur,ge=typeof Symbol<`u`&&`observable`in Symbol?Symbol.observable:`@@observable`,J=(dr.prototype.subscribe=function(e,t,n){return this._subscribe(e&&typeof e!=`function`?e:{next:e,error:t,complete:n})},dr.prototype[ge]=function(){return this},dr);function dr(e){this._subscribe=e}try{ur={indexedDB:r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB,IDBKeyRange:r.IDBKeyRange||r.webkitIDBKeyRange}}catch{ur={indexedDB:null,IDBKeyRange:null}}function fr(e){var t,n=!1,r=new J(function(r){var i=me(e),a,o=!1,s={},c={},u={get closed(){return o},unsubscribe:function(){o||(o=!0,a&&a.abort(),d&&an.storagemutated.unsubscribe(p))}};r.start&&r.start(u);var d=!1,f=function(){return _t(m)},p=function(e){In(s,e),Ln(c,s)&&f()},m=function(){var u,m,h;!o&&ur.indexedDB&&(s={},u={},a&&a.abort(),a=new AbortController,h=function(t){var n=rt();try{i&&dt();var r=ut(e,t);return r=i?r.finally(ft):r}finally{n&&it()}}(m={subscr:u,signal:a.signal,requery:f,querier:e,trans:null}),Promise.resolve(h).then(function(e){n=!0,t=e,o||m.signal.aborted||(s={},function(e){for(var t in e)if(l(e,t))return;return 1}(c=u)||d||(an(nn,p),d=!0),_t(function(){return!o&&r.next&&r.next(e)}))},function(e){n=!1,[`DatabaseClosedError`,`AbortError`].includes(e?.name)||o||_t(function(){o||r.error&&r.error(e)})}))};return setTimeout(f,0),u});return r.hasValue=function(){return n},r.getValue=function(){return t},r}var pr=lr;function mr(e){var t=gr;try{gr=!0,an.storagemutated.fire(e),Hn(e,!0)}finally{gr=t}}u(pr,t(t({},Te),{delete:function(e){return new pr(e,{addons:[]}).delete()},exists:function(e){return new pr(e,{addons:[]}).open().then(function(e){return e.close(),!0}).catch(`NoSuchDatabaseError`,function(){return!1})},getDatabaseNames:function(e){try{return t=pr.dependencies,n=t.indexedDB,t=t.IDBKeyRange,(kn(n)?Promise.resolve(n.databases()).then(function(e){return e.map(function(e){return e.name}).filter(function(e){return e!==xt})}):On(n,t).toCollection().primaryKeys()).then(e)}catch{return M(new S.MissingAPI)}var t,n},defineClass:function(){return function(e){o(this,e)}},ignoreTransaction:function(e){return w.trans?ht(w.transless,e):e()},vip:An,async:function(e){return function(){try{var t=Gn(e.apply(this,arguments));return t&&typeof t.then==`function`?t:T.resolve(t)}catch(e){return M(e)}}},spawn:function(e,t,n){try{var r=Gn(e.apply(n,t||[]));return r&&typeof r.then==`function`?r:T.resolve(r)}catch(e){return M(e)}},currentTransaction:{get:function(){return w.trans||null}},waitFor:function(e,t){return t=T.resolve(typeof e==`function`?pr.ignoreTransaction(e):e).timeout(t||6e4),w.trans?w.trans.waitFor(t):t},Promise:T,debug:{get:function(){return Pe},set:function(e){Fe(e)}},derive:p,extend:o,props:u,override:_,Events:Ft,on:an,liveQuery:fr,extendObservabilitySet:In,getByKeyPath:b,setByKeyPath:x,delByKeyPath:function(e,t){typeof t==`string`?x(e,t,void 0):`length`in t&&[].map.call(t,function(t){x(e,t,void 0)})},shallowClone:ee,deepClone:oe,getObjectDiff:Jn,cmp:P,asap:y,minKey:-1/0,addons:[],connections:bt,errnames:Se,dependencies:ur,cache:Rn,semVer:`4.2.1`,version:`4.2.1`.split(`.`).map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/10**(2*n)})})),pr.maxKey=R(pr.dependencies.IDBKeyRange),typeof dispatchEvent<`u`&&typeof addEventListener<`u`&&(an(nn,function(e){gr||=(e=new CustomEvent(rn,{detail:e}),gr=!0,dispatchEvent(e),!1)}),addEventListener(rn,function(e){e=e.detail,gr||mr(e)}));var hr,gr=!1,_r=function(){};return typeof BroadcastChannel<`u`&&((_r=function(){(hr=new BroadcastChannel(rn)).onmessage=function(e){return e.data&&mr(e.data)}})(),typeof hr.unref==`function`&&hr.unref(),an(nn,function(e){gr||hr.postMessage(e)})),typeof addEventListener<`u`&&(addEventListener(`pagehide`,function(e){if(!lr.disableBfCache&&e.persisted){Pe&&console.debug(`Dexie: handling persisted pagehide`),hr?.close();for(var t=0,n=bt;t<n.length;t++)n[t].close({disableAutoOpen:!1})}}),addEventListener(`pageshow`,function(e){!lr.disableBfCache&&e.persisted&&(Pe&&console.debug(`Dexie: handling persisted pageshow`),_r(),mr({all:new jn(-1/0,[[]])}))})),T.rejectionMapper=function(e,t){return!e||e instanceof ve||e instanceof TypeError||e instanceof SyntaxError||!e.name||!we[e.name]?e:(t=new we[e.name](t||e.message,e),`stack`in e&&f(t,`stack`,{get:function(){return this.inner.stack}}),t)},Fe(Pe),t(lr,Object.freeze({__proto__:null,Dexie:lr,liveQuery:fr,Entity:Dt,cmp:P,PropModification:jt,replacePrefix:function(e,t){return new jt({replacePrefix:[e,t]})},add:function(e){return new jt({add:e})},remove:function(e){return new jt({remove:e})},default:lr,RangeSet:jn,mergeRanges:W,rangesOverlap:Nn}),{default:lr}),lr})}))(),1),Mt=Symbol.for(`Dexie`),Nt=globalThis[Mt]||(globalThis[Mt]=jt.default);if(jt.default.semVer!==Nt.semVer)throw Error(`Two different versions of Dexie loaded in the same app: ${jt.default.semVer} and ${Nt.semVer}`);var{liveQuery:Pt,mergeRanges:F,rangesOverlap:Ft,RangeSet:It,cmp:Lt,Entity:Rt,PropModification:zt,replacePrefix:Bt,add:Vt,remove:Ht,DexieYProvider:Ut}=Nt;const Wt=new Nt(`KaraokeMachineDB`);Wt.version(1).stores({songs:`++id, title , cover , videoId, metadata`,songbook:`++id, title , cover , videoId, metadata`});var I=c(((e,t)=>{(function(n,r){typeof e==`object`&&t!==void 0?t.exports=r():typeof define==`function`&&define.amd?define(`RangeTouch`,r):(n||=self).RangeTouch=r()})(e,(function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,`value`in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function r(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]==null?{}:arguments[r];r%2?n(Object(i),!0).forEach((function(n){t(e,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var i={addCSS:!0,thumbWidth:15,watch:!0};function a(e,t){return function(){return Array.from(document.querySelectorAll(t)).includes(this)}.call(e,t)}var o=function(e){return e==null?null:e.constructor},s=function(e,t){return!!(e&&t&&e instanceof t)},c=function(e){return e==null},l=function(e){return o(e)===Object},u=function(e){return o(e)===String},d=function(e){return Array.isArray(e)},f=function(e){return s(e,NodeList)},p=u,m=d,h=f,g=function(e){return s(e,Element)},_=function(e){return s(e,Event)},v=function(e){return c(e)||(u(e)||d(e)||f(e))&&!e.length||l(e)&&!Object.keys(e).length};function y(e,t){if(1>t){var n=function(e){var t=`${e}`.match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return t?Math.max(0,(t[1]?t[1].length:0)-(t[2]?+t[2]:0)):0}(t);return parseFloat(e.toFixed(n))}return Math.round(e/t)*t}return function(){function t(e,n){(function(e,t){if(!(e instanceof t))throw TypeError(`Cannot call a class as a function`)})(this,t),g(e)?this.element=e:p(e)&&(this.element=document.querySelector(e)),g(this.element)&&v(this.element.rangeTouch)&&(this.config=r({},i,{},n),this.init())}return n=t,s=[{key:`setup`,value:function(e){var n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},o=null;if(v(e)||p(e)?o=Array.from(document.querySelectorAll(p(e)?e:`input[type="range"]`)):g(e)?o=[e]:h(e)?o=Array.from(e):m(e)&&(o=e.filter(g)),v(o))return null;var s=r({},i,{},n);return p(e)&&s.watch&&new MutationObserver((function(n){Array.from(n).forEach((function(n){Array.from(n.addedNodes).forEach((function(n){g(n)&&a(n,e)&&new t(n,s)}))}))})).observe(document.body,{childList:!0,subtree:!0}),o.map((function(e){return new t(e,n)}))}},{key:`enabled`,get:function(){return`ontouchstart`in document.documentElement}}],(o=[{key:`init`,value:function(){t.enabled&&(this.config.addCSS&&(this.element.style.userSelect=`none`,this.element.style.webKitUserSelect=`none`,this.element.style.touchAction=`manipulation`),this.listeners(!0),this.element.rangeTouch=this)}},{key:`destroy`,value:function(){t.enabled&&(this.config.addCSS&&(this.element.style.userSelect=``,this.element.style.webKitUserSelect=``,this.element.style.touchAction=``),this.listeners(!1),this.element.rangeTouch=null)}},{key:`listeners`,value:function(e){var t=this,n=e?`addEventListener`:`removeEventListener`;[`touchstart`,`touchmove`,`touchend`].forEach((function(e){t.element[n](e,(function(e){return t.set(e)}),!1)}))}},{key:`get`,value:function(e){if(!t.enabled||!_(e))return null;var n,r=e.target,i=e.changedTouches[0],a=parseFloat(r.getAttribute(`min`))||0,o=parseFloat(r.getAttribute(`max`))||100,s=parseFloat(r.getAttribute(`step`))||1,c=r.getBoundingClientRect(),l=100/c.width*(this.config.thumbWidth/2)/100;return 0>(n=100/c.width*(i.clientX-c.left))?n=0:100<n&&(n=100),50>n?n-=(100-2*n)*l:50<n&&(n+=2*(n-50)*l),a+y(n/100*(o-a),s)}},{key:`set`,value:function(e){t.enabled&&_(e)&&!e.target.disabled&&(e.preventDefault(),e.target.value=this.get(e),function(e,t){if(e&&t){var n=new Event(t,{bubbles:!0});e.dispatchEvent(n)}}(e.target,e.type===`touchend`?`change`:`input`))}}])&&e(n.prototype,o),s&&e(n,s),t;var n,o,s}()}))})),Gt=e=>e==null?null:e.constructor,Kt=(e,t)=>!!(e&&t&&e instanceof t),qt=e=>e==null,Jt=e=>Gt(e)===Object,Yt=e=>Gt(e)===Number&&!Number.isNaN(e),Xt=e=>Gt(e)===String,Zt=e=>Gt(e)===Boolean,Qt=e=>typeof e==`function`,$t=e=>Array.isArray(e),L=e=>Kt(e,WeakMap),en=e=>Kt(e,NodeList),tn=e=>Gt(e)===Text,nn=e=>Kt(e,Event),rn=e=>Kt(e,KeyboardEvent),an=e=>Kt(e,window.TextTrackCue)||Kt(e,window.VTTCue),on=e=>Kt(e,TextTrack)||!qt(e)&&Xt(e.kind),sn=e=>Kt(e,Promise)&&Qt(e.then);function cn(e){return typeof e==`object`&&!!e&&e.nodeType===1&&typeof e.style==`object`&&typeof e.ownerDocument==`object`}function ln(e){return qt(e)||(Xt(e)||$t(e)||en(e))&&!e.length||Jt(e)&&!Object.keys(e).length}function un(e){if(Kt(e,window.URL))return!0;if(!Xt(e))return!1;let t=e;(!e.startsWith(`http://`)||!e.startsWith(`https://`))&&(t=`http://${e}`);try{return!ln(new URL(t).hostname)}catch{return!1}}var R={nullOrUndefined:qt,object:Jt,number:Yt,string:Xt,boolean:Zt,function:Qt,array:$t,weakMap:L,nodeList:en,element:cn,textNode:tn,event:nn,keyboardEvent:rn,cue:an,track:on,promise:sn,url:un,empty:ln};const dn=(()=>{let e=document.createElement(`span`),t={WebkitTransition:`webkitTransitionEnd`,MozTransition:`transitionend`,OTransition:`oTransitionEnd otransitionend`,transition:`transitionend`},n=Object.keys(t).find(t=>e.style[t]!==void 0);return R.string(n)?t[n]:!1})();function fn(e,t){setTimeout(()=>{try{e.hidden=!0,e.offsetHeight,e.hidden=!1}catch{}},t)}function pn(e){return JSON.parse(JSON.stringify(e))}function mn(e,t){return t.split(`.`).reduce((e,t)=>e&&e[t],e)}function z(e={},...t){if(!t.length)return e;let n=t.shift();return R.object(n)?(Object.keys(n).forEach(t=>{R.object(n[t])?(Object.keys(e).includes(t)||Object.assign(e,{[t]:{}}),z(e[t],n[t])):Object.assign(e,{[t]:n[t]})}),z(e,...t)):e}function hn(e,t){let n=e.length?e:[e];Array.from(n).reverse().forEach((e,n)=>{let r=n>0?t.cloneNode(!0):t,i=e.parentNode,a=e.nextSibling;r.appendChild(e),a?i.insertBefore(r,a):i.appendChild(r)})}function gn(e,t){!R.element(e)||R.empty(t)||Object.entries(t).filter(([,e])=>!R.nullOrUndefined(e)).forEach(([t,n])=>e.setAttribute(t,n))}function B(e,t,n){let r=document.createElement(e);return R.object(t)&&gn(r,t),R.string(n)&&(r.textContent=n),r}function _n(e,t){!R.element(e)||!R.element(t)||t.parentNode.insertBefore(e,t.nextSibling)}function vn(e,t,n,r){R.element(t)&&t.appendChild(B(e,n,r))}function yn(e){if(R.nodeList(e)||R.array(e)){Array.from(e).forEach(yn);return}!R.element(e)||!R.element(e.parentNode)||e.parentNode.removeChild(e)}function bn(e){if(!R.element(e))return;let{length:t}=e.childNodes;for(;t>0;)e.removeChild(e.lastChild),--t}function xn(e,t){return!R.element(t)||!R.element(t.parentNode)||!R.element(e)?null:(t.parentNode.replaceChild(e,t),e)}function Sn(e,t){if(!R.string(e)||R.empty(e))return{};let n={},r=z({},t);return e.split(`,`).forEach(e=>{let t=e.trim(),i=t.replace(`.`,``),a=t.replace(/[[\]]/g,``).split(`=`),[o]=a,s=a.length>1?a[1].replace(/["']/g,``):``;switch(t.charAt(0)){case`.`:R.string(r.class)?n.class=`${r.class} ${i}`:n.class=i;break;case`#`:n.id=t.replace(`#`,``);break;case`[`:n[o]=s;break;default:break}}),z(r,n)}function Cn(e,t){if(!R.element(e))return;let n=t;R.boolean(n)||(n=!e.hidden),e.hidden=n}function V(e,t,n){if(R.nodeList(e))return Array.from(e).map(e=>V(e,t,n));if(R.element(e)){let r=`toggle`;return n!==void 0&&(r=n?`add`:`remove`),e.classList[r](t),e.classList.contains(t)}return!1}function wn(e,t){return R.element(e)&&e.classList.contains(t)}function Tn(e,t){let{prototype:n}=Element;function r(){return Array.from(document.querySelectorAll(t)).includes(this)}return(n.matches||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector||r).call(e,t)}function En(e,t){let{prototype:n}=Element;function r(){let e=this;do{if(Tn.matches(e,t))return e;e=e.parentElement||e.parentNode}while(e!==null&&e.nodeType===1);return null}return(n.closest||r).call(e,t)}function Dn(e){return this.elements.container.querySelectorAll(e)}function H(e){return this.elements.container.querySelector(e)}function On(e=null,t=!1){R.element(e)&&e.focus({preventScroll:!0,focusVisible:t})}var kn={"audio/ogg":`vorbis`,"audio/wav":`1`,"video/webm":`vp8, vorbis`,"video/mp4":`avc1.42E01E, mp4a.40.2`,"video/ogg":`theora`},An={audio:`canPlayType`in document.createElement(`audio`),video:`canPlayType`in document.createElement(`video`),check(e,t){let n=An[e]||t!==`html5`,r=n&&An.rangeInput;return{api:n,ui:r}},pip:(()=>document.pictureInPictureEnabled&&!B(`video`).disablePictureInPicture)(),airplay:R.function(window.WebKitPlaybackTargetAvailabilityEvent),playsinline:`playsInline`in document.createElement(`video`),mime(e){if(R.empty(e))return!1;let[t]=e.split(`/`),n=e;if(!this.isHTML5||t!==this.type)return!1;Object.keys(kn).includes(n)&&(n+=`; codecs="${kn[e]}"`);try{return!!(n&&this.media.canPlayType(n).replace(/no/,``))}catch{return!1}},textTracks:`textTracks`in document.createElement(`video`),rangeInput:(()=>{let e=document.createElement(`input`);return e.type=`range`,e.type===`range`})(),touch:`ontouchstart`in document.documentElement,transitions:dn!==!1,reducedMotion:`matchMedia`in window&&window.matchMedia(`(prefers-reduced-motion)`).matches},U=An,jn=(()=>{let e=!1;try{let t=Object.defineProperty({},`passive`,{get(){return e=!0,null}});window.addEventListener(`test`,null,t),window.removeEventListener(`test`,null,t)}catch{}return e})();function Mn(e,t,n,r=!1,i=!0,a=!1){if(!e||!(`addEventListener`in e)||R.empty(t)||!R.function(n))return;let o=t.split(` `),s=a;jn&&(s={passive:i,capture:a}),o.forEach(t=>{this&&this.eventListeners&&r&&this.eventListeners.push({element:e,type:t,callback:n,options:s}),e[r?`addEventListener`:`removeEventListener`](t,n,s)})}function W(e,t=``,n,r=!0,i=!1){Mn.call(this,e,t,n,!0,r,i)}function Nn(e,t=``,n,r=!0,i=!1){Mn.call(this,e,t,n,!1,r,i)}function Pn(e,t=``,n,r=!0,i=!1){let a=(...o)=>{Nn(e,t,a,r,i),n.apply(this,o)};Mn.call(this,e,t,a,!0,r,i)}function G(e,t=``,n=!1,r={}){if(!R.element(e)||R.empty(t))return;let i=new CustomEvent(t,{bubbles:n,detail:{...r,plyr:this}});e.dispatchEvent(i)}function Fn(){this&&this.eventListeners&&(this.eventListeners.forEach(e=>{let{element:t,type:n,callback:r,options:i}=e;t.removeEventListener(n,r,i)}),this.eventListeners=[])}function In(){return new Promise(e=>this.ready?setTimeout(e,0):W.call(this,this.elements.container,`ready`,e)).then(()=>{})}function Ln(e){R.promise(e)&&e.then(null,()=>{})}function Rn(e){return R.array(e)?e.filter((t,n)=>e.indexOf(t)===n):e}function zn(e,t){return!R.array(e)||!e.length?null:e.reduce((e,n)=>Math.abs(n-t)<Math.abs(e-t)?n:e)}function Bn(e){return!window||!window.CSS?!1:window.CSS.supports(e)}var Vn=[[1,1],[4,3],[3,4],[5,4],[4,5],[3,2],[2,3],[16,10],[10,16],[16,9],[9,16],[21,9],[9,21],[32,9],[9,32]].reduce((e,[t,n])=>({...e,[t/n]:[t,n]}),{});function Hn(e){return!R.array(e)&&(!R.string(e)||!e.includes(`:`))?!1:(R.array(e)?e:e.split(`:`)).map(Number).every(R.number)}function Un(e){if(!R.array(e)||!e.every(R.number))return null;let[t,n]=e,r=(e,t)=>t===0?e:r(t,e%t),i=r(t,n);return[t/i,n/i]}function Wn(e){let t=e=>Hn(e)?e.split(`:`).map(Number):null,n=t(e);if(n===null&&(n=t(this.config.ratio)),n===null&&!R.empty(this.embed)&&R.array(this.embed.ratio)&&({ratio:n}=this.embed),n===null&&this.isHTML5){let{videoWidth:e,videoHeight:t}=this.media;n=[e,t]}return Un(n)}function Gn(e){if(!this.isVideo)return{};let{wrapper:t}=this.elements,n=Wn.call(this,e);if(!R.array(n))return{};let[r,i]=Un(n),a=Bn(`aspect-ratio: ${r}/${i}`),o=100/r*i;if(a?t.style.aspectRatio=`${r}/${i}`:t.style.paddingBottom=`${o}%`,this.isVimeo&&!this.config.vimeo.premium&&this.supported.ui){let e=100/this.media.offsetWidth*Number.parseInt(window.getComputedStyle(this.media).paddingBottom,10),n=(e-o)/(e/50);this.fullscreen.active?t.style.paddingBottom=null:this.media.style.transform=`translateY(-${n}%)`}else this.isHTML5&&t.classList.add(this.config.classNames.videoFixedRatio);return{padding:o,ratio:n}}function Kn(e,t,n=.05){let r=e/t,i=zn(Object.keys(Vn),r);return Math.abs(i-r)<=n?Vn[i]:[e,t]}function qn(){let e=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),t=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0);return[e,t]}var Jn={getSources(){return this.isHTML5?Array.from(this.media.querySelectorAll(`source`)).filter(e=>{let t=e.getAttribute(`type`);return R.empty(t)?!0:U.mime.call(this,t)}):[]},getQualityOptions(){return this.config.quality.forced?this.config.quality.options:Jn.getSources.call(this).map(e=>Number(e.getAttribute(`size`))).filter(Boolean)},setup(){if(!this.isHTML5)return;let e=this;e.options.speed=e.config.speed.options,R.empty(this.config.ratio)||Gn.call(e),Object.defineProperty(e.media,`quality`,{get(){let t=Jn.getSources.call(e).find(t=>t.getAttribute(`src`)===e.source);return t&&Number(t.getAttribute(`size`))},set(t){if(e.quality!==t){if(e.config.quality.forced&&R.function(e.config.quality.onChange))e.config.quality.onChange(t);else{let n=Jn.getSources.call(e).find(e=>Number(e.getAttribute(`size`))===t);if(!n)return;let{currentTime:r,paused:i,preload:a,readyState:o,playbackRate:s}=e.media;e.media.src=n.getAttribute(`src`),(a!==`none`||o)&&(e.once(`loadedmetadata`,()=>{e.speed=s,e.currentTime=r,i||Ln(e.play())}),e.media.load())}G.call(e,e.media,`qualitychange`,!1,{quality:t})}}})},cancelRequests(){this.isHTML5&&(yn(Jn.getSources.call(this)),this.media.setAttribute(`src`,this.config.blankVideo),this.media.load(),this.debug.log(`Cancelled network requests`))}},Yn=Jn,Xn=!!window.document.documentMode,Zn=/Edge/.test(navigator.userAgent),Qn=`WebkitAppearance`in document.documentElement.style&&!/Edge/.test(navigator.userAgent),$n=/iPhone|iPod/i.test(navigator.userAgent)&&navigator.maxTouchPoints>1,er=navigator.platform===`MacIntel`&&navigator.maxTouchPoints>1,tr=/iPad|iPhone|iPod/i.test(navigator.userAgent)&&navigator.maxTouchPoints>1,K={isIE:Xn,isEdge:Zn,isWebKit:Qn,isIPhone:$n,isIPadOS:er,isIos:tr};function nr(e){return`${e}-${Math.floor(Math.random()*1e4)}`}function rr(e,...t){return R.empty(e)?e:e.toString().replace(/\{(\d+)\}/g,(e,n)=>t[n].toString())}function ir(e,t){return e===0||t===0||Number.isNaN(e)||Number.isNaN(t)?0:(e/t*100).toFixed(2)}function ar(e=``,t=``,n=``){return e.replace(new RegExp(t.toString().replace(/([.*+?^=!:${}()|[\]/\\])/g,`\\$1`),`g`),n.toString())}function or(e=``){return e.toString().replace(/\w\S*/g,e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase())}function sr(e=``){let t=e.toString();return t=ar(t,`-`,` `),t=ar(t,`_`,` `),t=or(t),ar(t,` `,``)}function cr(e=``){let t=e.toString();return t=sr(t),t.charAt(0).toLowerCase()+t.slice(1)}function lr(e){let t=document.createDocumentFragment(),n=document.createElement(`div`);return t.appendChild(n),n.innerHTML=e,t.firstChild.textContent}function q(e){let t=document.createElement(`div`);return t.appendChild(e),t.innerHTML}var ur={pip:`PIP`,airplay:`AirPlay`,html5:`HTML5`,vimeo:`Vimeo`,youtube:`YouTube`},J={get(e=``,t={}){if(R.empty(e)||R.empty(t))return``;let n=mn(t.i18n,e);if(R.empty(n))return Object.keys(ur).includes(e)?ur[e]:``;let r={"{seektime}":t.seekTime,"{title}":t.title};return Object.entries(r).forEach(([e,t])=>{n=ar(n,e,t)}),n}},dr=class e{constructor(e){this.enabled=e.config.storage.enabled,this.key=e.config.storage.key}static get supported(){try{if(!(`localStorage`in window))return!1;let e=`___test`;return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch{return!1}}get=t=>{if(!e.supported||!this.enabled)return null;let n=window.localStorage.getItem(this.key);if(R.empty(n))return null;let r=JSON.parse(n);return R.string(t)&&t.length?r[t]:r};set=t=>{if(!e.supported||!this.enabled||!R.object(t))return;let n=this.get();R.empty(n)&&(n={}),z(n,t);try{window.localStorage.setItem(this.key,JSON.stringify(n))}catch{}}};function fr(e,t=`text`,n=!1){return new Promise((r,i)=>{try{let i=new XMLHttpRequest;if(!(`withCredentials`in i))return;n&&(i.withCredentials=!0),i.addEventListener(`load`,()=>{if(t===`text`)try{r(JSON.parse(i.responseText))}catch{r(i.responseText)}else r(i.response)}),i.addEventListener(`error`,()=>{throw Error(i.status)}),i.open(`GET`,e,!0),i.responseType=t,i.send()}catch(e){i(e)}})}function pr(e,t){if(!R.string(e))return;let n=`cache`,r=R.string(t),i=!1,a=()=>document.getElementById(t)!==null,o=(e,t)=>{e.innerHTML=t,!(r&&a())&&document.body.insertAdjacentElement(`afterbegin`,e)};if(!r||!a()){let a=dr.supported,s=document.createElement(`div`);if(s.setAttribute(`hidden`,``),r&&s.setAttribute(`id`,t),a){let e=window.localStorage.getItem(`${n}-${t}`);if(i=e!==null,i){let t=JSON.parse(e);o(s,t.content)}}fr(e).then(e=>{if(!R.empty(e)){if(a)try{window.localStorage.setItem(`${n}-${t}`,JSON.stringify({content:e}))}catch{}o(s,e)}}).catch(()=>{})}}const mr=e=>Math.trunc(e/60/60%60,10),hr=e=>Math.trunc(e/60%60,10),gr=e=>Math.trunc(e%60,10);function _r(e=0,t=!1,n=!1){if(!R.number(e))return _r(void 0,t,n);let r=e=>`0${e}`.slice(-2),i=mr(e),a=hr(e),o=gr(e);return i=t||i>0?`${i}:`:``,`${n&&e>0?`-`:``}${i}${r(a)}:${r(o)}`}var vr=d(I()),Y={getIconUrl(){let e=new URL(this.config.iconUrl,window.location),t=window.location.host?window.location.host:window.top.location.host,n=e.host!==t||K.isIE&&!window.svg4everybody;return{url:this.config.iconUrl,cors:n}},findElements(){try{return this.elements.controls=H.call(this,this.config.selectors.controls.wrapper),this.elements.buttons={play:Dn.call(this,this.config.selectors.buttons.play),pause:H.call(this,this.config.selectors.buttons.pause),restart:H.call(this,this.config.selectors.buttons.restart),rewind:H.call(this,this.config.selectors.buttons.rewind),fastForward:H.call(this,this.config.selectors.buttons.fastForward),mute:H.call(this,this.config.selectors.buttons.mute),pip:H.call(this,this.config.selectors.buttons.pip),airplay:H.call(this,this.config.selectors.buttons.airplay),settings:H.call(this,this.config.selectors.buttons.settings),captions:H.call(this,this.config.selectors.buttons.captions),fullscreen:H.call(this,this.config.selectors.buttons.fullscreen)},this.elements.progress=H.call(this,this.config.selectors.progress),this.elements.inputs={seek:H.call(this,this.config.selectors.inputs.seek),volume:H.call(this,this.config.selectors.inputs.volume)},this.elements.display={buffer:H.call(this,this.config.selectors.display.buffer),currentTime:H.call(this,this.config.selectors.display.currentTime),duration:H.call(this,this.config.selectors.display.duration)},R.element(this.elements.progress)&&(this.elements.display.seekTooltip=this.elements.progress.querySelector(`.${this.config.classNames.tooltip}`)),!0}catch(e){return this.debug.warn(`It looks like there is a problem with your custom controls HTML`,e),this.toggleNativeControls(!0),!1}},createIcon(e,t){let n=`http://www.w3.org/2000/svg`,r=Y.getIconUrl.call(this),i=`${r.cors?``:r.url}#${this.config.iconPrefix}`,a=document.createElementNS(n,`svg`);gn(a,z(t,{"aria-hidden":`true`,focusable:`false`}));let o=document.createElementNS(n,`use`),s=`${i}-${e}`;return`href`in o&&o.setAttributeNS(`http://www.w3.org/1999/xlink`,`href`,s),o.setAttributeNS(`http://www.w3.org/1999/xlink`,`xlink:href`,s),a.appendChild(o),a},createLabel(e,t={}){let n=J.get(e,this.config),r={...t,class:[t.class,this.config.classNames.hidden].filter(Boolean).join(` `)};return B(`span`,r,n)},createBadge(e){if(R.empty(e))return null;let t=B(`span`,{class:this.config.classNames.menu.value});return t.appendChild(B(`span`,{class:this.config.classNames.menu.badge},e)),t},createButton(e,t){let n=z({},t),r=cr(e),i={element:`button`,toggle:!1,label:null,icon:null,labelPressed:null,iconPressed:null};switch([`element`,`icon`,`label`].forEach(e=>{Object.keys(n).includes(e)&&(i[e]=n[e],delete n[e])}),i.element===`button`&&!Object.keys(n).includes(`type`)&&(n.type=`button`),Object.keys(n).includes(`class`)?n.class.split(` `).includes(this.config.classNames.control)||z(n,{class:`${n.class} ${this.config.classNames.control}`}):n.class=this.config.classNames.control,e){case`play`:i.toggle=!0,i.label=`play`,i.labelPressed=`pause`,i.icon=`play`,i.iconPressed=`pause`;break;case`mute`:i.toggle=!0,i.label=`mute`,i.labelPressed=`unmute`,i.icon=`volume`,i.iconPressed=`muted`;break;case`captions`:i.toggle=!0,i.label=`enableCaptions`,i.labelPressed=`disableCaptions`,i.icon=`captions-off`,i.iconPressed=`captions-on`;break;case`fullscreen`:i.toggle=!0,i.label=`enterFullscreen`,i.labelPressed=`exitFullscreen`,i.icon=`enter-fullscreen`,i.iconPressed=`exit-fullscreen`;break;case`play-large`:n.class+=` ${this.config.classNames.control}--overlaid`,r=`play`,i.label=`play`,i.icon=`play`;break;default:R.empty(i.label)&&(i.label=r),R.empty(i.icon)&&(i.icon=e)}let a=B(i.element);return i.toggle?(a.appendChild(Y.createIcon.call(this,i.iconPressed,{class:`icon--pressed`})),a.appendChild(Y.createIcon.call(this,i.icon,{class:`icon--not-pressed`})),a.appendChild(Y.createLabel.call(this,i.labelPressed,{class:`label--pressed`})),a.appendChild(Y.createLabel.call(this,i.label,{class:`label--not-pressed`}))):(a.appendChild(Y.createIcon.call(this,i.icon)),a.appendChild(Y.createLabel.call(this,i.label))),z(n,Sn(this.config.selectors.buttons[r],n)),gn(a,n),r===`play`?(R.array(this.elements.buttons[r])||(this.elements.buttons[r]=[]),this.elements.buttons[r].push(a)):this.elements.buttons[r]=a,a},createRange(e,t){let n=B(`input`,z(Sn(this.config.selectors.inputs[e]),{type:`range`,min:0,max:100,step:.01,value:0,autocomplete:`off`,role:`slider`,"aria-label":J.get(e,this.config),"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":0},t));return this.elements.inputs[e]=n,Y.updateRangeFill.call(this,n),vr.default.setup(n),n},createProgress(e,t){let n=B(`progress`,z(Sn(this.config.selectors.display[e]),{min:0,max:100,value:0,role:`progressbar`,"aria-hidden":!0},t));if(e!==`volume`){n.appendChild(B(`span`,null,`0`));let t={played:`played`,buffer:`buffered`}[e];n.textContent=`% ${(t?J.get(t,this.config):``).toLowerCase()}`}return this.elements.display[e]=n,n},createTime(e,t){let n=Sn(this.config.selectors.display[e],t),r=B(`div`,z(n,{class:`${n.class?n.class:``} ${this.config.classNames.display.time} `.trim(),"aria-label":J.get(e,this.config),role:`timer`}),`00:00`);return this.elements.display[e]=r,r},bindMenuItemShortcuts(e,t){W.call(this,e,`keydown keyup`,n=>{if(![` `,`ArrowUp`,`ArrowDown`,`ArrowRight`].includes(n.key)||(n.preventDefault(),n.stopPropagation(),n.type===`keydown`))return;let r=Tn(e,`[role="menuitemradio"]`);if(!r&&[` `,`ArrowRight`].includes(n.key))Y.showMenuPanel.call(this,t,!0);else{let t;n.key!==` `&&(n.key===`ArrowDown`||r&&n.key===`ArrowRight`?(t=e.nextElementSibling,R.element(t)||(t=e.parentNode.firstElementChild)):(t=e.previousElementSibling,R.element(t)||(t=e.parentNode.lastElementChild)),On.call(this,t,!0))}},!1),W.call(this,e,`keyup`,e=>{e.key===`Return`&&Y.focusFirstMenuItem.call(this,null,!0)})},createMenuItem({value:e,list:t,type:n,title:r,badge:i=null,checked:a=!1}){let o=Sn(this.config.selectors.inputs[n]),s=B(`button`,z(o,{type:`button`,role:`menuitemradio`,class:`${this.config.classNames.control} ${o.class?o.class:``}`.trim(),"aria-checked":a,value:e})),c=B(`span`);c.innerHTML=r,R.element(i)&&c.appendChild(i),s.appendChild(c),Object.defineProperty(s,`checked`,{enumerable:!0,get(){return s.getAttribute(`aria-checked`)===`true`},set(e){e&&Array.from(s.parentNode.children).filter(e=>Tn(e,`[role="menuitemradio"]`)).forEach(e=>e.setAttribute(`aria-checked`,`false`)),s.setAttribute(`aria-checked`,e?`true`:`false`)}}),this.listeners.bind(s,`click keyup`,t=>{if(!(R.keyboardEvent(t)&&t.key!==` `)){switch(t.preventDefault(),t.stopPropagation(),s.checked=!0,n){case`language`:this.currentTrack=Number(e);break;case`quality`:this.quality=e;break;case`speed`:this.speed=Number.parseFloat(e);break;default:break}Y.showMenuPanel.call(this,`home`,R.keyboardEvent(t))}},n,!1),Y.bindMenuItemShortcuts.call(this,s,n),t.appendChild(s)},formatTime(e=0,t=!1){if(!R.number(e))return e;let n=mr(this.duration)>0;return _r(e,n,t)},updateTimeDisplay(e=null,t=0,n=!1){!R.element(e)||!R.number(t)||(e.textContent=Y.formatTime(t,n))},updateVolume(){this.supported.ui&&(R.element(this.elements.inputs.volume)&&Y.setRange.call(this,this.elements.inputs.volume,this.muted?0:this.volume),R.element(this.elements.buttons.mute)&&(this.elements.buttons.mute.pressed=this.muted||this.volume===0))},setRange(e,t=0){R.element(e)&&(e.value=t,Y.updateRangeFill.call(this,e))},updateProgress(e){if(!this.supported.ui||!R.event(e))return;let t=0,n=(e,t)=>{let n=R.number(t)?t:0,r=R.element(e)?e:this.elements.display.buffer;if(R.element(r)){r.value=n;let e=r.getElementsByTagName(`span`)[0];R.element(e)&&(e.childNodes[0].nodeValue=n)}};if(e)switch(e.type){case`timeupdate`:case`seeking`:case`seeked`:t=ir(this.currentTime,this.duration),e.type===`timeupdate`&&Y.setRange.call(this,this.elements.inputs.seek,t);break;case`playing`:case`progress`:n(this.elements.display.buffer,this.buffered*100);break;default:break}},updateRangeFill(e){let t=R.event(e)?e.target:e;if(!(!R.element(t)||t.getAttribute(`type`)!==`range`)){if(Tn(t,this.config.selectors.inputs.seek)){t.setAttribute(`aria-valuenow`,this.currentTime);let e=Y.formatTime(this.currentTime),n=Y.formatTime(this.duration),r=J.get(`seekLabel`,this.config);t.setAttribute(`aria-valuetext`,r.replace(`{currentTime}`,e).replace(`{duration}`,n))}else if(Tn(t,this.config.selectors.inputs.volume)){let e=t.value*100;t.setAttribute(`aria-valuenow`,e),t.setAttribute(`aria-valuetext`,`${e.toFixed(1)}%`)}else t.setAttribute(`aria-valuenow`,t.value);!K.isWebKit&&!K.isIPadOS||t.style.setProperty(`--value`,`${t.value/t.max*100}%`)}},updateSeekTooltip(e){if(!this.config.tooltips.seek||!R.element(this.elements.inputs.seek)||!R.element(this.elements.display.seekTooltip)||this.duration===0)return;let t=this.elements.display.seekTooltip,n=`${this.config.classNames.tooltip}--visible`,r=e=>V(t,n,e);if(this.touch){r(!1);return}let i=0,a=this.elements.progress.getBoundingClientRect();if(R.event(e)){let t=e.pageX-e.clientX;i=100/a.width*(e.pageX-a.left-t)}else if(wn(t,n))i=Number.parseFloat(t.style.left,10);else return;i<0?i=0:i>100&&(i=100);let o=this.duration/100*i;t.textContent=Y.formatTime(o);let s=this.config.markers?.points?.find(({time:e})=>e===Math.round(o));s&&t.insertAdjacentHTML(`afterbegin`,`${s.label}<br>`),t.style.left=`${i}%`,R.event(e)&&[`mouseenter`,`mouseleave`].includes(e.type)&&r(e.type===`mouseenter`)},timeUpdate(e){let t=!R.element(this.elements.display.duration)&&this.config.invertTime;Y.updateTimeDisplay.call(this,this.elements.display.currentTime,t?this.duration-this.currentTime:this.currentTime,t),!(e&&e.type===`timeupdate`&&this.media.seeking)&&Y.updateProgress.call(this,e)},durationUpdate(){if(!this.supported.ui||!this.config.invertTime&&this.currentTime)return;if(this.duration>=2**32){Cn(this.elements.display.currentTime,!0),Cn(this.elements.progress,!0);return}R.element(this.elements.inputs.seek)&&this.elements.inputs.seek.setAttribute(`aria-valuemax`,this.duration);let e=R.element(this.elements.display.duration);!e&&this.config.displayDuration&&this.paused&&Y.updateTimeDisplay.call(this,this.elements.display.currentTime,this.duration),e&&Y.updateTimeDisplay.call(this,this.elements.display.duration,this.duration),this.config.markers.enabled&&Y.setMarkers.call(this),Y.updateSeekTooltip.call(this)},toggleMenuButton(e,t){Cn(this.elements.settings.buttons[e],!t)},updateSetting(e,t,n){let r=this.elements.settings.panels[e],i=null,a=t;if(e===`captions`)i=this.currentTrack;else{if(i=R.empty(n)?this[e]:n,R.empty(i)&&(i=this.config[e].default),!R.empty(this.options[e])&&!this.options[e].includes(i)){this.debug.warn(`Unsupported value of '${i}' for ${e}`);return}if(!this.config[e].options.includes(i)){this.debug.warn(`Disabled value of '${i}' for ${e}`);return}}if(R.element(a)||(a=r&&r.querySelector(`[role="menu"]`)),!R.element(a))return;let o=this.elements.settings.buttons[e].querySelector(`.${this.config.classNames.menu.value}`);o.innerHTML=Y.getLabel.call(this,e,i);let s=a&&a.querySelector(`[value="${i}"]`);R.element(s)&&(s.checked=!0)},getLabel(e,t){switch(e){case`speed`:return t===1?J.get(`normal`,this.config):`${t}&times;`;case`quality`:if(R.number(t)){let e=J.get(`qualityLabel.${t}`,this.config);return e.length?e:`${t}p`}return or(t);case`captions`:return xr.getLabel.call(this);default:return null}},setQualityMenu(e){if(!R.element(this.elements.settings.panels.quality))return;let t=`quality`,n=this.elements.settings.panels.quality.querySelector(`[role="menu"]`);R.array(e)&&(this.options.quality=Rn(e).filter(e=>this.config.quality.options.includes(e)));let r=!R.empty(this.options.quality)&&this.options.quality.length>1;if(Y.toggleMenuButton.call(this,t,r),bn(n),Y.checkMenu.call(this),!r)return;let i=e=>{let t=J.get(`qualityBadge.${e}`,this.config);return t.length?Y.createBadge.call(this,t):null};this.options.quality.sort((e,t)=>{let n=this.config.quality.options;return n.indexOf(e)>n.indexOf(t)?1:-1}).forEach(e=>{Y.createMenuItem.call(this,{value:e,list:n,type:t,title:Y.getLabel.call(this,`quality`,e),badge:i(e)})}),Y.updateSetting.call(this,t,n)},setCaptionsMenu(){if(!R.element(this.elements.settings.panels.captions))return;let e=`captions`,t=this.elements.settings.panels.captions.querySelector(`[role="menu"]`),n=xr.getTracks.call(this),r=!!n.length;if(Y.toggleMenuButton.call(this,e,r),bn(t),Y.checkMenu.call(this),!r)return;let i=n.map((e,n)=>({value:n,checked:this.captions.toggled&&this.currentTrack===n,title:xr.getLabel.call(this,e),badge:e.language&&Y.createBadge.call(this,e.language.toUpperCase()),list:t,type:`language`}));i.unshift({value:-1,checked:!this.captions.toggled,title:J.get(`disabled`,this.config),list:t,type:`language`}),i.forEach(Y.createMenuItem.bind(this)),Y.updateSetting.call(this,e,t)},setSpeedMenu(){if(!R.element(this.elements.settings.panels.speed))return;let e=`speed`,t=this.elements.settings.panels.speed.querySelector(`[role="menu"]`);this.options.speed=this.options.speed.filter(e=>e>=this.minimumSpeed&&e<=this.maximumSpeed);let n=!R.empty(this.options.speed)&&this.options.speed.length>1;Y.toggleMenuButton.call(this,e,n),bn(t),Y.checkMenu.call(this),n&&(this.options.speed.forEach(n=>{Y.createMenuItem.call(this,{value:n,list:t,type:e,title:Y.getLabel.call(this,`speed`,n)})}),Y.updateSetting.call(this,e,t))},checkMenu(){let{buttons:e}=this.elements.settings,t=!R.empty(e)&&Object.values(e).some(e=>!e.hidden);Cn(this.elements.settings.menu,!t)},focusFirstMenuItem(e,t=!1){if(this.elements.settings.popup.hidden)return;let n=e;R.element(n)||(n=Object.values(this.elements.settings.panels).find(e=>!e.hidden));let r=n.querySelector(`[role^="menuitem"]`);On.call(this,r,t)},toggleMenu(e){let{popup:t}=this.elements.settings,n=this.elements.buttons.settings;if(!R.element(t)||!R.element(n))return;let{hidden:r}=t,i=r;if(R.boolean(e))i=e;else if(R.keyboardEvent(e)&&e.key===`Escape`)i=!1;else if(R.event(e)){let r=R.function(e.composedPath)?e.composedPath()[0]:e.target,a=t.contains(r);if(a||!a&&e.target!==n&&i)return}n.setAttribute(`aria-expanded`,i),Cn(t,!i),V(this.elements.container,this.config.classNames.menu.open,i),i&&R.keyboardEvent(e)?Y.focusFirstMenuItem.call(this,null,!0):!i&&!r&&On.call(this,n,R.keyboardEvent(e))},getMenuSize(e){let t=e.cloneNode(!0);t.style.position=`absolute`,t.style.opacity=0,t.removeAttribute(`hidden`),e.parentNode.appendChild(t);let n=t.scrollWidth,r=t.scrollHeight;return yn(t),{width:n,height:r}},showMenuPanel(e=``,t=!1){let n=this.elements.container.querySelector(`#plyr-settings-${this.id}-${e}`);if(!R.element(n))return;let r=n.parentNode,i=Array.from(r.children).find(e=>!e.hidden);if(U.transitions&&!U.reducedMotion){r.style.width=`${i.scrollWidth}px`,r.style.height=`${i.scrollHeight}px`;let e=Y.getMenuSize.call(this,n),t=e=>{e.target!==r||![`width`,`height`].includes(e.propertyName)||(r.style.width=``,r.style.height=``,Nn.call(this,r,dn,t))};W.call(this,r,dn,t),r.style.width=`${e.width}px`,r.style.height=`${e.height}px`}Cn(i,!0),Cn(n,!1),Y.focusFirstMenuItem.call(this,n,t)},setDownloadUrl(){let e=this.elements.buttons.download;R.element(e)&&e.setAttribute(`href`,this.download)},create(e){let{bindMenuItemShortcuts:t,createButton:n,createProgress:r,createRange:i,createTime:a,setQualityMenu:o,setSpeedMenu:s,showMenuPanel:c}=Y;this.elements.controls=null,R.array(this.config.controls)&&this.config.controls.includes(`play-large`)&&this.elements.container.appendChild(n.call(this,`play-large`));let l=B(`div`,Sn(this.config.selectors.controls.wrapper));this.elements.controls=l;let u={class:`plyr__controls__item`};return Rn(R.array(this.config.controls)?this.config.controls:[]).forEach(o=>{if(o===`restart`&&l.appendChild(n.call(this,`restart`,u)),o===`rewind`&&l.appendChild(n.call(this,`rewind`,u)),o===`play`&&l.appendChild(n.call(this,`play`,u)),o===`fast-forward`&&l.appendChild(n.call(this,`fast-forward`,u)),o===`progress`){let t=B(`div`,{class:`${u.class} plyr__progress__container`}),n=B(`div`,Sn(this.config.selectors.progress));if(n.appendChild(i.call(this,`seek`,{id:`plyr-seek-${e.id}`})),n.appendChild(r.call(this,`buffer`)),this.config.tooltips.seek){let e=B(`span`,{class:this.config.classNames.tooltip},`00:00`);n.appendChild(e),this.elements.display.seekTooltip=e}this.elements.progress=n,t.appendChild(this.elements.progress),l.appendChild(t)}if(o===`current-time`&&l.appendChild(a.call(this,`currentTime`,u)),o===`duration`&&l.appendChild(a.call(this,`duration`,u)),o===`mute`||o===`volume`){let{volume:t}=this.elements;if((!R.element(t)||!l.contains(t))&&(t=B(`div`,z({},u,{class:`${u.class} plyr__volume`.trim()})),this.elements.volume=t,l.appendChild(t)),o===`mute`&&t.appendChild(n.call(this,`mute`)),o===`volume`&&!K.isIos&&!K.isIPadOS){let n={max:1,step:.05,value:this.config.volume};t.appendChild(i.call(this,`volume`,z(n,{id:`plyr-volume-${e.id}`})))}}if(o===`captions`&&l.appendChild(n.call(this,`captions`,u)),o===`settings`&&!R.empty(this.config.settings)){let r=B(`div`,z({},u,{class:`${u.class} plyr__menu`.trim(),hidden:``}));r.appendChild(n.call(this,`settings`,{"aria-haspopup":!0,"aria-controls":`plyr-settings-${e.id}`,"aria-expanded":!1}));let i=B(`div`,{class:`plyr__menu__container`,id:`plyr-settings-${e.id}`,hidden:``}),a=B(`div`),o=B(`div`,{id:`plyr-settings-${e.id}-home`}),s=B(`div`,{role:`menu`});o.appendChild(s),a.appendChild(o),this.elements.settings.panels.home=o,this.config.settings.forEach(n=>{let r=B(`button`,z(Sn(this.config.selectors.buttons.settings),{type:`button`,class:`${this.config.classNames.control} ${this.config.classNames.control}--forward`,role:`menuitem`,"aria-haspopup":!0,hidden:``}));t.call(this,r,n),W.call(this,r,`click`,()=>{c.call(this,n,!1)});let i=B(`span`,null,J.get(n,this.config)),o=B(`span`,{class:this.config.classNames.menu.value});o.innerHTML=e[n],i.appendChild(o),r.appendChild(i),s.appendChild(r);let l=B(`div`,{id:`plyr-settings-${e.id}-${n}`,hidden:``}),u=B(`button`,{type:`button`,class:`${this.config.classNames.control} ${this.config.classNames.control}--back`});u.appendChild(B(`span`,{"aria-hidden":!0},J.get(n,this.config))),u.appendChild(B(`span`,{class:this.config.classNames.hidden},J.get(`menuBack`,this.config))),W.call(this,l,`keydown`,e=>{e.key===`ArrowLeft`&&(e.preventDefault(),e.stopPropagation(),c.call(this,`home`,!0))},!1),W.call(this,u,`click`,()=>{c.call(this,`home`,!1)}),l.appendChild(u),l.appendChild(B(`div`,{role:`menu`})),a.appendChild(l),this.elements.settings.buttons[n]=r,this.elements.settings.panels[n]=l}),i.appendChild(a),r.appendChild(i),l.appendChild(r),this.elements.settings.popup=i,this.elements.settings.menu=r}if(o===`pip`&&U.pip&&l.appendChild(n.call(this,`pip`,u)),o===`airplay`&&U.airplay&&l.appendChild(n.call(this,`airplay`,u)),o===`download`){let e=z({},u,{element:`a`,href:this.download,target:`_blank`});this.isHTML5&&(e.download=``);let{download:t}=this.config.urls;!R.url(t)&&this.isEmbed&&z(e,{icon:`logo-${this.provider}`,label:this.provider}),l.appendChild(n.call(this,`download`,e))}o===`fullscreen`&&l.appendChild(n.call(this,`fullscreen`,u))}),this.isHTML5&&o.call(this,Yn.getQualityOptions.call(this)),s.call(this),l},inject(){if(this.config.loadSprite){let e=Y.getIconUrl.call(this);e.cors&&pr(e.url,`sprite-plyr`)}this.id=Math.floor(Math.random()*1e4);let e=null;this.elements.controls=null;let t={id:this.id,seektime:this.config.seekTime,title:this.config.title},n=!0;R.function(this.config.controls)&&(this.config.controls=this.config.controls.call(this,t)),this.config.controls||(this.config.controls=[]),R.element(this.config.controls)||R.string(this.config.controls)?e=this.config.controls:(e=Y.create.call(this,{id:this.id,seektime:this.config.seekTime,speed:this.speed,quality:this.quality,captions:xr.getLabel.call(this)}),n=!1),n&&R.string(this.config.controls)&&(e=(e=>{let n=e;return Object.entries(t).forEach(([e,t])=>{n=ar(n,`{${e}}`,t)}),n})(e));let r;R.string(this.config.selectors.controls.container)&&(r=document.querySelector(this.config.selectors.controls.container)),R.element(r)||(r=this.elements.container);let i=R.element(e)?`insertAdjacentElement`:`insertAdjacentHTML`;if(r[i](`afterbegin`,e),R.element(this.elements.controls)||Y.findElements.call(this),!R.empty(this.elements.buttons)){let e=e=>{let t=this.config.classNames.controlPressed;e.setAttribute(`aria-pressed`,`false`),Object.defineProperty(e,`pressed`,{configurable:!0,enumerable:!0,get(){return wn(e,t)},set(n=!1){V(e,t,n),e.setAttribute(`aria-pressed`,n?`true`:`false`)}})};Object.values(this.elements.buttons).filter(Boolean).forEach(t=>{R.array(t)||R.nodeList(t)?Array.from(t).filter(Boolean).forEach(e):e(t)})}if(K.isEdge&&fn(r),this.config.tooltips.controls){let{classNames:e,selectors:t}=this.config,n=`${t.controls.wrapper} ${t.labels} .${e.hidden}`,r=Dn.call(this,n);Array.from(r).forEach(e=>{V(e,this.config.classNames.hidden,!1),V(e,this.config.classNames.tooltip,!0)})}},setMediaMetadata(){try{`mediaSession`in navigator&&(navigator.mediaSession.metadata=new window.MediaMetadata({title:this.config.mediaMetadata.title,artist:this.config.mediaMetadata.artist,album:this.config.mediaMetadata.album,artwork:this.config.mediaMetadata.artwork}))}catch{}},setMarkers(){if(!this.duration||this.elements.markers)return;let e=this.config.markers?.points?.filter(({time:e})=>e>0&&e<this.duration);if(!e?.length)return;let t=document.createDocumentFragment(),n=document.createDocumentFragment(),r=null,i=`${this.config.classNames.tooltip}--visible`,a=e=>V(r,i,e);e.forEach(e=>{let t=B(`span`,{class:this.config.classNames.marker},``),i=`${e.time/this.duration*100}%`;r&&(t.addEventListener(`mouseenter`,()=>{e.label||(r.style.left=i,r.innerHTML=e.label,a(!0))}),t.addEventListener(`mouseleave`,()=>{a(!1)})),t.addEventListener(`click`,()=>{this.currentTime=e.time}),t.style.left=i,n.appendChild(t)}),t.appendChild(n),this.config.tooltips.seek||(r=B(`span`,{class:this.config.classNames.tooltip},``),t.appendChild(r)),this.elements.markers={points:n,tip:r},this.elements.progress.appendChild(t)}},X=Y;function yr(e,t=!0){let n=e;if(t){let e=document.createElement(`a`);e.href=n,n=e.href}try{return new URL(n)}catch{return null}}function br(e){let t=new URLSearchParams;return R.object(e)&&Object.entries(e).forEach(([e,n])=>{t.set(e,n)}),t}var Z={setup(){if(!this.supported.ui)return;if(!this.isVideo||this.isYouTube||this.isHTML5&&!U.textTracks){R.array(this.config.controls)&&this.config.controls.includes(`settings`)&&this.config.settings.includes(`captions`)&&X.setCaptionsMenu.call(this);return}if(R.element(this.elements.captions)||(this.elements.captions=B(`div`,Sn(this.config.selectors.captions)),this.elements.captions.setAttribute(`dir`,`auto`),_n(this.elements.captions,this.elements.wrapper)),K.isIE&&window.URL){let e=this.media.querySelectorAll(`track`);Array.from(e).forEach(e=>{let t=e.getAttribute(`src`),n=yr(t);n!==null&&n.hostname!==window.location.href.hostname&&[`http:`,`https:`].includes(n.protocol)&&fr(t,`blob`).then(t=>{e.setAttribute(`src`,window.URL.createObjectURL(t))}).catch(()=>{yn(e)})})}let e=navigator.languages||[navigator.language||navigator.userLanguage||`en`],t=Rn(e.map(e=>e.split(`-`)[0])),n=(this.storage.get(`language`)||this.captions.language||this.config.captions.language||`auto`).toLowerCase();n===`auto`&&([n]=t);let r=this.storage.get(`captions`)||this.captions.active;if(R.boolean(r)||({active:r}=this.config.captions),Object.assign(this.captions,{toggled:!1,active:r,language:n,languages:t}),this.isHTML5){let e=this.config.captions.update?`addtrack removetrack`:`removetrack`;W.call(this,this.media.textTracks,e,Z.update.bind(this))}setTimeout(Z.update.bind(this),0)},update(){let e=Z.getTracks.call(this,!0),{active:t,language:n,meta:r,currentTrackNode:i}=this.captions,a=!!e.find(e=>e.language===n);this.isHTML5&&this.isVideo&&e.filter(e=>!r.get(e)).forEach(e=>{this.debug.log(`Track added`,e),r.set(e,{default:e.mode===`showing`}),e.mode===`showing`&&(e.mode=`hidden`),W.call(this,e,`cuechange`,()=>Z.updateCues.call(this))}),(a&&this.language!==n||!e.includes(i))&&(Z.setLanguage.call(this,n),Z.toggle.call(this,t&&a)),this.elements&&V(this.elements.container,this.config.classNames.captions.enabled,!R.empty(e)),R.array(this.config.controls)&&this.config.controls.includes(`settings`)&&this.config.settings.includes(`captions`)&&X.setCaptionsMenu.call(this)},toggle(e,t=!0){if(!this.supported.ui)return;let{toggled:n}=this.captions,r=this.config.classNames.captions.active,i=R.nullOrUndefined(e)?!n:e;if(i!==n){if(t||(this.captions.active=i,this.storage.set({captions:i})),!this.language&&i&&!t){let e=Z.getTracks.call(this),t=Z.findTrack.call(this,[this.captions.language,...this.captions.languages],!0);this.captions.language=t.language,Z.set.call(this,e.indexOf(t));return}this.elements.buttons.captions&&(this.elements.buttons.captions.pressed=i),V(this.elements.container,r,i),this.captions.toggled=i,X.updateSetting.call(this,`captions`),G.call(this,this.media,i?`captionsenabled`:`captionsdisabled`)}setTimeout(()=>{i&&this.captions.toggled&&(this.captions.currentTrackNode.mode=`hidden`)})},set(e,t=!0){let n=Z.getTracks.call(this);if(e===-1){Z.toggle.call(this,!1,t);return}if(!R.number(e)){this.debug.warn(`Invalid caption argument`,e);return}if(!(e in n)){this.debug.warn(`Track not found`,e);return}if(this.captions.currentTrack!==e){this.captions.currentTrack=e;let r=n[e],{language:i}=r||{};this.captions.currentTrackNode=r,X.updateSetting.call(this,`captions`),t||(this.captions.language=i,this.storage.set({language:i})),this.isVimeo&&this.embed.enableTextTrack(i),G.call(this,this.media,`languagechange`)}Z.toggle.call(this,!0,t),this.isHTML5&&this.isVideo&&Z.updateCues.call(this)},setLanguage(e,t=!0){if(!R.string(e)){this.debug.warn(`Invalid language argument`,e);return}let n=e.toLowerCase();this.captions.language=n;let r=Z.getTracks.call(this),i=Z.findTrack.call(this,[n]);Z.set.call(this,r.indexOf(i),t)},getTracks(e=!1){return Array.from((this.media||{}).textTracks||[]).filter(t=>!this.isHTML5||e||this.captions.meta.has(t)).filter(e=>[`captions`,`subtitles`].includes(e.kind))},findTrack(e,t=!1){let n=Z.getTracks.call(this),r=e=>Number((this.captions.meta.get(e)||{}).default),i=Array.from(n).sort((e,t)=>r(t)-r(e)),a;return e.every(e=>(a=i.find(t=>t.language===e),!a)),a||(t?i[0]:void 0)},getCurrentTrack(){return Z.getTracks.call(this)[this.currentTrack]},getLabel(e){let t=e;return!R.track(t)&&U.textTracks&&this.captions.toggled&&(t=Z.getCurrentTrack.call(this)),R.track(t)?R.empty(t.label)?R.empty(t.language)?J.get(`enabled`,this.config):e.language.toUpperCase():t.label:J.get(`disabled`,this.config)},updateCues(e){if(!this.supported.ui)return;if(!R.element(this.elements.captions)){this.debug.warn(`No captions element to render to`);return}if(!R.nullOrUndefined(e)&&!Array.isArray(e)){this.debug.warn(`updateCues: Invalid input`,e);return}let t=e;if(!t){let e=Z.getCurrentTrack.call(this);t=Array.from((e||{}).activeCues||[]).map(e=>e.getCueAsHTML()).map(q)}let n=t.map(e=>e.trim()).join(`
`);if(n!==this.elements.captions.innerHTML){bn(this.elements.captions);let e=B(`span`,Sn(this.config.selectors.caption));e.innerHTML=n,this.elements.captions.appendChild(e),G.call(this,this.media,`cuechange`)}}},xr=Z,Sr={enabled:!0,title:``,debug:!1,autoplay:!1,autopause:!0,playsinline:!0,seekTime:10,volume:1,muted:!1,duration:null,displayDuration:!0,invertTime:!0,toggleInvert:!0,ratio:null,clickToPlay:!0,hideControls:!0,resetOnEnd:!1,disableContextMenu:!0,loadSprite:!0,iconPrefix:`plyr`,iconUrl:`https://cdn.plyr.io/3.8.3/plyr.svg`,blankVideo:`https://cdn.plyr.io/static/blank.mp4`,quality:{default:576,options:[4320,2880,2160,1440,1080,720,576,480,360,240],forced:!1,onChange:null},loop:{active:!1},speed:{selected:1,options:[.5,.75,1,1.25,1.5,1.75,2,4]},keyboard:{focused:!0,global:!1},tooltips:{controls:!1,seek:!0},captions:{active:!1,language:`auto`,update:!1},fullscreen:{enabled:!0,fallback:!0,iosNative:!1},storage:{enabled:!0,key:`plyr`},controls:[`play-large`,`play`,`progress`,`current-time`,`mute`,`volume`,`captions`,`settings`,`pip`,`airplay`,`fullscreen`],settings:[`captions`,`quality`,`speed`],i18n:{restart:`Restart`,rewind:`Rewind {seektime}s`,play:`Play`,pause:`Pause`,fastForward:`Forward {seektime}s`,seek:`Seek`,seekLabel:`{currentTime} of {duration}`,played:`Played`,buffered:`Buffered`,currentTime:`Current time`,duration:`Duration`,volume:`Volume`,mute:`Mute`,unmute:`Unmute`,enableCaptions:`Enable captions`,disableCaptions:`Disable captions`,download:`Download`,enterFullscreen:`Enter fullscreen`,exitFullscreen:`Exit fullscreen`,frameTitle:`Player for {title}`,captions:`Captions`,settings:`Settings`,pip:`PIP`,menuBack:`Go back to previous menu`,speed:`Speed`,normal:`Normal`,quality:`Quality`,loop:`Loop`,start:`Start`,end:`End`,all:`All`,reset:`Reset`,disabled:`Disabled`,enabled:`Enabled`,advertisement:`Ad`,qualityBadge:{2160:`4K`,1440:`HD`,1080:`HD`,720:`HD`,576:`SD`,480:`SD`}},urls:{download:null,vimeo:{sdk:`https://player.vimeo.com/api/player.js`,iframe:`https://player.vimeo.com/video/{0}?{1}`,api:`https://vimeo.com/api/oembed.json?url={0}`},youtube:{sdk:`https://www.youtube.com/iframe_api`,api:`https://noembed.com/embed?url=https://www.youtube.com/watch?v={0}`},googleIMA:{sdk:`https://imasdk.googleapis.com/js/sdkloader/ima3.js`}},listeners:{seek:null,play:null,pause:null,restart:null,rewind:null,fastForward:null,mute:null,volume:null,captions:null,download:null,fullscreen:null,pip:null,airplay:null,speed:null,quality:null,loop:null,language:null},events:`ended.progress.stalled.playing.waiting.canplay.canplaythrough.loadstart.loadeddata.loadedmetadata.timeupdate.volumechange.play.pause.error.seeking.seeked.emptied.ratechange.cuechange.download.enterfullscreen.exitfullscreen.captionsenabled.captionsdisabled.languagechange.controlshidden.controlsshown.ready.statechange.qualitychange.adsloaded.adscontentpause.adscontentresume.adstarted.adsmidpoint.adscomplete.adsallcomplete.adsimpression.adsclick`.split(`.`),selectors:{editable:`input, textarea, select, [contenteditable]`,container:`.plyr`,controls:{container:null,wrapper:`.plyr__controls`},labels:`[data-plyr]`,buttons:{play:`[data-plyr="play"]`,pause:`[data-plyr="pause"]`,restart:`[data-plyr="restart"]`,rewind:`[data-plyr="rewind"]`,fastForward:`[data-plyr="fast-forward"]`,mute:`[data-plyr="mute"]`,captions:`[data-plyr="captions"]`,download:`[data-plyr="download"]`,fullscreen:`[data-plyr="fullscreen"]`,pip:`[data-plyr="pip"]`,airplay:`[data-plyr="airplay"]`,settings:`[data-plyr="settings"]`,loop:`[data-plyr="loop"]`},inputs:{seek:`[data-plyr="seek"]`,volume:`[data-plyr="volume"]`,speed:`[data-plyr="speed"]`,language:`[data-plyr="language"]`,quality:`[data-plyr="quality"]`},display:{currentTime:`.plyr__time--current`,duration:`.plyr__time--duration`,buffer:`.plyr__progress__buffer`,loop:`.plyr__progress__loop`,volume:`.plyr__volume--display`},progress:`.plyr__progress`,captions:`.plyr__captions`,caption:`.plyr__caption`},classNames:{type:`plyr--{0}`,provider:`plyr--{0}`,video:`plyr__video-wrapper`,embed:`plyr__video-embed`,videoFixedRatio:`plyr__video-wrapper--fixed-ratio`,embedContainer:`plyr__video-embed__container`,poster:`plyr__poster`,posterEnabled:`plyr__poster-enabled`,ads:`plyr__ads`,control:`plyr__control`,controlPressed:`plyr__control--pressed`,playing:`plyr--playing`,paused:`plyr--paused`,stopped:`plyr--stopped`,loading:`plyr--loading`,hover:`plyr--hover`,tooltip:`plyr__tooltip`,cues:`plyr__cues`,marker:`plyr__progress__marker`,hidden:`plyr__sr-only`,hideControls:`plyr--hide-controls`,isTouch:`plyr--is-touch`,uiSupported:`plyr--full-ui`,noTransition:`plyr--no-transition`,display:{time:`plyr__time`},menu:{value:`plyr__menu__value`,badge:`plyr__badge`,open:`plyr--menu-open`},captions:{enabled:`plyr--captions-enabled`,active:`plyr--captions-active`},fullscreen:{enabled:`plyr--fullscreen-enabled`,fallback:`plyr--fullscreen-fallback`},pip:{supported:`plyr--pip-supported`,active:`plyr--pip-active`},airplay:{supported:`plyr--airplay-supported`,active:`plyr--airplay-active`},previewThumbnails:{thumbContainer:`plyr__preview-thumb`,thumbContainerShown:`plyr__preview-thumb--is-shown`,imageContainer:`plyr__preview-thumb__image-container`,timeContainer:`plyr__preview-thumb__time-container`,scrubbingContainer:`plyr__preview-scrubbing`,scrubbingContainerShown:`plyr__preview-scrubbing--is-shown`}},attributes:{embed:{provider:`data-plyr-provider`,id:`data-plyr-embed-id`,hash:`data-plyr-embed-hash`}},ads:{enabled:!1,publisherId:``,tagUrl:``},previewThumbnails:{enabled:!1,src:``,withCredentials:!1},vimeo:{byline:!1,portrait:!1,title:!1,speed:!0,transparent:!1,customControls:!0,referrerPolicy:null,premium:!1},youtube:{rel:0,showinfo:0,iv_load_policy:3,modestbranding:1,customControls:!0,noCookie:!1},mediaMetadata:{title:``,artist:``,album:``,artwork:[]},markers:{enabled:!1,points:[]}};const Cr={active:`picture-in-picture`,inactive:`inline`},wr={html5:`html5`,youtube:`youtube`,vimeo:`vimeo`},Tr={audio:`audio`,video:`video`};function Er(e){return/^(?:https?:\/\/)?(?:www\.)?(?:youtube\.com|youtube-nocookie\.com|youtu\.?be)\/.+$/.test(e)?wr.youtube:/^https?:\/\/player.vimeo.com\/video\/\d{0,9}(?=\b|\/)/.test(e)?wr.vimeo:null}function Dr(){}var Or=class{constructor(e=!1){this.enabled=window.console&&e,this.enabled&&this.log(`Debugging enabled`)}get log(){return this.enabled?Function.prototype.bind.call(console.log,console):Dr}get warn(){return this.enabled?Function.prototype.bind.call(console.warn,console):Dr}get error(){return this.enabled?Function.prototype.bind.call(console.error,console):Dr}},kr=class e{constructor(t){this.player=t,this.prefix=e.prefix,this.property=e.property,this.scrollPosition={x:0,y:0},this.forceFallback=t.config.fullscreen.fallback===`force`,this.player.elements.fullscreen=t.config.fullscreen.container&&En(this.player.elements.container,t.config.fullscreen.container),W.call(this.player,document,this.prefix===`ms`?`MSFullscreenChange`:`${this.prefix}fullscreenchange`,()=>{this.onChange()}),W.call(this.player,this.player.elements.container,`dblclick`,e=>{R.element(this.player.elements.controls)&&this.player.elements.controls.contains(e.target)||this.player.listeners.proxy(e,this.toggle,`fullscreen`)}),W.call(this,this.player.elements.container,`keydown`,e=>this.trapFocus(e)),this.update()}static get nativeSupported(){return!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)}get useNative(){return e.nativeSupported&&!this.forceFallback}static get prefix(){if(R.function(document.exitFullscreen))return``;let e=``;return[`webkit`,`moz`,`ms`].some(t=>R.function(document[`${t}ExitFullscreen`])||R.function(document[`${t}CancelFullScreen`])?(e=t,!0):!1),e}static get property(){return this.prefix===`moz`?`FullScreen`:`Fullscreen`}get supported(){return[this.player.config.fullscreen.enabled,this.player.isVideo,e.nativeSupported||this.player.config.fullscreen.fallback,!this.player.isYouTube||e.nativeSupported||!K.isIos||this.player.config.playsinline&&!this.player.config.fullscreen.iosNative].every(Boolean)}get active(){if(!this.supported)return!1;if(!e.nativeSupported||this.forceFallback)return wn(this.target,this.player.config.classNames.fullscreen.fallback);let t=this.prefix?this.target.getRootNode()[`${this.prefix}${this.property}Element`]:this.target.getRootNode().fullscreenElement;return t&&t.shadowRoot?t===this.target.getRootNode().host:t===this.target}get target(){return K.isIos&&this.player.config.fullscreen.iosNative?this.player.media:this.player.elements.fullscreen??this.player.elements.container}onChange=()=>{if(!this.supported)return;let e=this.player.elements.buttons.fullscreen;R.element(e)&&(e.pressed=this.active);let t=this.target===this.player.media?this.target:this.player.elements.container;G.call(this.player,t,this.active?`enterfullscreen`:`exitfullscreen`,!0)};toggleFallback=(e=!1)=>{if(e?this.scrollPosition={x:window.scrollX??0,y:window.scrollY??0}:window.scrollTo(this.scrollPosition.x,this.scrollPosition.y),document.body.style.overflow=e?`hidden`:``,V(this.target,this.player.config.classNames.fullscreen.fallback,e),K.isIos){let t=document.head.querySelector(`meta[name="viewport"]`),n=`viewport-fit=cover`;t||(t=document.createElement(`meta`),t.setAttribute(`name`,`viewport`));let r=R.string(t.content)&&t.content.includes(n);e?(this.cleanupViewport=!r,r||(t.content+=`,${n}`)):this.cleanupViewport&&(t.content=t.content.split(`,`).filter(e=>e.trim()!==n).join(`,`))}this.onChange()};trapFocus=e=>{if(K.isIos||K.isIPadOS||!this.active||e.key!==`Tab`)return;let t=document.activeElement,n=Dn.call(this.player,`a[href], button:not(:disabled), input:not(:disabled), [tabindex]`),[r]=n,i=n[n.length-1];t===i&&!e.shiftKey?(r.focus(),e.preventDefault()):t===r&&e.shiftKey&&(i.focus(),e.preventDefault())};update=()=>{if(this.supported){let t;t=this.forceFallback?`Fallback (forced)`:e.nativeSupported?`Native`:`Fallback`,this.player.debug.log(`${t} fullscreen enabled`)}else this.player.debug.log(`Fullscreen not supported and fallback disabled`);V(this.player.elements.container,this.player.config.classNames.fullscreen.enabled,this.supported)};enter=()=>{this.supported&&(K.isIos&&this.player.config.fullscreen.iosNative?this.player.isVimeo?this.player.embed.requestFullscreen():this.target.webkitEnterFullscreen():!e.nativeSupported||this.forceFallback?this.toggleFallback(!0):this.prefix?R.empty(this.prefix)||this.target[`${this.prefix}Request${this.property}`]():this.target.requestFullscreen({navigationUI:`hide`}))};exit=()=>{if(this.supported){if(K.isIos&&this.player.config.fullscreen.iosNative)this.player.isVimeo?this.player.embed.exitFullscreen():this.target.webkitEnterFullscreen(),Ln(this.player.play());else if(!e.nativeSupported||this.forceFallback)this.toggleFallback(!1);else if(!this.prefix)(document.cancelFullScreen||document.exitFullscreen).call(document);else if(!R.empty(this.prefix)){let e=this.prefix===`moz`?`Cancel`:`Exit`;document[`${this.prefix}${e}${this.property}`]()}}};toggle=()=>{this.active?this.exit():this.enter()}};function Ar(e,t=1){return new Promise((n,r)=>{let i=new Image,a=()=>{delete i.onload,delete i.onerror,(i.naturalWidth>=t?n:r)(i)};Object.assign(i,{onload:a,onerror:a,src:e})})}var jr={addStyleHook(){V(this.elements.container,this.config.selectors.container.replace(`.`,``),!0),V(this.elements.container,this.config.classNames.uiSupported,this.supported.ui)},toggleNativeControls(e=!1){e&&this.isHTML5?this.media.setAttribute(`controls`,``):this.media.removeAttribute(`controls`)},build(){if(this.listeners.media(),!this.supported.ui){this.debug.warn(`Basic support only for ${this.provider} ${this.type}`),jr.toggleNativeControls.call(this,!0);return}R.element(this.elements.controls)||(X.inject.call(this),this.listeners.controls()),jr.toggleNativeControls.call(this),this.isHTML5&&xr.setup.call(this),this.volume=null,this.muted=null,this.loop=null,this.quality=null,this.speed=null,X.updateVolume.call(this),X.timeUpdate.call(this),X.durationUpdate.call(this),jr.checkPlaying.call(this),V(this.elements.container,this.config.classNames.pip.supported,U.pip&&this.isHTML5&&this.isVideo),V(this.elements.container,this.config.classNames.airplay.supported,U.airplay&&this.isHTML5),V(this.elements.container,this.config.classNames.isTouch,this.touch),this.ready=!0,setTimeout(()=>{G.call(this,this.media,`ready`)},0),jr.setTitle.call(this),this.poster&&jr.setPoster.call(this,this.poster,!1).catch(()=>{}),this.config.duration&&X.durationUpdate.call(this),this.config.mediaMetadata&&X.setMediaMetadata.call(this)},setTitle(){let e=J.get(`play`,this.config);if(R.string(this.config.title)&&!R.empty(this.config.title)&&(e+=`, ${this.config.title}`),Array.from(this.elements.buttons.play||[]).forEach(t=>{t.setAttribute(`aria-label`,e)}),this.isEmbed){let e=H.call(this,`iframe`);if(!R.element(e))return;let t=R.empty(this.config.title)?`video`:this.config.title,n=J.get(`frameTitle`,this.config);e.setAttribute(`title`,n.replace(`{title}`,t))}},togglePoster(e){V(this.elements.container,this.config.classNames.posterEnabled,e)},setPoster(e,t=!0){return t&&this.poster?Promise.reject(Error(`Poster already set`)):(this.media.setAttribute(`data-poster`,e),this.elements.poster.removeAttribute(`hidden`),In.call(this).then(()=>Ar(e)).catch(t=>{throw e===this.poster&&jr.togglePoster.call(this,!1),t}).then(()=>{if(e!==this.poster)throw Error(`setPoster cancelled by later call to setPoster`)}).then(()=>(Object.assign(this.elements.poster.style,{backgroundImage:`url('${e}')`,backgroundSize:``}),jr.togglePoster.call(this,!0),e)))},checkPlaying(e){V(this.elements.container,this.config.classNames.playing,this.playing),V(this.elements.container,this.config.classNames.paused,this.paused),V(this.elements.container,this.config.classNames.stopped,this.stopped),Array.from(this.elements.buttons.play||[]).forEach(e=>{Object.assign(e,{pressed:this.playing}),e.setAttribute(`aria-label`,J.get(this.playing?`pause`:`play`,this.config))}),!(R.event(e)&&e.type===`timeupdate`)&&jr.toggleControls.call(this)},checkLoading(e){this.loading=[`stalled`,`waiting`].includes(e.type),clearTimeout(this.timers.loading),this.timers.loading=setTimeout(()=>{V(this.elements.container,this.config.classNames.loading,this.loading),jr.toggleControls.call(this)},this.loading?250:0)},toggleControls(e){let{controls:t}=this.elements;if(t&&this.config.hideControls){let n=this.touch&&this.lastSeekTime+2e3>Date.now();this.toggleControls(!!(e||this.loading||this.paused||t.pressed||t.hover||n))}},migrateStyles(){Object.values({...this.media.style}).filter(e=>!R.empty(e)&&R.string(e)&&e.startsWith(`--plyr`)).forEach(e=>{this.elements.container.style.setProperty(e,this.media.style.getPropertyValue(e)),this.media.style.removeProperty(e)}),R.empty(this.media.style)&&this.media.removeAttribute(`style`)}},Q=jr,Mr=class{constructor(e){this.player=e,this.lastKey=null,this.focusTimer=null,this.lastKeyDown=null,this.handleKey=this.handleKey.bind(this),this.toggleMenu=this.toggleMenu.bind(this),this.firstTouch=this.firstTouch.bind(this)}handleKey(e){let{player:t}=this,{elements:n}=t,{key:r,type:i,altKey:a,ctrlKey:o,metaKey:s,shiftKey:c}=e,l=i===`keydown`,u=l&&r===this.lastKey;if(a||o||s||c||!r)return;let d=e=>{t.currentTime=t.duration/10*e};if(l){let i=document.activeElement;if(R.element(i)){let{editable:r}=t.config.selectors,{seek:a}=n.inputs;if(i!==a&&Tn(i,r)||e.key===` `&&Tn(i,`button, [role^="menuitem"]`))return}switch([` `,`ArrowLeft`,`ArrowUp`,`ArrowRight`,`ArrowDown`,`0`,`1`,`2`,`3`,`4`,`5`,`6`,`7`,`8`,`9`,`c`,`f`,`k`,`l`,`m`].includes(r)&&(e.preventDefault(),e.stopPropagation()),r){case`0`:case`1`:case`2`:case`3`:case`4`:case`5`:case`6`:case`7`:case`8`:case`9`:u||d(Number.parseInt(r,10));break;case` `:case`k`:u||Ln(t.togglePlay());break;case`ArrowUp`:t.increaseVolume(.1);break;case`ArrowDown`:t.decreaseVolume(.1);break;case`m`:u||(t.muted=!t.muted);break;case`ArrowRight`:t.forward();break;case`ArrowLeft`:t.rewind();break;case`f`:t.fullscreen.toggle();break;case`c`:u||t.toggleCaptions();break;case`l`:t.loop=!t.loop;break;default:break}r===`Escape`&&!t.fullscreen.usingNative&&t.fullscreen.active&&t.fullscreen.toggle(),this.lastKey=r}else this.lastKey=null}toggleMenu(e){X.toggleMenu.call(this.player,e)}firstTouch=()=>{let{player:e}=this,{elements:t}=e;e.touch=!0,V(t.container,e.config.classNames.isTouch,!0)};global=(e=!0)=>{let{player:t}=this;t.config.keyboard.global&&Mn.call(t,window,`keydown keyup`,this.handleKey,e,!1),Mn.call(t,document.body,`click`,this.toggleMenu,e),Pn.call(t,document.body,`touchstart`,this.firstTouch)};container=()=>{let{player:e}=this,{config:t,elements:n,timers:r}=e;!t.keyboard.global&&t.keyboard.focused&&W.call(e,n.container,`keydown keyup`,this.handleKey,!1),W.call(e,n.container,`mousemove mouseleave touchstart touchmove enterfullscreen exitfullscreen`,t=>{let{controls:i}=n;i&&t.type===`enterfullscreen`&&(i.pressed=!1,i.hover=!1);let a=[`touchstart`,`touchmove`,`mousemove`].includes(t.type),o=0;a&&(Q.toggleControls.call(e,!0),o=e.touch?3e3:2e3),clearTimeout(r.controls),r.controls=setTimeout(()=>Q.toggleControls.call(e,!1),o)});let i=()=>{if(!e.isVimeo||e.config.vimeo.premium)return;let t=n.wrapper,{active:r}=e.fullscreen,[i,a]=Wn.call(e),o=Bn(`aspect-ratio: ${i} / ${a}`);if(!r){o?(t.style.width=null,t.style.height=null):(t.style.maxWidth=null,t.style.margin=null);return}let[s,c]=qn(),l=s/c>i/a;o?(t.style.width=l?`auto`:`100%`,t.style.height=l?`100%`:`auto`):(t.style.maxWidth=l?`${c/a*i}px`:null,t.style.margin=l?`0 auto`:null)},a=()=>{clearTimeout(r.resized),r.resized=setTimeout(i,50)};W.call(e,n.container,`enterfullscreen exitfullscreen`,t=>{let{target:r}=e.fullscreen;r===n.container&&(!e.isEmbed&&R.empty(e.config.ratio)||(i(),(t.type===`enterfullscreen`?W:Nn).call(e,window,`resize`,a)))})};media=()=>{let{player:e}=this,{elements:t}=e;if(W.call(e,e.media,`timeupdate seeking seeked`,t=>X.timeUpdate.call(e,t)),W.call(e,e.media,`durationchange loadeddata loadedmetadata`,t=>X.durationUpdate.call(e,t)),W.call(e,e.media,`ended`,()=>{e.isHTML5&&e.isVideo&&e.config.resetOnEnd&&(e.restart(),e.pause())}),W.call(e,e.media,`progress playing seeking seeked`,t=>X.updateProgress.call(e,t)),W.call(e,e.media,`volumechange`,t=>X.updateVolume.call(e,t)),W.call(e,e.media,`playing play pause ended emptied timeupdate`,t=>Q.checkPlaying.call(e,t)),W.call(e,e.media,`waiting canplay seeked playing`,t=>Q.checkLoading.call(e,t)),e.supported.ui&&e.config.clickToPlay&&!e.isAudio){let n=H.call(e,`.${e.config.classNames.video}`);if(!R.element(n))return;W.call(e,t.container,`click`,r=>{![t.container,n].includes(r.target)&&!n.contains(r.target)||e.touch&&e.config.hideControls||(e.ended?(this.proxy(r,e.restart,`restart`),this.proxy(r,()=>{Ln(e.play())},`play`)):this.proxy(r,()=>{Ln(e.togglePlay())},`play`))})}e.supported.ui&&e.config.disableContextMenu&&W.call(e,t.wrapper,`contextmenu`,e=>{e.preventDefault()},!1),W.call(e,e.media,`volumechange`,()=>{e.storage.set({volume:e.volume,muted:e.muted})}),W.call(e,e.media,`ratechange`,()=>{X.updateSetting.call(e,`speed`),e.storage.set({speed:e.speed})}),W.call(e,e.media,`qualitychange`,t=>{X.updateSetting.call(e,`quality`,null,t.detail.quality)}),W.call(e,e.media,`ready qualitychange`,()=>{X.setDownloadUrl.call(e)});let n=e.config.events.concat([`keyup`,`keydown`]).join(` `);W.call(e,e.media,n,n=>{let{detail:r={}}=n;n.type===`error`&&(r=e.media.error),G.call(e,t.container,n.type,!0,r)})};proxy=(e,t,n)=>{let{player:r}=this,i=r.config.listeners[n],a=R.function(i),o=!0;a&&(o=i.call(r,e)),o!==!1&&R.function(t)&&t.call(r,e)};bind=(e,t,n,r,i=!0)=>{let{player:a}=this,o=a.config.listeners[r],s=R.function(o);W.call(a,e,t,e=>this.proxy(e,n,r),i&&!s)};controls=()=>{let{player:e}=this,{elements:t}=e,n=K.isIE?`change`:`input`;if(t.buttons.play&&Array.from(t.buttons.play).forEach(t=>{this.bind(t,`click`,()=>{Ln(e.togglePlay())},`play`)}),this.bind(t.buttons.restart,`click`,e.restart,`restart`),this.bind(t.buttons.rewind,`click`,()=>{e.lastSeekTime=Date.now(),e.rewind()},`rewind`),this.bind(t.buttons.fastForward,`click`,()=>{e.lastSeekTime=Date.now(),e.forward()},`fastForward`),this.bind(t.buttons.mute,`click`,()=>{e.muted=!e.muted},`mute`),this.bind(t.buttons.captions,`click`,()=>e.toggleCaptions()),this.bind(t.buttons.download,`click`,()=>{G.call(e,e.media,`download`)},`download`),this.bind(t.buttons.fullscreen,`click`,()=>{e.fullscreen.toggle()},`fullscreen`),this.bind(t.buttons.pip,`click`,()=>{e.pip=`toggle`},`pip`),this.bind(t.buttons.airplay,`click`,e.airplay,`airplay`),this.bind(t.buttons.settings,`click`,t=>{t.stopPropagation(),t.preventDefault(),X.toggleMenu.call(e,t)},null,!1),this.bind(t.buttons.settings,`keyup`,t=>{if([` `,`Enter`].includes(t.key)){if(t.key===`Enter`){X.focusFirstMenuItem.call(e,null,!0);return}t.preventDefault(),t.stopPropagation(),X.toggleMenu.call(e,t)}},null,!1),this.bind(t.settings.menu,`keydown`,t=>{t.key===`Escape`&&X.toggleMenu.call(e,t)}),this.bind(t.inputs.seek,`mousedown mousemove`,e=>{let n=t.progress.getBoundingClientRect(),r=e.pageX-e.clientX,i=100/n.width*(e.pageX-n.left-r);e.currentTarget.setAttribute(`seek-value`,i)}),this.bind(t.inputs.seek,`mousedown mouseup keydown keyup touchstart touchend`,t=>{let n=t.currentTarget,r=`play-on-seeked`;if(R.keyboardEvent(t)&&![`ArrowLeft`,`ArrowRight`].includes(t.key))return;e.lastSeekTime=Date.now();let i=n.hasAttribute(r),a=[`mouseup`,`touchend`,`keyup`].includes(t.type);i&&a?(n.removeAttribute(r),Ln(e.play())):!a&&e.playing&&(n.setAttribute(r,``),e.pause())}),K.isIos){let t=Dn.call(e,`input[type="range"]`);Array.from(t).forEach(e=>this.bind(e,n,e=>fn(e.target)))}this.bind(t.inputs.seek,n,t=>{let n=t.currentTarget,r=n.getAttribute(`seek-value`);R.empty(r)&&(r=n.value),n.removeAttribute(`seek-value`),e.currentTime=r/n.max*e.duration},`seek`),this.bind(t.progress,`mouseenter mouseleave mousemove`,t=>X.updateSeekTooltip.call(e,t)),this.bind(t.progress,`mousemove touchmove`,t=>{let{previewThumbnails:n}=e;n&&n.loaded&&n.startMove(t)}),this.bind(t.progress,`mouseleave touchend click`,()=>{let{previewThumbnails:t}=e;t&&t.loaded&&t.endMove(!1,!0)}),this.bind(t.progress,`mousedown touchstart`,t=>{let{previewThumbnails:n}=e;n&&n.loaded&&n.startScrubbing(t)}),this.bind(t.progress,`mouseup touchend`,t=>{let{previewThumbnails:n}=e;n&&n.loaded&&n.endScrubbing(t)}),K.isWebKit&&Array.from(Dn.call(e,`input[type="range"]`)).forEach(t=>{this.bind(t,`input`,t=>X.updateRangeFill.call(e,t.target))}),e.config.toggleInvert&&!R.element(t.display.duration)&&this.bind(t.display.currentTime,`click`,()=>{e.currentTime!==0&&(e.config.invertTime=!e.config.invertTime,X.timeUpdate.call(e))}),this.bind(t.inputs.volume,n,t=>{e.volume=t.target.value},`volume`),this.bind(t.controls,`mouseenter mouseleave`,n=>{t.controls.hover=!e.touch&&n.type===`mouseenter`}),t.fullscreen&&Array.from(t.fullscreen.children).filter(e=>!e.contains(t.container)).forEach(n=>{this.bind(n,`mouseenter mouseleave`,n=>{t.controls&&(t.controls.hover=!e.touch&&n.type===`mouseenter`)})}),this.bind(t.controls,`mousedown mouseup touchstart touchend touchcancel`,e=>{t.controls.pressed=[`mousedown`,`touchstart`].includes(e.type)}),this.bind(t.controls,`focusin`,()=>{let{config:n,timers:r}=e;V(t.controls,n.classNames.noTransition,!0),Q.toggleControls.call(e,!0),setTimeout(()=>{V(t.controls,n.classNames.noTransition,!1)},0);let i=this.touch?3e3:4e3;clearTimeout(r.controls),r.controls=setTimeout(()=>Q.toggleControls.call(e,!1),i)}),this.bind(t.inputs.volume,`wheel`,t=>{let n=t.webkitDirectionInvertedFromDevice,[r,i]=[t.deltaX,-t.deltaY].map(e=>n?-e:e),a=Math.sign(Math.abs(r)>Math.abs(i)?r:i);e.increaseVolume(a/50);let{volume:o}=e.media;(a===1&&o<1||a===-1&&o>0)&&t.preventDefault()},`volume`,!1)}},Nr=d(c(((e,t)=>{(function(n,r){typeof define==`function`&&define.amd?define([],r):typeof e==`object`?t.exports=r():n.loadjs=r()})(e,function(){var e=function(){},t={},n={},r={};function i(e,t){e=e.push?e:[e];for(var i=[],a=e.length,o=a,s=function(e,n){n.length&&i.push(e),o--,o||t(i)},c,l,u;a--;){if(c=e[a],l=n[c],l){s(c,l);continue}u=r[c]=r[c]||[],u.push(s)}}function a(e,t){if(e){var i=r[e];if(n[e]=t,i)for(;i.length;)i[0](e,t),i.splice(0,1)}}function o(t,n){t.call&&(t={success:t}),n.length?(t.error||e)(n):(t.success||e)(t)}function s(t,n,r,i){var a=document,o=r.async,c=(r.numRetries||0)+1,l=r.before||e,u=t.replace(/[\?|#].*$/,``),d=t.replace(/^(css|img|module|nomodule)!/,``),f,p,m;if(i||=0,/(^css!|\.css$)/.test(u))m=a.createElement(`link`),m.rel=`stylesheet`,m.href=d,f=`hideFocus`in m,f&&m.relList&&(f=0,m.rel=`preload`,m.as=`style`);else if(/(^img!|\.(png|gif|jpg|svg|webp)$)/.test(u))m=a.createElement(`img`),m.src=d;else if(m=a.createElement(`script`),m.src=d,m.async=o===void 0?!0:o,p=`noModule`in m,/^module!/.test(u)){if(!p)return n(t,`l`);m.type=`module`}else if(/^nomodule!/.test(u)&&p)return n(t,`l`);m.onload=m.onerror=m.onbeforeload=function(e){var a=e.type[0];if(f)try{m.sheet.cssText.length||(a=`e`)}catch(e){e.code!=18&&(a=`e`)}if(a==`e`){if(i+=1,i<c)return s(t,n,r,i)}else if(m.rel==`preload`&&m.as==`style`)return m.rel=`stylesheet`;n(t,a,e.defaultPrevented)},l(t,m)!==!1&&a.head.appendChild(m)}function c(e,t,n){e=e.push?e:[e];var r=e.length,i=r,a=[],o=function(e,n,i){if(n==`e`&&a.push(e),n==`b`)if(i)a.push(e);else return;r--,r||t(a)},c;for(c=0;c<i;c++)s(e[c],o,n)}function l(e,n,r){var i,s;if(n&&n.trim&&(i=n),s=(i?r:n)||{},i){if(i in t)throw`LoadJS`;t[i]=!0}function l(t,n){c(e,function(e){o(s,e),t&&o({success:t,error:n},e),a(i,e)},s)}if(s.returnPromise)return new Promise(l);l()}return l.ready=function(e,t){return i(e,function(e){o(t,e)}),l},l.done=function(e){a(e,[])},l.reset=function(){t={},n={},r={}},l.isDefined=function(e){return e in t},l})}))());function Pr(e){return new Promise((t,n)=>{(0,Nr.default)(e,{success:t,error:n})})}function Fr(e){if(R.empty(e))return null;if(R.number(Number(e)))return e;let t=e.match(/^.*(vimeo.com\/|video\/)(\d+).*/);return t?t[2]:e}function Ir(e){let t=e.match(/^.*(vimeo.com\/|video\/)(\d+)(\?.*h=|\/)+([\d,a-f]+)/);return t&&t.length===5?t[4]:null}function Lr(e){e&&!this.embed.hasPlayed&&(this.embed.hasPlayed=!0),this.media.paused===e&&(this.media.paused=!e,G.call(this,this.media,e?`play`:`pause`))}var Rr={setup(){let e=this;V(e.elements.wrapper,e.config.classNames.embed,!0),e.options.speed=e.config.speed.options,Gn.call(e),R.object(window.Vimeo)?Rr.ready.call(e):Pr(e.config.urls.vimeo.sdk).then(()=>{Rr.ready.call(e)}).catch(t=>{e.debug.warn(`Vimeo SDK (player.js) failed to load`,t)})},ready(){let e=this,t=e.config.vimeo,{premium:n,referrerPolicy:r,...i}=t,a=e.media.getAttribute(`src`),o=``;R.empty(a)?(a=e.media.getAttribute(e.config.attributes.embed.id),o=e.media.getAttribute(e.config.attributes.embed.hash)):o=Ir(a);let s=o?{h:o}:{};n&&Object.assign(i,{controls:!1,sidedock:!1});let c=br({loop:e.config.loop.active,autoplay:e.autoplay,muted:e.muted,gesture:`media`,playsinline:e.config.playsinline,...s,...i}),l=Fr(a),u=B(`iframe`),d=rr(e.config.urls.vimeo.iframe,l,c);if(u.setAttribute(`src`,d),u.setAttribute(`allowfullscreen`,``),u.setAttribute(`allow`,[`autoplay`,`fullscreen`,`picture-in-picture`,`encrypted-media`,`accelerometer`,`gyroscope`].join(`; `)),R.empty(r)||u.setAttribute(`referrerPolicy`,r),n||!t.customControls)u.setAttribute(`data-poster`,e.poster),e.media=xn(u,e.media);else{let t=B(`div`,{class:e.config.classNames.embedContainer,"data-poster":e.poster});t.appendChild(u),e.media=xn(t,e.media)}t.customControls||fr(rr(e.config.urls.vimeo.api,d)).then(t=>{R.empty(t)||!t.thumbnail_url||Q.setPoster.call(e,t.thumbnail_url).catch(()=>{})}),e.embed=new window.Vimeo.Player(u,{autopause:e.config.autopause,muted:e.muted}),e.media.paused=!0,e.media.currentTime=0,e.supported.ui&&e.embed.disableTextTrack(),e.media.play=()=>(Lr.call(e,!0),e.embed.play()),e.media.pause=()=>(Lr.call(e,!1),e.embed.pause()),e.media.stop=()=>{e.pause(),e.currentTime=0};let{currentTime:f}=e.media;Object.defineProperty(e.media,`currentTime`,{get(){return f},set(t){let{embed:n,media:r,paused:i,volume:a}=e,o=i&&!n.hasPlayed;r.seeking=!0,G.call(e,r,`seeking`),Promise.resolve(o&&n.setVolume(0)).then(()=>n.setCurrentTime(t)).then(()=>o&&n.pause()).then(()=>o&&n.setVolume(a)).catch(()=>{})}});let p=e.config.speed.selected;Object.defineProperty(e.media,`playbackRate`,{get(){return p},set(t){e.embed.setPlaybackRate(t).then(()=>{p=t,G.call(e,e.media,`ratechange`)}).catch(()=>{e.options.speed=[1]})}});let{volume:m}=e.config;Object.defineProperty(e.media,`volume`,{get(){return m},set(t){e.embed.setVolume(t).then(()=>{m=t,G.call(e,e.media,`volumechange`)})}});let{muted:h}=e.config;Object.defineProperty(e.media,`muted`,{get(){return h},set(t){let n=R.boolean(t)?t:!1;e.embed.setMuted(n?!0:e.config.muted).then(()=>{h=n,G.call(e,e.media,`volumechange`)})}});let{loop:g}=e.config;Object.defineProperty(e.media,`loop`,{get(){return g},set(t){let n=R.boolean(t)?t:e.config.loop.active;e.embed.setLoop(n).then(()=>{g=n})}});let _;e.embed.getVideoUrl().then(t=>{_=t,X.setDownloadUrl.call(e)}).catch(e=>{this.debug.warn(e)}),Object.defineProperty(e.media,`currentSrc`,{get(){return _}}),Object.defineProperty(e.media,`ended`,{get(){return e.currentTime===e.duration}}),Promise.all([e.embed.getVideoWidth(),e.embed.getVideoHeight()]).then(t=>{let[n,r]=t;e.embed.ratio=Kn(n,r),Gn.call(this)}),e.embed.setAutopause(e.config.autopause).then(t=>{e.config.autopause=t}),e.embed.getVideoTitle().then(t=>{e.config.title=t,Q.setTitle.call(this)}),e.embed.getCurrentTime().then(t=>{f=t,G.call(e,e.media,`timeupdate`)}),e.embed.getDuration().then(t=>{e.media.duration=t,G.call(e,e.media,`durationchange`)}),e.embed.getTextTracks().then(t=>{e.media.textTracks=t,xr.setup.call(e)}),e.embed.on(`cuechange`,({cues:t=[]})=>{let n=t.map(e=>lr(e.text));xr.updateCues.call(e,n)}),e.embed.on(`loaded`,()=>{e.embed.getPaused().then(t=>{Lr.call(e,!t),t||G.call(e,e.media,`playing`)}),R.element(e.embed.element)&&e.supported.ui&&e.embed.element.setAttribute(`tabindex`,-1)}),e.embed.on(`bufferstart`,()=>{G.call(e,e.media,`waiting`)}),e.embed.on(`bufferend`,()=>{G.call(e,e.media,`playing`)}),e.embed.on(`play`,()=>{Lr.call(e,!0),G.call(e,e.media,`playing`)}),e.embed.on(`pause`,()=>{Lr.call(e,!1)}),e.embed.on(`timeupdate`,t=>{e.media.seeking=!1,f=t.seconds,G.call(e,e.media,`timeupdate`)}),e.embed.on(`progress`,t=>{e.media.buffered=t.percent,G.call(e,e.media,`progress`),Number.parseInt(t.percent,10)===1&&G.call(e,e.media,`canplaythrough`),e.embed.getDuration().then(t=>{t!==e.media.duration&&(e.media.duration=t,G.call(e,e.media,`durationchange`))})}),e.embed.on(`seeked`,()=>{e.media.seeking=!1,G.call(e,e.media,`seeked`)}),e.embed.on(`ended`,()=>{e.media.paused=!0,G.call(e,e.media,`ended`)}),e.embed.on(`error`,t=>{e.media.error=t,G.call(e,e.media,`error`)}),t.customControls&&setTimeout(()=>Q.build.call(e),0)}},zr=Rr;function Br(e){if(R.empty(e))return null;let t=e.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/);return t&&t[2]?t[2]:e}function Vr(e){e&&!this.embed.hasPlayed&&(this.embed.hasPlayed=!0),this.media.paused===e&&(this.media.paused=!e,G.call(this,this.media,e?`play`:`pause`))}function Hr(e){if(e.noCookie)return`https://www.youtube-nocookie.com`;if(window.location.protocol===`http:`)return`http://www.youtube.com`}var Ur={setup(){if(V(this.elements.wrapper,this.config.classNames.embed,!0),R.object(window.YT)&&R.function(window.YT.Player))Ur.ready.call(this);else{let e=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=()=>{R.function(e)&&e(),Ur.ready.call(this)},Pr(this.config.urls.youtube.sdk).catch(e=>{this.debug.warn(`YouTube API failed to load`,e)})}},getTitle(e){let t=rr(this.config.urls.youtube.api,e);fr(t).then(e=>{if(R.object(e)){let{title:t,height:n,width:r}=e;this.config.title=t,Q.setTitle.call(this),this.embed.ratio=Kn(r,n)}Gn.call(this)}).catch(()=>{Gn.call(this)})},ready(){let e=this,t=e.config.youtube,n=e.media&&e.media.getAttribute(`id`);if(!R.empty(n)&&n.startsWith(`youtube-`))return;let r=e.media.getAttribute(`src`);R.empty(r)&&(r=e.media.getAttribute(this.config.attributes.embed.id));let i=Br(r),a=nr(e.provider),o=B(`div`,{id:a,"data-poster":t.customControls?e.poster:void 0});if(e.media=xn(o,e.media),t.customControls){let t=e=>`https://i.ytimg.com/vi/${i}/${e}default.jpg`;Ar(t(`maxres`),121).catch(()=>Ar(t(`sd`),121)).catch(()=>Ar(t(`hq`))).then(t=>Q.setPoster.call(e,t.src)).then(t=>{t.includes(`maxres`)||(e.elements.poster.style.backgroundSize=`cover`)}).catch(()=>{})}e.embed=new window.YT.Player(e.media,{videoId:i,host:Hr(t),playerVars:z({},{autoplay:e.config.autoplay?1:0,hl:e.config.hl,controls:e.supported.ui&&t.customControls?0:1,disablekb:1,playsinline:e.config.playsinline&&!e.config.fullscreen.iosNative?1:0,cc_load_policy:e.captions.active?1:0,cc_lang_pref:e.config.captions.language,widget_referrer:window?window.location.href:null},t),events:{onError(t){if(!e.media.error){let n=t.data,r={2:`The request contains an invalid parameter value. For example, this error occurs if you specify a video ID that does not have 11 characters, or if the video ID contains invalid characters, such as exclamation points or asterisks.`,5:`The requested content cannot be played in an HTML5 player or another error related to the HTML5 player has occurred.`,100:`The video requested was not found. This error occurs when a video has been removed (for any reason) or has been marked as private.`,101:`The owner of the requested video does not allow it to be played in embedded players.`,150:`The owner of the requested video does not allow it to be played in embedded players.`}[n]||`An unknown error occurred`;e.media.error={code:n,message:r},G.call(e,e.media,`error`)}},onPlaybackRateChange(t){let n=t.target;e.media.playbackRate=n.getPlaybackRate(),G.call(e,e.media,`ratechange`)},onReady(n){if(R.function(e.media.play))return;let r=n.target;Ur.getTitle.call(e,i),e.media.play=()=>{Vr.call(e,!0),r.playVideo()},e.media.pause=()=>{Vr.call(e,!1),r.pauseVideo()},e.media.stop=()=>{r.stopVideo()},e.media.duration=r.getDuration(),e.media.paused=!0,e.media.currentTime=0,Object.defineProperty(e.media,`currentTime`,{get(){return Number(r.getCurrentTime())},set(t){e.paused&&!e.embed.hasPlayed&&e.embed.mute(),e.media.seeking=!0,G.call(e,e.media,`seeking`),r.seekTo(t)}}),Object.defineProperty(e.media,`playbackRate`,{get(){return r.getPlaybackRate()},set(e){r.setPlaybackRate(e)}});let{volume:a}=e.config;Object.defineProperty(e.media,`volume`,{get(){return a},set(t){a=t,r.setVolume(a*100),G.call(e,e.media,`volumechange`)}});let{muted:o}=e.config;Object.defineProperty(e.media,`muted`,{get(){return o},set(t){let n=R.boolean(t)?t:o;o=n,r[n?`mute`:`unMute`](),r.setVolume(a*100),G.call(e,e.media,`volumechange`)}}),Object.defineProperty(e.media,`currentSrc`,{get(){return r.getVideoUrl()}}),Object.defineProperty(e.media,`ended`,{get(){return e.currentTime===e.duration}});let s=r.getAvailablePlaybackRates();e.options.speed=s.filter(t=>e.config.speed.options.includes(t)),e.supported.ui&&t.customControls&&e.media.setAttribute(`tabindex`,-1),G.call(e,e.media,`timeupdate`),G.call(e,e.media,`durationchange`),clearInterval(e.timers.buffering),e.timers.buffering=setInterval(()=>{e.media.buffered=r.getVideoLoadedFraction(),(e.media.lastBuffered===null||e.media.lastBuffered<e.media.buffered)&&G.call(e,e.media,`progress`),e.media.lastBuffered=e.media.buffered,e.media.buffered===1&&(clearInterval(e.timers.buffering),G.call(e,e.media,`canplaythrough`))},200),t.customControls&&setTimeout(()=>Q.build.call(e),50)},onStateChange(n){let r=n.target;switch(clearInterval(e.timers.playing),e.media.seeking&&[1,2].includes(n.data)&&(e.media.seeking=!1,G.call(e,e.media,`seeked`)),n.data){case-1:G.call(e,e.media,`timeupdate`),e.media.buffered=r.getVideoLoadedFraction(),G.call(e,e.media,`progress`);break;case 0:Vr.call(e,!1),e.media.loop?(r.stopVideo(),r.playVideo()):G.call(e,e.media,`ended`);break;case 1:t.customControls&&!e.config.autoplay&&e.media.paused&&!e.embed.hasPlayed?e.media.pause():(Vr.call(e,!0),G.call(e,e.media,`playing`),e.timers.playing=setInterval(()=>{G.call(e,e.media,`timeupdate`)},50),e.media.duration!==r.getDuration()&&(e.media.duration=r.getDuration(),G.call(e,e.media,`durationchange`)));break;case 2:e.muted||e.embed.unMute(),Vr.call(e,!1);break;case 3:G.call(e,e.media,`waiting`);break;default:break}G.call(e,e.elements.container,`statechange`,!1,{code:n.data})}}})}},Wr=Ur,Gr={setup(){if(!this.media){this.debug.warn(`No media element found!`);return}V(this.elements.container,this.config.classNames.type.replace(`{0}`,this.type),!0),V(this.elements.container,this.config.classNames.provider.replace(`{0}`,this.provider),!0),this.isEmbed&&V(this.elements.container,this.config.classNames.type.replace(`{0}`,`video`),!0),this.isVideo&&(this.elements.wrapper=B(`div`,{class:this.config.classNames.video}),hn(this.media,this.elements.wrapper),this.elements.poster=B(`div`,{class:this.config.classNames.poster}),this.elements.wrapper.appendChild(this.elements.poster)),this.isHTML5?Yn.setup.call(this):this.isYouTube?Wr.setup.call(this):this.isVimeo&&zr.setup.call(this)}};function Kr(e){e.manager&&e.manager.destroy(),e.elements.displayContainer&&e.elements.displayContainer.destroy(),e.elements.container.remove()}var qr=class{constructor(e){this.player=e,this.config=e.config.ads,this.playing=!1,this.initialized=!1,this.elements={container:null,displayContainer:null},this.manager=null,this.loader=null,this.cuePoints=null,this.events={},this.safetyTimer=null,this.countdownTimer=null,this.managerPromise=new Promise((e,t)=>{this.on(`loaded`,e),this.on(`error`,t)}),this.load()}get enabled(){let{config:e}=this;return this.player.isHTML5&&this.player.isVideo&&e.enabled&&(!R.empty(e.publisherId)||R.url(e.tagUrl))}load=()=>{this.enabled&&(!R.object(window.google)||!R.object(window.google.ima)?Pr(this.player.config.urls.googleIMA.sdk).then(()=>{this.ready()}).catch(()=>{this.trigger(`error`,Error(`Google IMA SDK failed to load`))}):this.ready())};ready=()=>{this.enabled||Kr(this),this.startSafetyTimer(12e3,`ready()`),this.managerPromise.then(()=>{this.clearSafetyTimer(`onAdsManagerLoaded()`)}),this.listeners(),this.setupIMA()};get tagUrl(){let{config:e}=this;if(R.url(e.tagUrl))return e.tagUrl;let t={AV_PUBLISHERID:`58c25bb0073ef448b1087ad6`,AV_CHANNELID:`5a0458dc28a06145e4519d21`,AV_URL:window.location.hostname,cb:Date.now(),AV_WIDTH:640,AV_HEIGHT:480,AV_CDIM2:e.publisherId};return`https://go.aniview.com/api/adserver6/vast/?${br(t)}`}setupIMA=()=>{this.elements.container=B(`div`,{class:this.player.config.classNames.ads}),this.player.elements.container.appendChild(this.elements.container),google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),google.ima.settings.setLocale(this.player.config.ads.language),google.ima.settings.setDisableCustomPlaybackForIOS10Plus(this.player.config.playsinline),this.elements.displayContainer=new google.ima.AdDisplayContainer(this.elements.container,this.player.media),this.loader=new google.ima.AdsLoader(this.elements.displayContainer),this.loader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,e=>this.onAdsManagerLoaded(e),!1),this.loader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,e=>this.onAdError(e),!1),this.requestAds()};requestAds=()=>{let{container:e}=this.player.elements;try{let t=new google.ima.AdsRequest;t.adTagUrl=this.tagUrl,t.linearAdSlotWidth=e.offsetWidth,t.linearAdSlotHeight=e.offsetHeight,t.nonLinearAdSlotWidth=e.offsetWidth,t.nonLinearAdSlotHeight=e.offsetHeight,t.forceNonLinearFullSlot=!1,t.setAdWillPlayMuted(!this.player.muted),this.loader.requestAds(t)}catch(e){this.onAdError(e)}};pollCountdown=(e=!1)=>{if(!e){clearInterval(this.countdownTimer),this.elements.container.removeAttribute(`data-badge-text`);return}this.countdownTimer=setInterval(()=>{let e=_r(Math.max(this.manager.getRemainingTime(),0)),t=`${J.get(`advertisement`,this.player.config)} - ${e}`;this.elements.container.setAttribute(`data-badge-text`,t)},100)};onAdsManagerLoaded=e=>{if(!this.enabled)return;let t=new google.ima.AdsRenderingSettings;t.restoreCustomPlaybackStateOnAdBreakComplete=!0,t.enablePreloading=!0,this.manager=e.getAdsManager(this.player,t),this.cuePoints=this.manager.getCuePoints(),this.manager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,e=>this.onAdError(e)),Object.keys(google.ima.AdEvent.Type).forEach(e=>{this.manager.addEventListener(google.ima.AdEvent.Type[e],e=>this.onAdEvent(e))}),this.trigger(`loaded`)};addCuePoints=()=>{R.empty(this.cuePoints)||this.cuePoints.forEach(e=>{if(e!==0&&e!==-1&&e<this.player.duration){let t=this.player.elements.progress;if(R.element(t)){let n=100/this.player.duration*e,r=B(`span`,{class:this.player.config.classNames.cues});r.style.left=`${n.toString()}%`,t.appendChild(r)}}})};onAdEvent=e=>{let{container:t}=this.player.elements,n=e.getAd(),r=e.getAdData();switch((e=>{G.call(this.player,this.player.media,`ads${e.replace(/_/g,``).toLowerCase()}`)})(e.type),e.type){case google.ima.AdEvent.Type.LOADED:this.trigger(`loaded`),this.pollCountdown(!0),n.isLinear()||(n.width=t.offsetWidth,n.height=t.offsetHeight);break;case google.ima.AdEvent.Type.STARTED:this.manager.setVolume(this.player.volume);break;case google.ima.AdEvent.Type.ALL_ADS_COMPLETED:this.player.ended?this.loadAds():this.loader.contentComplete();break;case google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED:this.pauseContent();break;case google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED:this.pollCountdown(),this.resumeContent();break;case google.ima.AdEvent.Type.LOG:r.adError&&this.player.debug.warn(`Non-fatal ad error: ${r.adError.getMessage()}`);break;default:break}};onAdError=e=>{this.cancel(),this.player.debug.warn(`Ads error`,e)};listeners=()=>{let{container:e}=this.player.elements,t;this.player.on(`canplay`,()=>{this.addCuePoints()}),this.player.on(`ended`,()=>{this.loader.contentComplete()}),this.player.on(`timeupdate`,()=>{t=this.player.currentTime}),this.player.on(`seeked`,()=>{let e=this.player.currentTime;R.empty(this.cuePoints)||this.cuePoints.forEach((n,r)=>{t<n&&n<e&&(this.manager.discardAdBreak(),this.cuePoints.splice(r,1))})}),window.addEventListener(`resize`,()=>{this.manager&&this.manager.resize(e.offsetWidth,e.offsetHeight,google.ima.ViewMode.NORMAL)})};play=()=>{let{container:e}=this.player.elements;this.managerPromise||this.resumeContent(),this.managerPromise.then(()=>{this.manager.setVolume(this.player.volume),this.elements.displayContainer.initialize();try{this.initialized||(this.manager.init(e.offsetWidth,e.offsetHeight,google.ima.ViewMode.NORMAL),this.manager.start()),this.initialized=!0}catch(e){this.onAdError(e)}}).catch(()=>{})};resumeContent=()=>{this.elements.container.style.zIndex=``,this.playing=!1,Ln(this.player.media.play())};pauseContent=()=>{this.elements.container.style.zIndex=3,this.playing=!0,this.player.media.pause()};cancel=()=>{this.initialized&&this.resumeContent(),this.trigger(`error`),this.loadAds()};loadAds=()=>{this.managerPromise.then(()=>{this.manager&&this.manager.destroy(),this.managerPromise=new Promise(e=>{this.on(`loaded`,e),this.player.debug.log(this.manager)}),this.initialized=!1,this.requestAds()}).catch(()=>{})};trigger=(e,...t)=>{let n=this.events[e];R.array(n)&&n.forEach(e=>{R.function(e)&&e.apply(this,t)})};on=(e,t)=>(R.array(this.events[e])||(this.events[e]=[]),this.events[e].push(t),this);startSafetyTimer=(e,t)=>{this.player.debug.log(`Safety timer invoked from: ${t}`),this.safetyTimer=setTimeout(()=>{this.cancel(),this.clearSafetyTimer(`startSafetyTimer()`)},e)};clearSafetyTimer=e=>{R.nullOrUndefined(this.safetyTimer)||(this.player.debug.log(`Safety timer cleared from: ${e}`),clearTimeout(this.safetyTimer),this.safetyTimer=null)}};function Jr(e=0,t=0,n=255){return Math.min(Math.max(e,t),n)}function Yr(e){let t=[];return e.split(/\r\n\r\n|\n\n|\r\r/).forEach(e=>{let n={};e.split(/\r\n|\n|\r/).forEach(e=>{if(R.number(n.startTime)){if(!R.empty(e.trim())&&R.empty(n.text)){let t=e.trim().split(`#xywh=`);[n.text]=t,t[1]&&([n.x,n.y,n.w,n.h]=t[1].split(`,`))}}else{let t=e.match(/(\d{2})?:?(\d{2}):(\d{2}).(\d{2,3})( ?--> ?)(\d{2})?:?(\d{2}):(\d{2}).(\d{2,3})/);t&&(n.startTime=Number(t[1]||0)*60*60+Number(t[2])*60+Number(t[3])+Number(`0.${t[4]}`),n.endTime=Number(t[6]||0)*60*60+Number(t[7])*60+Number(t[8])+Number(`0.${t[9]}`))}}),n.text&&t.push(n)}),t}function Xr(e,t){let n=t.width/t.height,r={};return e>n?(r.width=t.width,r.height=1/e*t.width):(r.height=t.height,r.width=e*t.height),r}var Zr=class{constructor(e){this.player=e,this.thumbnails=[],this.loaded=!1,this.lastMouseMoveTime=Date.now(),this.mouseDown=!1,this.loadedImages=[],this.elements={thumb:{},scrubbing:{}},this.load()}get enabled(){return this.player.isHTML5&&this.player.isVideo&&this.player.config.previewThumbnails.enabled}load=()=>{this.player.elements.display.seekTooltip&&(this.player.elements.display.seekTooltip.hidden=this.enabled),this.enabled&&this.getThumbnails().then(()=>{this.enabled&&(this.render(),this.determineContainerAutoSizing(),this.listeners(),this.loaded=!0)})};getThumbnails=()=>new Promise(e=>{let{src:t}=this.player.config.previewThumbnails;if(R.empty(t))throw Error(`Missing previewThumbnails.src config attribute`);let n=()=>{this.thumbnails.sort((e,t)=>e.height-t.height),this.player.debug.log(`Preview thumbnails`,this.thumbnails),e()};if(R.function(t))t(e=>{this.thumbnails=e,n()});else{let e=(R.string(t)?[t]:t).map(e=>this.getThumbnail(e));Promise.all(e).then(n)}});getThumbnail=e=>new Promise(t=>{fr(e,void 0,this.player.config.previewThumbnails.withCredentials).then(n=>{let r={frames:Yr(n),height:null,urlPrefix:``};!r.frames[0].text.startsWith(`/`)&&!r.frames[0].text.startsWith(`http://`)&&!r.frames[0].text.startsWith(`https://`)&&(r.urlPrefix=e.substring(0,e.lastIndexOf(`/`)+1));let i=new Image;i.onload=()=>{r.height=i.naturalHeight,r.width=i.naturalWidth,this.thumbnails.push(r),t()},i.src=r.urlPrefix+r.frames[0].text})});startMove=e=>{if(this.loaded&&!(!R.event(e)||![`touchmove`,`mousemove`].includes(e.type))&&this.player.media.duration){if(e.type===`touchmove`)this.seekTime=this.player.media.duration*(this.player.elements.inputs.seek.value/100);else{let t=this.player.elements.progress.getBoundingClientRect(),n=100/t.width*(e.pageX-t.left);this.seekTime=this.player.media.duration*(n/100),this.seekTime<0&&(this.seekTime=0),this.seekTime>this.player.media.duration-1&&(this.seekTime=this.player.media.duration-1),this.mousePosX=e.pageX,this.elements.thumb.time.textContent=_r(this.seekTime);let r=this.player.config.markers?.points?.find(({time:e})=>e===Math.round(this.seekTime));r&&this.elements.thumb.time.insertAdjacentHTML(`afterbegin`,`${r.label}<br>`)}this.showImageAtCurrentTime()}};endMove=()=>{this.toggleThumbContainer(!1,!0)};startScrubbing=e=>{(R.nullOrUndefined(e.button)||e.button===!1||e.button===0)&&(this.mouseDown=!0,this.player.media.duration&&(this.toggleScrubbingContainer(!0),this.toggleThumbContainer(!1,!0),this.showImageAtCurrentTime()))};endScrubbing=()=>{this.mouseDown=!1,Math.ceil(this.lastTime)===Math.ceil(this.player.media.currentTime)?this.toggleScrubbingContainer(!1):Pn.call(this.player,this.player.media,`timeupdate`,()=>{this.mouseDown||this.toggleScrubbingContainer(!1)})};listeners=()=>{this.player.on(`play`,()=>{this.toggleThumbContainer(!1,!0)}),this.player.on(`seeked`,()=>{this.toggleThumbContainer(!1)}),this.player.on(`timeupdate`,()=>{this.lastTime=this.player.media.currentTime})};render=()=>{this.elements.thumb.container=B(`div`,{class:this.player.config.classNames.previewThumbnails.thumbContainer}),this.elements.thumb.imageContainer=B(`div`,{class:this.player.config.classNames.previewThumbnails.imageContainer}),this.elements.thumb.container.appendChild(this.elements.thumb.imageContainer);let e=B(`div`,{class:this.player.config.classNames.previewThumbnails.timeContainer});this.elements.thumb.time=B(`span`,{},`00:00`),e.appendChild(this.elements.thumb.time),this.elements.thumb.imageContainer.appendChild(e),R.element(this.player.elements.progress)&&this.player.elements.progress.appendChild(this.elements.thumb.container),this.elements.scrubbing.container=B(`div`,{class:this.player.config.classNames.previewThumbnails.scrubbingContainer}),this.player.elements.wrapper.appendChild(this.elements.scrubbing.container)};destroy=()=>{this.elements.thumb.container&&this.elements.thumb.container.remove(),this.elements.scrubbing.container&&this.elements.scrubbing.container.remove()};showImageAtCurrentTime=()=>{this.mouseDown?this.setScrubbingContainerSize():this.setThumbContainerSizeAndPos();let e=this.thumbnails[0].frames.findIndex(e=>this.seekTime>=e.startTime&&this.seekTime<=e.endTime),t=e>=0,n=0;this.mouseDown||this.toggleThumbContainer(t),t&&(this.thumbnails.forEach((t,r)=>{this.loadedImages.includes(t.frames[e].text)&&(n=r)}),e!==this.showingThumb&&(this.showingThumb=e,this.loadImage(n)))};loadImage=(e=0)=>{let t=this.showingThumb,n=this.thumbnails[e],{urlPrefix:r}=n,i=n.frames[t],a=n.frames[t].text,o=r+a;if(!this.currentImageElement||this.currentImageElement.dataset.filename!==a){this.loadingImage&&this.usingSprites&&(this.loadingImage.onload=null);let n=new Image;n.src=o,n.dataset.index=t,n.dataset.filename=a,this.showingThumbFilename=a,this.player.debug.log(`Loading image: ${o}`),n.onload=()=>this.showImage(n,i,e,t,a,!0),this.loadingImage=n,this.removeOldImages(n)}else this.showImage(this.currentImageElement,i,e,t,a,!1),this.currentImageElement.dataset.index=t,this.removeOldImages(this.currentImageElement)};showImage=(e,t,n,r,i,a=!0)=>{this.player.debug.log(`Showing thumb: ${i}. num: ${r}. qual: ${n}. newimg: ${a}`),this.setImageSizeAndOffset(e,t),a&&(this.currentImageContainer.appendChild(e),this.currentImageElement=e,this.loadedImages.includes(i)||this.loadedImages.push(i)),this.preloadNearby(r,!0).then(this.preloadNearby(r,!1)).then(this.getHigherQuality(n,e,t,i))};removeOldImages=e=>{Array.from(this.currentImageContainer.children).forEach(t=>{if(t.tagName.toLowerCase()!==`img`)return;let n=this.usingSprites?500:1e3;if(t.dataset.index!==e.dataset.index&&!t.dataset.deleting){t.dataset.deleting=!0;let{currentImageContainer:e}=this;setTimeout(()=>{e.removeChild(t),this.player.debug.log(`Removing thumb: ${t.dataset.filename}`)},n)}})};preloadNearby=(e,t=!0)=>new Promise(n=>{setTimeout(()=>{let r=this.thumbnails[0].frames[e].text;if(this.showingThumbFilename===r){let i;i=t?this.thumbnails[0].frames.slice(e):this.thumbnails[0].frames.slice(0,e).reverse();let a=!1;i.forEach(e=>{let t=e.text;if(t!==r&&!this.loadedImages.includes(t)){a=!0,this.player.debug.log(`Preloading thumb filename: ${t}`);let{urlPrefix:e}=this.thumbnails[0],r=e+t,i=new Image;i.src=r,i.onload=()=>{this.player.debug.log(`Preloaded thumb filename: ${t}`),this.loadedImages.includes(t)||this.loadedImages.push(t),n()}}}),a||n()}},300)});getHigherQuality=(e,t,n,r)=>{if(e<this.thumbnails.length-1){let i=t.naturalHeight;this.usingSprites&&(i=n.h),i<this.thumbContainerHeight&&setTimeout(()=>{this.showingThumbFilename===r&&(this.player.debug.log(`Showing higher quality thumb for: ${r}`),this.loadImage(e+1))},300)}};get currentImageContainer(){return this.mouseDown?this.elements.scrubbing.container:this.elements.thumb.imageContainer}get usingSprites(){return Object.keys(this.thumbnails[0].frames[0]).includes(`w`)}get thumbAspectRatio(){return this.usingSprites?this.thumbnails[0].frames[0].w/this.thumbnails[0].frames[0].h:this.thumbnails[0].width/this.thumbnails[0].height}get thumbContainerHeight(){if(this.mouseDown){let{height:e}=Xr(this.thumbAspectRatio,{width:this.player.media.clientWidth,height:this.player.media.clientHeight});return e}return this.sizeSpecifiedInCSS?this.elements.thumb.imageContainer.clientHeight:Math.floor(this.player.media.clientWidth/this.thumbAspectRatio/4)}get currentImageElement(){return this.mouseDown?this.currentScrubbingImageElement:this.currentThumbnailImageElement}set currentImageElement(e){this.mouseDown?this.currentScrubbingImageElement=e:this.currentThumbnailImageElement=e}toggleThumbContainer=(e=!1,t=!1)=>{let n=this.player.config.classNames.previewThumbnails.thumbContainerShown;this.elements.thumb.container.classList.toggle(n,e),!e&&t&&(this.showingThumb=null,this.showingThumbFilename=null)};toggleScrubbingContainer=(e=!1)=>{let t=this.player.config.classNames.previewThumbnails.scrubbingContainerShown;this.elements.scrubbing.container.classList.toggle(t,e),e||(this.showingThumb=null,this.showingThumbFilename=null)};determineContainerAutoSizing=()=>{(this.elements.thumb.imageContainer.clientHeight>20||this.elements.thumb.imageContainer.clientWidth>20)&&(this.sizeSpecifiedInCSS=!0)};setThumbContainerSizeAndPos=()=>{let{imageContainer:e}=this.elements.thumb;if(this.sizeSpecifiedInCSS){if(e.clientHeight>20&&e.clientWidth<20){let t=Math.floor(e.clientHeight*this.thumbAspectRatio);e.style.width=`${t}px`}else if(e.clientHeight<20&&e.clientWidth>20){let t=Math.floor(e.clientWidth/this.thumbAspectRatio);e.style.height=`${t}px`}}else{let t=Math.floor(this.thumbContainerHeight*this.thumbAspectRatio);e.style.height=`${this.thumbContainerHeight}px`,e.style.width=`${t}px`}this.setThumbContainerPos()};setThumbContainerPos=()=>{let e=this.player.elements.progress.getBoundingClientRect(),t=this.player.elements.container.getBoundingClientRect(),{container:n}=this.elements.thumb,r=t.left-e.left+10,i=t.right-e.left-n.clientWidth-10,a=this.mousePosX-e.left-n.clientWidth/2,o=Jr(a,r,i);n.style.left=`${o}px`,n.style.setProperty(`--preview-arrow-offset`,`${a-o}px`)};setScrubbingContainerSize=()=>{let{width:e,height:t}=Xr(this.thumbAspectRatio,{width:this.player.media.clientWidth,height:this.player.media.clientHeight});this.elements.scrubbing.container.style.width=`${e}px`,this.elements.scrubbing.container.style.height=`${t}px`};setImageSizeAndOffset=(e,t)=>{if(!this.usingSprites)return;let n=this.thumbContainerHeight/t.h;e.style.height=`${e.naturalHeight*n}px`,e.style.width=`${e.naturalWidth*n}px`,e.style.left=`-${t.x*n}px`,e.style.top=`-${t.y*n}px`}},Qr={insertElements(e,t){R.string(t)?vn(e,this.media,{src:t}):R.array(t)&&t.forEach(t=>{vn(e,this.media,t)})},change(e){if(!mn(e,`sources.length`)){this.debug.warn(`Invalid source format`);return}Yn.cancelRequests.call(this),this.destroy(()=>{this.options.quality=[],yn(this.media),this.media=null,R.element(this.elements.container)&&this.elements.container.removeAttribute(`class`);let{sources:t,type:n}=e,[{provider:r=wr.html5,src:i}]=t,a=r===`html5`?n:`div`,o=r===`html5`?{}:{src:i};Object.assign(this,{provider:r,type:n,supported:U.check(n,r,this.config.playsinline),media:B(a,o)}),this.elements.container.appendChild(this.media),R.boolean(e.autoplay)&&(this.config.autoplay=e.autoplay),this.isHTML5&&(this.config.crossorigin&&this.media.setAttribute(`crossorigin`,``),this.config.autoplay&&this.media.setAttribute(`autoplay`,``),R.empty(e.poster)||(this.poster=e.poster),this.config.loop.active&&this.media.setAttribute(`loop`,``),this.config.muted&&this.media.setAttribute(`muted`,``),this.config.playsinline&&this.media.setAttribute(`playsinline`,``)),Q.addStyleHook.call(this),this.isHTML5&&Qr.insertElements.call(this,`source`,t),this.config.title=e.title,Gr.setup.call(this),this.isHTML5&&Object.keys(e).includes(`tracks`)&&Qr.insertElements.call(this,`track`,e.tracks),(this.isHTML5||this.isEmbed&&!this.supported.ui)&&Q.build.call(this),this.isHTML5&&this.media.load(),R.empty(e.previewThumbnails)||(Object.assign(this.config.previewThumbnails,e.previewThumbnails),this.previewThumbnails&&this.previewThumbnails.loaded&&(this.previewThumbnails.destroy(),this.previewThumbnails=null),this.config.previewThumbnails.enabled&&(this.previewThumbnails=new Zr(this))),this.fullscreen.update()},!0)}},$r=Qr,ei=class e{constructor(t,n){if(this.timers={},this.ready=!1,this.loading=!1,this.failed=!1,this.touch=U.touch,this.media=t,R.string(this.media)&&(this.media=document.querySelectorAll(this.media)),(window.jQuery&&this.media instanceof jQuery||R.nodeList(this.media)||R.array(this.media))&&(this.media=this.media[0]),this.config=z({},Sr,e.defaults,n||{},(()=>{try{return JSON.parse(this.media.getAttribute(`data-plyr-config`))}catch{return{}}})()),this.elements={container:null,fullscreen:null,captions:null,buttons:{},display:{},progress:{},inputs:{},settings:{popup:null,menu:null,panels:{},buttons:{}}},this.captions={active:null,currentTrack:-1,meta:new WeakMap},this.fullscreen={active:!1},this.options={speed:[],quality:[]},this.debug=new Or(this.config.debug),this.debug.log(`Config`,this.config),this.debug.log(`Support`,U),R.nullOrUndefined(this.media)||!R.element(this.media)){this.debug.error(`Setup failed: no suitable element passed`);return}if(this.media.plyr){this.debug.warn(`Target already setup`);return}if(!this.config.enabled){this.debug.error(`Setup failed: disabled by config`);return}if(!U.check().api){this.debug.error(`Setup failed: no support`);return}let r=this.media.cloneNode(!0);r.autoplay=!1,this.elements.original=r;let i=this.media.tagName.toLowerCase(),a=null,o=null;switch(i){case`div`:if(a=this.media.querySelector(`iframe`),R.element(a)){if(o=yr(a.getAttribute(`src`)),this.provider=Er(o.toString()),this.elements.container=this.media,this.media=a,this.elements.container.className=``,o.search.length){let e=[`1`,`true`];e.includes(o.searchParams.get(`autoplay`))&&(this.config.autoplay=!0),e.includes(o.searchParams.get(`loop`))&&(this.config.loop.active=!0),this.isYouTube?(this.config.playsinline=e.includes(o.searchParams.get(`playsinline`)),this.config.youtube.hl=o.searchParams.get(`hl`)):this.config.playsinline=!0}}else this.provider=this.media.getAttribute(this.config.attributes.embed.provider),this.media.removeAttribute(this.config.attributes.embed.provider);if(R.empty(this.provider)||!Object.values(wr).includes(this.provider)){this.debug.error(`Setup failed: Invalid provider`);return}this.type=Tr.video;break;case`video`:case`audio`:this.type=i,this.provider=wr.html5,this.media.hasAttribute(`crossorigin`)&&(this.config.crossorigin=!0),this.media.hasAttribute(`autoplay`)&&(this.config.autoplay=!0),(this.media.hasAttribute(`playsinline`)||this.media.hasAttribute(`webkit-playsinline`))&&(this.config.playsinline=!0),this.media.hasAttribute(`muted`)&&(this.config.muted=!0),this.media.hasAttribute(`loop`)&&(this.config.loop.active=!0);break;default:this.debug.error(`Setup failed: unsupported type`);return}if(this.supported=U.check(this.type,this.provider),!this.supported.api){this.debug.error(`Setup failed: no support`);return}this.eventListeners=[],this.listeners=new Mr(this),this.storage=new dr(this),this.media.plyr=this,R.element(this.elements.container)||(this.elements.container=B(`div`),hn(this.media,this.elements.container)),Q.migrateStyles.call(this),Q.addStyleHook.call(this),Gr.setup.call(this),this.config.debug&&W.call(this,this.elements.container,this.config.events.join(` `),e=>{this.debug.log(`event: ${e.type}`)}),this.fullscreen=new kr(this),(this.isHTML5||this.isEmbed&&!this.supported.ui)&&Q.build.call(this),this.listeners.container(),this.listeners.global(),this.config.ads.enabled&&(this.ads=new qr(this)),this.isHTML5&&this.config.autoplay&&this.once(`canplay`,()=>Ln(this.play())),this.lastSeekTime=0,this.config.previewThumbnails.enabled&&(this.previewThumbnails=new Zr(this))}get isHTML5(){return this.provider===wr.html5}get isEmbed(){return this.isYouTube||this.isVimeo}get isYouTube(){return this.provider===wr.youtube}get isVimeo(){return this.provider===wr.vimeo}get isVideo(){return this.type===Tr.video}get isAudio(){return this.type===Tr.audio}play=()=>R.function(this.media.play)?(this.ads&&this.ads.enabled&&this.ads.managerPromise.then(()=>this.ads.play()).catch(()=>Ln(this.media.play())),this.media.play()):null;pause=()=>!this.playing||!R.function(this.media.pause)?null:this.media.pause();get playing(){return!!(this.ready&&!this.paused&&!this.ended)}get paused(){return!!this.media.paused}get stopped(){return!!(this.paused&&this.currentTime===0)}get ended(){return!!this.media.ended}togglePlay=e=>(R.boolean(e)?e:!this.playing)?this.play():this.pause();stop=()=>{this.isHTML5?(this.pause(),this.restart()):R.function(this.media.stop)&&this.media.stop()};restart=()=>{this.currentTime=0};rewind=e=>{this.currentTime-=R.number(e)?e:this.config.seekTime};forward=e=>{this.currentTime+=R.number(e)?e:this.config.seekTime};set currentTime(e){if(!this.duration)return;let t=R.number(e)&&e>0;this.media.currentTime=t?Math.min(e,this.duration):0,this.debug.log(`Seeking to ${this.currentTime} seconds`)}get currentTime(){return Number(this.media.currentTime)}get buffered(){let{buffered:e}=this.media;return R.number(e)?e:e&&e.length&&this.duration>0?e.end(0)/this.duration:0}get seeking(){return!!this.media.seeking}get duration(){let e=Number.parseFloat(this.config.duration),t=(this.media||{}).duration,n=!R.number(t)||t===1/0?0:t;return e||n}set volume(e){let t=e;R.string(t)&&(t=Number(t)),R.number(t)||(t=this.storage.get(`volume`)),R.number(t)||({volume:t}=this.config),t>1&&(t=1),t<0&&(t=0),this.config.volume=t,this.media.volume=t,!R.empty(e)&&this.muted&&t>0&&(this.muted=!1)}get volume(){return Number(this.media.volume)}increaseVolume=e=>{this.volume=(this.media.muted?0:this.volume)+(R.number(e)?e:0)};decreaseVolume=e=>{this.increaseVolume(-e)};set muted(e){let t=e;R.boolean(t)||(t=this.storage.get(`muted`)),R.boolean(t)||(t=this.config.muted),this.config.muted=t,this.media.muted=t}get muted(){return!!this.media.muted}get hasAudio(){return!this.isHTML5||this.isAudio?!0:!!this.media.mozHasAudio||!!this.media.webkitAudioDecodedByteCount||!!(this.media.audioTracks&&this.media.audioTracks.length)}set speed(e){let t=null;R.number(e)&&(t=e),R.number(t)||(t=this.storage.get(`speed`)),R.number(t)||(t=this.config.speed.selected);let{minimumSpeed:n,maximumSpeed:r}=this;t=Jr(t,n,r),this.config.speed.selected=t,setTimeout(()=>{this.media&&(this.media.playbackRate=t)},0)}get speed(){return Number(this.media.playbackRate)}get minimumSpeed(){return this.isYouTube?Math.min(...this.options.speed):this.isVimeo?.5:.0625}get maximumSpeed(){return this.isYouTube?Math.max(...this.options.speed):this.isVimeo?2:16}set quality(e){let t=this.config.quality,n=this.options.quality;if(!n.length)return;let r=[!R.empty(e)&&Number(e),this.storage.get(`quality`),t.selected,t.default].find(R.number),i=!0;if(!n.includes(r)){let e=zn(n,r);this.debug.warn(`Unsupported quality option: ${r}, using ${e} instead`),r=e,i=!1}t.selected=r,this.media.quality=r,i&&this.storage.set({quality:r})}get quality(){return this.media.quality}set loop(e){let t=R.boolean(e)?e:this.config.loop.active;this.config.loop.active=t,this.media.loop=t}get loop(){return!!this.media.loop}set source(e){$r.change.call(this,e)}get source(){return this.media.currentSrc}get download(){let{download:e}=this.config.urls;return R.url(e)?e:this.source}set download(e){R.url(e)&&(this.config.urls.download=e,X.setDownloadUrl.call(this))}set poster(e){if(!this.isVideo){this.debug.warn(`Poster can only be set for video`);return}Q.setPoster.call(this,e,!1).catch(()=>{})}get poster(){return this.isVideo?this.media.getAttribute(`poster`)||this.media.getAttribute(`data-poster`):null}get ratio(){if(!this.isVideo)return null;let e=Un(Wn.call(this));return R.array(e)?e.join(`:`):e}set ratio(e){if(!this.isVideo){this.debug.warn(`Aspect ratio can only be set for video`);return}if(!R.string(e)||!Hn(e)){this.debug.error(`Invalid aspect ratio specified (${e})`);return}this.config.ratio=Un(e),Gn.call(this)}set autoplay(e){this.config.autoplay=R.boolean(e)?e:this.config.autoplay}get autoplay(){return!!this.config.autoplay}toggleCaptions(e){xr.toggle.call(this,e,!1)}set currentTrack(e){xr.set.call(this,e,!1),xr.setup.call(this)}get currentTrack(){let{toggled:e,currentTrack:t}=this.captions;return e?t:-1}set language(e){xr.setLanguage.call(this,e,!1)}get language(){return(xr.getCurrentTrack.call(this)||{}).language}set pip(e){if(!U.pip)return;let t=R.boolean(e)?e:!this.pip;R.function(this.media.webkitSetPresentationMode)&&this.media.webkitSetPresentationMode(t?Cr.active:Cr.inactive),R.function(this.media.requestPictureInPicture)&&(!this.pip&&t?this.media.requestPictureInPicture():this.pip&&!t&&document.exitPictureInPicture())}get pip(){return U.pip?R.empty(this.media.webkitPresentationMode)?this.media===document.pictureInPictureElement:this.media.webkitPresentationMode===Cr.active:null}setPreviewThumbnails(e){this.previewThumbnails&&this.previewThumbnails.loaded&&(this.previewThumbnails.destroy(),this.previewThumbnails=null),Object.assign(this.config.previewThumbnails,e),this.config.previewThumbnails.enabled&&(this.previewThumbnails=new Zr(this))}airplay=()=>{U.airplay&&this.media.webkitShowPlaybackTargetPicker()};toggleControls=e=>{if(this.supported.ui&&!this.isAudio){let t=wn(this.elements.container,this.config.classNames.hideControls),n=e===void 0?void 0:!e,r=V(this.elements.container,this.config.classNames.hideControls,n);if(r&&R.array(this.config.controls)&&this.config.controls.includes(`settings`)&&!R.empty(this.config.settings)&&X.toggleMenu.call(this,!1),r!==t){let e=r?`controlshidden`:`controlsshown`;G.call(this,this.media,e)}return!r}return!1};on=(e,t)=>{W.call(this,this.elements.container,e,t)};once=(e,t)=>{Pn.call(this,this.elements.container,e,t)};off=(e,t)=>{Nn(this.elements.container,e,t)};destroy=(e,t=!1)=>{if(!this.ready)return;let n=()=>{document.body.style.overflow=``,this.embed=null,t?(Object.keys(this.elements).length&&(yn(this.elements.buttons.play),yn(this.elements.captions),yn(this.elements.controls),yn(this.elements.wrapper),this.elements.buttons.play=null,this.elements.captions=null,this.elements.controls=null,this.elements.wrapper=null),R.function(e)&&e()):(Fn.call(this),Yn.cancelRequests.call(this),xn(this.elements.original,this.elements.container),G.call(this,this.elements.original,`destroyed`,!0),R.function(e)&&e.call(this.elements.original),this.ready=!1,setTimeout(()=>{this.elements=null,this.media=null},200))};this.stop(),clearTimeout(this.timers.loading),clearTimeout(this.timers.controls),clearTimeout(this.timers.resized),this.isHTML5?(Q.toggleNativeControls.call(this,!0),n()):this.isYouTube?(clearInterval(this.timers.buffering),clearInterval(this.timers.playing),this.embed!==null&&R.function(this.embed.destroy)&&this.embed.destroy(),n()):this.isVimeo&&(this.embed!==null&&this.embed.unload().then(n),setTimeout(n,200))};supports=e=>U.mime.call(this,e);static supported(e,t){return U.check(e,t)}static loadSprite(e,t){return pr(e,t)}static setup(t,n={}){let r=null;return R.string(t)?r=Array.from(document.querySelectorAll(t)):R.nodeList(t)?r=Array.from(t):R.array(t)&&(r=t.filter(R.element)),R.empty(r)?null:r.map(t=>new e(t,n))}};ei.defaults=pn(Sr);var ti=ei;const $=e({current:null,nowPlaying:`dQw4w9WgXcQ`,playlist:[{title:`Never Gonna Give You Up`,videoId:`dQw4w9WgXcQ`}]}),ni=async e=>{$.current=new ti(e,{controls:[]}),$.playlist=await Wt.songs.toArray(),$.playlist[0]?.videoId&&($.nowPlaying=$.playlist[0]?.videoId),await ri($.nowPlaying)},ri=async e=>{$.current.source={type:`video`,sources:[{src:e,provider:`youtube`}]},$.current.once(`ready`,()=>{$.current.play()})},ii=async()=>{$.current&&$.current.play()},ai=async()=>{if($.current){$.current.stop(),$.playlist[0]?.videoId&&ri($.playlist[0]?.videoId||``);let e=await Wt.songs.orderBy(`id`).first();e?(await Wt.songs.delete(e.id),$.playlist=await Wt.songs.toArray()):console.log(`No items to delete`)}},oi=async()=>{$.current&&$.current.pause()};var si=c(((e,t)=>{t.exports=function(){return typeof Promise==`function`&&Promise.prototype&&Promise.prototype.then}})),ci=c((e=>{var t,n=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];e.getSymbolSize=function(e){if(!e)throw Error(`"version" cannot be null or undefined`);if(e<1||e>40)throw Error(`"version" should be in range from 1 to 40`);return e*4+17},e.getSymbolTotalCodewords=function(e){return n[e]},e.getBCHDigit=function(e){let t=0;for(;e!==0;)t++,e>>>=1;return t},e.setToSJISFunction=function(e){if(typeof e!=`function`)throw Error(`"toSJISFunc" is not a valid function.`);t=e},e.isKanjiModeEnabled=function(){return t!==void 0},e.toSJIS=function(e){return t(e)}})),li=c((e=>{e.L={bit:1},e.M={bit:0},e.Q={bit:3},e.H={bit:2};function t(t){if(typeof t!=`string`)throw Error(`Param is not a string`);switch(t.toLowerCase()){case`l`:case`low`:return e.L;case`m`:case`medium`:return e.M;case`q`:case`quartile`:return e.Q;case`h`:case`high`:return e.H;default:throw Error(`Unknown EC Level: `+t)}}e.isValid=function(e){return e&&e.bit!==void 0&&e.bit>=0&&e.bit<4},e.from=function(n,r){if(e.isValid(n))return n;try{return t(n)}catch{return r}}})),ui=c(((e,t)=>{function n(){this.buffer=[],this.length=0}n.prototype={get:function(e){let t=Math.floor(e/8);return(this.buffer[t]>>>7-e%8&1)==1},put:function(e,t){for(let n=0;n<t;n++)this.putBit((e>>>t-n-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(e){let t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}},t.exports=n})),di=c(((e,t)=>{function n(e){if(!e||e<1)throw Error(`BitMatrix size must be defined and greater than 0`);this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}n.prototype.set=function(e,t,n,r){let i=e*this.size+t;this.data[i]=n,r&&(this.reservedBit[i]=!0)},n.prototype.get=function(e,t){return this.data[e*this.size+t]},n.prototype.xor=function(e,t,n){this.data[e*this.size+t]^=n},n.prototype.isReserved=function(e,t){return this.reservedBit[e*this.size+t]},t.exports=n})),fi=c((e=>{var t=ci().getSymbolSize;e.getRowColCoords=function(e){if(e===1)return[];let n=Math.floor(e/7)+2,r=t(e),i=r===145?26:Math.ceil((r-13)/(2*n-2))*2,a=[r-7];for(let e=1;e<n-1;e++)a[e]=a[e-1]-i;return a.push(6),a.reverse()},e.getPositions=function(t){let n=[],r=e.getRowColCoords(t),i=r.length;for(let e=0;e<i;e++)for(let t=0;t<i;t++)e===0&&t===0||e===0&&t===i-1||e===i-1&&t===0||n.push([r[e],r[t]]);return n}})),pi=c((e=>{var t=ci().getSymbolSize,n=7;e.getPositions=function(e){let r=t(e);return[[0,0],[r-n,0],[0,r-n]]}})),mi=c((e=>{e.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};var t={N1:3,N2:3,N3:40,N4:10};e.isValid=function(e){return e!=null&&e!==``&&!isNaN(e)&&e>=0&&e<=7},e.from=function(t){return e.isValid(t)?parseInt(t,10):void 0},e.getPenaltyN1=function(e){let n=e.size,r=0,i=0,a=0,o=null,s=null;for(let c=0;c<n;c++){i=a=0,o=s=null;for(let l=0;l<n;l++){let n=e.get(c,l);n===o?i++:(i>=5&&(r+=t.N1+(i-5)),o=n,i=1),n=e.get(l,c),n===s?a++:(a>=5&&(r+=t.N1+(a-5)),s=n,a=1)}i>=5&&(r+=t.N1+(i-5)),a>=5&&(r+=t.N1+(a-5))}return r},e.getPenaltyN2=function(e){let n=e.size,r=0;for(let t=0;t<n-1;t++)for(let i=0;i<n-1;i++){let n=e.get(t,i)+e.get(t,i+1)+e.get(t+1,i)+e.get(t+1,i+1);(n===4||n===0)&&r++}return r*t.N2},e.getPenaltyN3=function(e){let n=e.size,r=0,i=0,a=0;for(let t=0;t<n;t++){i=a=0;for(let o=0;o<n;o++)i=i<<1&2047|e.get(t,o),o>=10&&(i===1488||i===93)&&r++,a=a<<1&2047|e.get(o,t),o>=10&&(a===1488||a===93)&&r++}return r*t.N3},e.getPenaltyN4=function(e){let n=0,r=e.data.length;for(let t=0;t<r;t++)n+=e.data[t];return Math.abs(Math.ceil(n*100/r/5)-10)*t.N4};function n(t,n,r){switch(t){case e.Patterns.PATTERN000:return(n+r)%2==0;case e.Patterns.PATTERN001:return n%2==0;case e.Patterns.PATTERN010:return r%3==0;case e.Patterns.PATTERN011:return(n+r)%3==0;case e.Patterns.PATTERN100:return(Math.floor(n/2)+Math.floor(r/3))%2==0;case e.Patterns.PATTERN101:return n*r%2+n*r%3==0;case e.Patterns.PATTERN110:return(n*r%2+n*r%3)%2==0;case e.Patterns.PATTERN111:return(n*r%3+(n+r)%2)%2==0;default:throw Error(`bad maskPattern:`+t)}}e.applyMask=function(e,t){let r=t.size;for(let i=0;i<r;i++)for(let a=0;a<r;a++)t.isReserved(a,i)||t.xor(a,i,n(e,a,i))},e.getBestMask=function(t,n){let r=Object.keys(e.Patterns).length,i=0,a=1/0;for(let o=0;o<r;o++){n(o),e.applyMask(o,t);let r=e.getPenaltyN1(t)+e.getPenaltyN2(t)+e.getPenaltyN3(t)+e.getPenaltyN4(t);e.applyMask(o,t),r<a&&(a=r,i=o)}return i}})),hi=c((e=>{var t=li(),n=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],r=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];e.getBlocksCount=function(e,r){switch(r){case t.L:return n[(e-1)*4+0];case t.M:return n[(e-1)*4+1];case t.Q:return n[(e-1)*4+2];case t.H:return n[(e-1)*4+3];default:return}},e.getTotalCodewordsCount=function(e,n){switch(n){case t.L:return r[(e-1)*4+0];case t.M:return r[(e-1)*4+1];case t.Q:return r[(e-1)*4+2];case t.H:return r[(e-1)*4+3];default:return}}})),gi=c((e=>{var t=new Uint8Array(512),n=new Uint8Array(256);(function(){let e=1;for(let r=0;r<255;r++)t[r]=e,n[e]=r,e<<=1,e&256&&(e^=285);for(let e=255;e<512;e++)t[e]=t[e-255]})(),e.log=function(e){if(e<1)throw Error(`log(`+e+`)`);return n[e]},e.exp=function(e){return t[e]},e.mul=function(e,r){return e===0||r===0?0:t[n[e]+n[r]]}})),_i=c((e=>{var t=gi();e.mul=function(e,n){let r=new Uint8Array(e.length+n.length-1);for(let i=0;i<e.length;i++)for(let a=0;a<n.length;a++)r[i+a]^=t.mul(e[i],n[a]);return r},e.mod=function(e,n){let r=new Uint8Array(e);for(;r.length-n.length>=0;){let e=r[0];for(let i=0;i<n.length;i++)r[i]^=t.mul(n[i],e);let i=0;for(;i<r.length&&r[i]===0;)i++;r=r.slice(i)}return r},e.generateECPolynomial=function(n){let r=new Uint8Array([1]);for(let i=0;i<n;i++)r=e.mul(r,new Uint8Array([1,t.exp(i)]));return r}})),vi=c(((e,t)=>{var n=_i();function r(e){this.genPoly=void 0,this.degree=e,this.degree&&this.initialize(this.degree)}r.prototype.initialize=function(e){this.degree=e,this.genPoly=n.generateECPolynomial(this.degree)},r.prototype.encode=function(e){if(!this.genPoly)throw Error(`Encoder not initialized`);let t=new Uint8Array(e.length+this.degree);t.set(e);let r=n.mod(t,this.genPoly),i=this.degree-r.length;if(i>0){let e=new Uint8Array(this.degree);return e.set(r,i),e}return r},t.exports=r})),yi=c((e=>{e.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}})),bi=c((e=>{var t=`[0-9]+`,n=`[A-Z $%*+\\-./:]+`,r=`(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+`;r=r.replace(/u/g,`\\u`);var i=`(?:(?![A-Z0-9 $%*+\\-./:]|`+r+`)(?:.|[\r
]))+`;e.KANJI=new RegExp(r,`g`),e.BYTE_KANJI=RegExp(`[^A-Z0-9 $%*+\\-./:]+`,`g`),e.BYTE=new RegExp(i,`g`),e.NUMERIC=new RegExp(t,`g`),e.ALPHANUMERIC=new RegExp(n,`g`);var a=RegExp(`^`+r+`$`),o=RegExp(`^`+t+`$`),s=RegExp(`^[A-Z0-9 $%*+\\-./:]+$`);e.testKanji=function(e){return a.test(e)},e.testNumeric=function(e){return o.test(e)},e.testAlphanumeric=function(e){return s.test(e)}})),xi=c((e=>{var t=yi(),n=bi();e.NUMERIC={id:`Numeric`,bit:1,ccBits:[10,12,14]},e.ALPHANUMERIC={id:`Alphanumeric`,bit:2,ccBits:[9,11,13]},e.BYTE={id:`Byte`,bit:4,ccBits:[8,16,16]},e.KANJI={id:`Kanji`,bit:8,ccBits:[8,10,12]},e.MIXED={bit:-1},e.getCharCountIndicator=function(e,n){if(!e.ccBits)throw Error(`Invalid mode: `+e);if(!t.isValid(n))throw Error(`Invalid version: `+n);return n>=1&&n<10?e.ccBits[0]:n<27?e.ccBits[1]:e.ccBits[2]},e.getBestModeForData=function(t){return n.testNumeric(t)?e.NUMERIC:n.testAlphanumeric(t)?e.ALPHANUMERIC:n.testKanji(t)?e.KANJI:e.BYTE},e.toString=function(e){if(e&&e.id)return e.id;throw Error(`Invalid mode`)},e.isValid=function(e){return e&&e.bit&&e.ccBits};function r(t){if(typeof t!=`string`)throw Error(`Param is not a string`);switch(t.toLowerCase()){case`numeric`:return e.NUMERIC;case`alphanumeric`:return e.ALPHANUMERIC;case`kanji`:return e.KANJI;case`byte`:return e.BYTE;default:throw Error(`Unknown mode: `+t)}}e.from=function(t,n){if(e.isValid(t))return t;try{return r(t)}catch{return n}}})),Si=c((e=>{var t=ci(),n=hi(),r=li(),i=xi(),a=yi(),o=7973,s=t.getBCHDigit(o);function c(t,n,r){for(let i=1;i<=40;i++)if(n<=e.getCapacity(i,r,t))return i}function l(e,t){return i.getCharCountIndicator(e,t)+4}function u(e,t){let n=0;return e.forEach(function(e){let r=l(e.mode,t);n+=r+e.getBitsLength()}),n}function d(t,n){for(let r=1;r<=40;r++)if(u(t,r)<=e.getCapacity(r,n,i.MIXED))return r}e.from=function(e,t){return a.isValid(e)?parseInt(e,10):t},e.getCapacity=function(e,r,o){if(!a.isValid(e))throw Error(`Invalid QR Code version`);o===void 0&&(o=i.BYTE);let s=t.getSymbolTotalCodewords(e),c=n.getTotalCodewordsCount(e,r),u=(s-c)*8;if(o===i.MIXED)return u;let d=u-l(o,e);switch(o){case i.NUMERIC:return Math.floor(d/10*3);case i.ALPHANUMERIC:return Math.floor(d/11*2);case i.KANJI:return Math.floor(d/13);case i.BYTE:default:return Math.floor(d/8)}},e.getBestVersionForData=function(e,t){let n,i=r.from(t,r.M);if(Array.isArray(e)){if(e.length>1)return d(e,i);if(e.length===0)return 1;n=e[0]}else n=e;return c(n.mode,n.getLength(),i)},e.getEncodedBits=function(e){if(!a.isValid(e)||e<7)throw Error(`Invalid QR Code version`);let n=e<<12;for(;t.getBCHDigit(n)-s>=0;)n^=o<<t.getBCHDigit(n)-s;return e<<12|n}})),Ci=c((e=>{var t=ci(),n=1335,r=21522,i=t.getBCHDigit(n);e.getEncodedBits=function(e,a){let o=e.bit<<3|a,s=o<<10;for(;t.getBCHDigit(s)-i>=0;)s^=n<<t.getBCHDigit(s)-i;return(o<<10|s)^r}})),wi=c(((e,t)=>{var n=xi();function r(e){this.mode=n.NUMERIC,this.data=e.toString()}r.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)},r.prototype.getLength=function(){return this.data.length},r.prototype.getBitsLength=function(){return r.getBitsLength(this.data.length)},r.prototype.write=function(e){let t,n,r;for(t=0;t+3<=this.data.length;t+=3)n=this.data.substr(t,3),r=parseInt(n,10),e.put(r,10);let i=this.data.length-t;i>0&&(n=this.data.substr(t),r=parseInt(n,10),e.put(r,i*3+1))},t.exports=r})),Ti=c(((e,t)=>{var n=xi(),r=`0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:`.split(``);function i(e){this.mode=n.ALPHANUMERIC,this.data=e}i.getBitsLength=function(e){return 11*Math.floor(e/2)+6*(e%2)},i.prototype.getLength=function(){return this.data.length},i.prototype.getBitsLength=function(){return i.getBitsLength(this.data.length)},i.prototype.write=function(e){let t;for(t=0;t+2<=this.data.length;t+=2){let n=r.indexOf(this.data[t])*45;n+=r.indexOf(this.data[t+1]),e.put(n,11)}this.data.length%2&&e.put(r.indexOf(this.data[t]),6)},t.exports=i})),Ei=c(((e,t)=>{var n=xi();function r(e){this.mode=n.BYTE,typeof e==`string`?this.data=new TextEncoder().encode(e):this.data=new Uint8Array(e)}r.getBitsLength=function(e){return e*8},r.prototype.getLength=function(){return this.data.length},r.prototype.getBitsLength=function(){return r.getBitsLength(this.data.length)},r.prototype.write=function(e){for(let t=0,n=this.data.length;t<n;t++)e.put(this.data[t],8)},t.exports=r})),Di=c(((e,t)=>{var n=xi(),r=ci();function i(e){this.mode=n.KANJI,this.data=e}i.getBitsLength=function(e){return e*13},i.prototype.getLength=function(){return this.data.length},i.prototype.getBitsLength=function(){return i.getBitsLength(this.data.length)},i.prototype.write=function(e){let t;for(t=0;t<this.data.length;t++){let n=r.toSJIS(this.data[t]);if(n>=33088&&n<=40956)n-=33088;else if(n>=57408&&n<=60351)n-=49472;else throw Error(`Invalid SJIS character: `+this.data[t]+`
Make sure your charset is UTF-8`);n=(n>>>8&255)*192+(n&255),e.put(n,13)}},t.exports=i})),Oi=c(((e,t)=>{var n={single_source_shortest_paths:function(e,t,r){var i={},a={};a[t]=0;var o=n.PriorityQueue.make();o.push(t,0);for(var s,c,l,u,d,f,p,m,h;!o.empty();)for(l in s=o.pop(),c=s.value,u=s.cost,d=e[c]||{},d)d.hasOwnProperty(l)&&(f=d[l],p=u+f,m=a[l],h=a[l]===void 0,(h||m>p)&&(a[l]=p,o.push(l,p),i[l]=c));if(r!==void 0&&a[r]===void 0){var g=[`Could not find a path from `,t,` to `,r,`.`].join(``);throw Error(g)}return i},extract_shortest_path_from_predecessor_list:function(e,t){for(var n=[],r=t;r;)n.push(r),e[r],r=e[r];return n.reverse(),n},find_path:function(e,t,r){var i=n.single_source_shortest_paths(e,t,r);return n.extract_shortest_path_from_predecessor_list(i,r)},PriorityQueue:{make:function(e){var t=n.PriorityQueue,r={},i;for(i in e||={},t)t.hasOwnProperty(i)&&(r[i]=t[i]);return r.queue=[],r.sorter=e.sorter||t.default_sorter,r},default_sorter:function(e,t){return e.cost-t.cost},push:function(e,t){var n={value:e,cost:t};this.queue.push(n),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};t!==void 0&&(t.exports=n)})),ki=c((e=>{var t=xi(),n=wi(),r=Ti(),i=Ei(),a=Di(),o=bi(),s=ci(),c=Oi();function l(e){return unescape(encodeURIComponent(e)).length}function u(e,t,n){let r=[],i;for(;(i=e.exec(n))!==null;)r.push({data:i[0],index:i.index,mode:t,length:i[0].length});return r}function d(e){let n=u(o.NUMERIC,t.NUMERIC,e),r=u(o.ALPHANUMERIC,t.ALPHANUMERIC,e),i,a;return s.isKanjiModeEnabled()?(i=u(o.BYTE,t.BYTE,e),a=u(o.KANJI,t.KANJI,e)):(i=u(o.BYTE_KANJI,t.BYTE,e),a=[]),n.concat(r,i,a).sort(function(e,t){return e.index-t.index}).map(function(e){return{data:e.data,mode:e.mode,length:e.length}})}function f(e,o){switch(o){case t.NUMERIC:return n.getBitsLength(e);case t.ALPHANUMERIC:return r.getBitsLength(e);case t.KANJI:return a.getBitsLength(e);case t.BYTE:return i.getBitsLength(e)}}function p(e){return e.reduce(function(e,t){let n=e.length-1>=0?e[e.length-1]:null;return n&&n.mode===t.mode?(e[e.length-1].data+=t.data,e):(e.push(t),e)},[])}function m(e){let n=[];for(let r=0;r<e.length;r++){let i=e[r];switch(i.mode){case t.NUMERIC:n.push([i,{data:i.data,mode:t.ALPHANUMERIC,length:i.length},{data:i.data,mode:t.BYTE,length:i.length}]);break;case t.ALPHANUMERIC:n.push([i,{data:i.data,mode:t.BYTE,length:i.length}]);break;case t.KANJI:n.push([i,{data:i.data,mode:t.BYTE,length:l(i.data)}]);break;case t.BYTE:n.push([{data:i.data,mode:t.BYTE,length:l(i.data)}])}}return n}function h(e,n){let r={},i={start:{}},a=[`start`];for(let o=0;o<e.length;o++){let s=e[o],c=[];for(let e=0;e<s.length;e++){let l=s[e],u=``+o+e;c.push(u),r[u]={node:l,lastCount:0},i[u]={};for(let e=0;e<a.length;e++){let o=a[e];r[o]&&r[o].node.mode===l.mode?(i[o][u]=f(r[o].lastCount+l.length,l.mode)-f(r[o].lastCount,l.mode),r[o].lastCount+=l.length):(r[o]&&(r[o].lastCount=l.length),i[o][u]=f(l.length,l.mode)+4+t.getCharCountIndicator(l.mode,n))}}a=c}for(let e=0;e<a.length;e++)i[a[e]].end=0;return{map:i,table:r}}function g(e,o){let c,l=t.getBestModeForData(e);if(c=t.from(o,l),c!==t.BYTE&&c.bit<l.bit)throw Error(`"`+e+`" cannot be encoded with mode `+t.toString(c)+`.
 Suggested mode is: `+t.toString(l));switch(c===t.KANJI&&!s.isKanjiModeEnabled()&&(c=t.BYTE),c){case t.NUMERIC:return new n(e);case t.ALPHANUMERIC:return new r(e);case t.KANJI:return new a(e);case t.BYTE:return new i(e)}}e.fromArray=function(e){return e.reduce(function(e,t){return typeof t==`string`?e.push(g(t,null)):t.data&&e.push(g(t.data,t.mode)),e},[])},e.fromString=function(t,n){let r=d(t,s.isKanjiModeEnabled()),i=m(r),a=h(i,n),o=c.find_path(a.map,`start`,`end`),l=[];for(let e=1;e<o.length-1;e++)l.push(a.table[o[e]].node);return e.fromArray(p(l))},e.rawSplit=function(t){return e.fromArray(d(t,s.isKanjiModeEnabled()))}})),Ai=c((e=>{var t=ci(),n=li(),r=ui(),i=di(),a=fi(),o=pi(),s=mi(),c=hi(),l=vi(),u=Si(),d=Ci(),f=xi(),p=ki();function m(e,t){let n=e.size,r=o.getPositions(t);for(let t=0;t<r.length;t++){let i=r[t][0],a=r[t][1];for(let t=-1;t<=7;t++)if(!(i+t<=-1||n<=i+t))for(let r=-1;r<=7;r++)a+r<=-1||n<=a+r||(t>=0&&t<=6&&(r===0||r===6)||r>=0&&r<=6&&(t===0||t===6)||t>=2&&t<=4&&r>=2&&r<=4?e.set(i+t,a+r,!0,!0):e.set(i+t,a+r,!1,!0))}}function h(e){let t=e.size;for(let n=8;n<t-8;n++){let t=n%2==0;e.set(n,6,t,!0),e.set(6,n,t,!0)}}function g(e,t){let n=a.getPositions(t);for(let t=0;t<n.length;t++){let r=n[t][0],i=n[t][1];for(let t=-2;t<=2;t++)for(let n=-2;n<=2;n++)t===-2||t===2||n===-2||n===2||t===0&&n===0?e.set(r+t,i+n,!0,!0):e.set(r+t,i+n,!1,!0)}}function _(e,t){let n=e.size,r=u.getEncodedBits(t),i,a,o;for(let t=0;t<18;t++)i=Math.floor(t/3),a=t%3+n-8-3,o=(r>>t&1)==1,e.set(i,a,o,!0),e.set(a,i,o,!0)}function v(e,t,n){let r=e.size,i=d.getEncodedBits(t,n),a,o;for(a=0;a<15;a++)o=(i>>a&1)==1,a<6?e.set(a,8,o,!0):a<8?e.set(a+1,8,o,!0):e.set(r-15+a,8,o,!0),a<8?e.set(8,r-a-1,o,!0):a<9?e.set(8,15-a-1+1,o,!0):e.set(8,15-a-1,o,!0);e.set(r-8,8,1,!0)}function y(e,t){let n=e.size,r=-1,i=n-1,a=7,o=0;for(let s=n-1;s>0;s-=2)for(s===6&&s--;;){for(let n=0;n<2;n++)if(!e.isReserved(i,s-n)){let r=!1;o<t.length&&(r=(t[o]>>>a&1)==1),e.set(i,s-n,r),a--,a===-1&&(o++,a=7)}if(i+=r,i<0||n<=i){i-=r,r=-r;break}}}function b(e,n,i){let a=new r;i.forEach(function(t){a.put(t.mode.bit,4),a.put(t.getLength(),f.getCharCountIndicator(t.mode,e)),t.write(a)});let o=t.getSymbolTotalCodewords(e),s=c.getTotalCodewordsCount(e,n),l=(o-s)*8;for(a.getLengthInBits()+4<=l&&a.put(0,4);a.getLengthInBits()%8!=0;)a.putBit(0);let u=(l-a.getLengthInBits())/8;for(let e=0;e<u;e++)a.put(e%2?17:236,8);return x(a,e,n)}function x(e,n,r){let i=t.getSymbolTotalCodewords(n),a=c.getTotalCodewordsCount(n,r),o=i-a,s=c.getBlocksCount(n,r),u=i%s,d=s-u,f=Math.floor(i/s),p=Math.floor(o/s),m=p+1,h=f-p,g=new l(h),_=0,v=Array(s),y=Array(s),b=0,x=new Uint8Array(e.buffer);for(let e=0;e<s;e++){let t=e<d?p:m;v[e]=x.slice(_,_+t),y[e]=g.encode(v[e]),_+=t,b=Math.max(b,t)}let ee=new Uint8Array(i),te=0,ne,re;for(ne=0;ne<b;ne++)for(re=0;re<s;re++)ne<v[re].length&&(ee[te++]=v[re][ne]);for(ne=0;ne<h;ne++)for(re=0;re<s;re++)ee[te++]=y[re][ne];return ee}function ee(e,n,r,a){let o;if(Array.isArray(e))o=p.fromArray(e);else if(typeof e==`string`){let t=n;if(!t){let n=p.rawSplit(e);t=u.getBestVersionForData(n,r)}o=p.fromString(e,t||40)}else throw Error(`Invalid data`);let c=u.getBestVersionForData(o,r);if(!c)throw Error(`The amount of data is too big to be stored in a QR Code`);if(!n)n=c;else if(n<c)throw Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+c+`.
`);let l=b(n,r,o),d=t.getSymbolSize(n),f=new i(d);return m(f,n),h(f),g(f,n),v(f,r,0),n>=7&&_(f,n),y(f,l),isNaN(a)&&(a=s.getBestMask(f,v.bind(null,f,r))),s.applyMask(a,f),v(f,r,a),{modules:f,version:n,errorCorrectionLevel:r,maskPattern:a,segments:o}}e.create=function(e,r){if(e===void 0||e===``)throw Error(`No input text`);let i=n.M,a,o;return r!==void 0&&(i=n.from(r.errorCorrectionLevel,n.M),a=u.from(r.version),o=s.from(r.maskPattern),r.toSJISFunc&&t.setToSJISFunction(r.toSJISFunc)),ee(e,a,i,o)}})),ji=c((e=>{function t(e){if(typeof e==`number`&&(e=e.toString()),typeof e!=`string`)throw Error(`Color should be defined as hex string`);let t=e.slice().replace(`#`,``).split(``);if(t.length<3||t.length===5||t.length>8)throw Error(`Invalid hex color: `+e);(t.length===3||t.length===4)&&(t=Array.prototype.concat.apply([],t.map(function(e){return[e,e]}))),t.length===6&&t.push(`F`,`F`);let n=parseInt(t.join(``),16);return{r:n>>24&255,g:n>>16&255,b:n>>8&255,a:n&255,hex:`#`+t.slice(0,6).join(``)}}e.getOptions=function(e){e||={},e.color||={};let n=e.margin===void 0||e.margin===null||e.margin<0?4:e.margin,r=e.width&&e.width>=21?e.width:void 0,i=e.scale||4;return{width:r,scale:r?4:i,margin:n,color:{dark:t(e.color.dark||`#000000ff`),light:t(e.color.light||`#ffffffff`)},type:e.type,rendererOpts:e.rendererOpts||{}}},e.getScale=function(e,t){return t.width&&t.width>=e+t.margin*2?t.width/(e+t.margin*2):t.scale},e.getImageWidth=function(t,n){let r=e.getScale(t,n);return Math.floor((t+n.margin*2)*r)},e.qrToImageData=function(t,n,r){let i=n.modules.size,a=n.modules.data,o=e.getScale(i,r),s=Math.floor((i+r.margin*2)*o),c=r.margin*o,l=[r.color.light,r.color.dark];for(let e=0;e<s;e++)for(let n=0;n<s;n++){let u=(e*s+n)*4,d=r.color.light;if(e>=c&&n>=c&&e<s-c&&n<s-c){let t=Math.floor((e-c)/o),r=Math.floor((n-c)/o);d=l[a[t*i+r]?1:0]}t[u++]=d.r,t[u++]=d.g,t[u++]=d.b,t[u]=d.a}}})),Mi=c((e=>{var t=ji();function n(e,t,n){e.clearRect(0,0,t.width,t.height),t.style||={},t.height=n,t.width=n,t.style.height=n+`px`,t.style.width=n+`px`}function r(){try{return document.createElement(`canvas`)}catch{throw Error(`You need to specify a canvas element`)}}e.render=function(e,i,a){let o=a,s=i;o===void 0&&(!i||!i.getContext)&&(o=i,i=void 0),i||(s=r()),o=t.getOptions(o);let c=t.getImageWidth(e.modules.size,o),l=s.getContext(`2d`),u=l.createImageData(c,c);return t.qrToImageData(u.data,e,o),n(l,s,c),l.putImageData(u,0,0),s},e.renderToDataURL=function(t,n,r){let i=r;i===void 0&&(!n||!n.getContext)&&(i=n,n=void 0),i||={};let a=e.render(t,n,i),o=i.type||`image/png`,s=i.rendererOpts||{};return a.toDataURL(o,s.quality)}})),Ni=c((e=>{var t=ji();function n(e,t){let n=e.a/255,r=t+`="`+e.hex+`"`;return n<1?r+` `+t+`-opacity="`+n.toFixed(2).slice(1)+`"`:r}function r(e,t,n){let r=e+t;return n!==void 0&&(r+=` `+n),r}function i(e,t,n){let i=``,a=0,o=!1,s=0;for(let c=0;c<e.length;c++){let l=Math.floor(c%t),u=Math.floor(c/t);!l&&!o&&(o=!0),e[c]?(s++,c>0&&l>0&&e[c-1]||(i+=o?r(`M`,l+n,.5+u+n):r(`m`,a,0),a=0,o=!1),l+1<t&&e[c+1]||(i+=r(`h`,s),s=0)):a++}return i}e.render=function(e,r,a){let o=t.getOptions(r),s=e.modules.size,c=e.modules.data,l=s+o.margin*2,u=o.color.light.a?`<path `+n(o.color.light,`fill`)+` d="M0 0h`+l+`v`+l+`H0z"/>`:``,d=`<path `+n(o.color.dark,`stroke`)+` d="`+i(c,s,o.margin)+`"/>`,f=`viewBox="0 0 `+l+` `+l+`"`,p=`<svg xmlns="http://www.w3.org/2000/svg" `+(o.width?`width="`+o.width+`" height="`+o.width+`" `:``)+f+` shape-rendering="crispEdges">`+u+d+`</svg>
`;return typeof a==`function`&&a(null,p),p}})),Pi=d(c((e=>{var t=si(),n=Ai(),r=Mi(),i=Ni();function a(e,r,i,a,o){let s=[].slice.call(arguments,1),c=s.length,l=typeof s[c-1]==`function`;if(!l&&!t())throw Error(`Callback required as last argument`);if(l){if(c<2)throw Error(`Too few arguments provided`);c===2?(o=i,i=r,r=a=void 0):c===3&&(r.getContext&&o===void 0?(o=a,a=void 0):(o=a,a=i,i=r,r=void 0))}else{if(c<1)throw Error(`Too few arguments provided`);return c===1?(i=r,r=a=void 0):c===2&&!r.getContext&&(a=i,i=r,r=void 0),new Promise(function(t,o){try{let o=n.create(i,a);t(e(o,r,a))}catch(e){o(e)}})}try{let t=n.create(i,a);o(null,e(t,r,a))}catch(e){o(e)}}e.create=n.create,e.toCanvas=a.bind(null,r.render),e.toDataURL=a.bind(null,r.renderToDataURL),e.toString=a.bind(null,function(e,t,n){return i.render(e,n)})}))());const Fi=async e=>{try{e.src=await Pi.toDataURL(`${window.location.href}#/${Ii.machineId}`,{errorCorrectionLevel:`L`}),console.log(`${window.location.href}#/${Ii.machineId}`)}catch(e){console.error(e)}},Ii=e({current:null,connection:null,machineId:localStorage.getItem(`hostId`)||``,guestId:null,songs:[]}),Li=async()=>{Ii.current=new At(Ii.machineId),Ii.current.on(`open`,e=>{console.log(`Machine ID: ${e}`),localStorage.setItem(`hostId`,e),Fi(document.getElementById(`qr-code`))}),Ii.current.on(`connection`,e=>{e.on(`data`,async n=>{if(n.type===`message`){t.success(n.message),e.send({type:`message`,message:`Hello from Host Machine!`});let r=await Wt.songs.toArray();r&&e.send({type:`list`,songs:r})}if(n.type===`add`&&n.song){await Wt.songs.add({title:n.song.title,cover:n.song.cover,videoId:n.song.videoId,metadata:n.song.metadata}),await Wt.songbook.add({title:n.song.title,cover:n.song.cover,videoId:n.song.videoId,metadata:n.song.metadata}),t.success(`Song: ${n.song.title} - added to queue!`),e.send({type:`message`,message:`Song: ${n.song.title} - added to queue!`});let r=await Wt.songs.toArray();r&&($.playlist=r,e.send({type:`list`,songs:r}))}})})},Ri=async e=>{Ii.current=new At,Ii.current.on(`open`,n=>{Ii.guestId=n,console.log(`My Peer ID: ${Ii.guestId}`);let r=Ii.current.connect(e);return Ii.connection=r,r.on(`open`,()=>{r.send({type:`message`,message:`Hello from Guest Machine!`})}),r.on(`data`,e=>{e.type===`message`&&(t.success(e.message),loadingModal.close()),e.type===`list`&&e.songs&&(Ii.songs=e.songs,addSongModal.close())}),{conn:r}})};export{ni as a,$ as c,Fi as i,ai as l,Li as n,oi as o,Ii as r,ii as s,Ri as t};